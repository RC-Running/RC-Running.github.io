<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Zhuangdong_Course_Note_VFXShader &#183; Runming Chen</title><meta name=title content="Zhuangdong_Course_Note_VFXShader &#183; Runming Chen"><meta name=description content="Zhuangdong_Course_Note_VFXShader"><link rel=canonical href=https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/><link type=text/css rel=stylesheet href=/css/main.bundle.min.2755fda1868f0bfc1843df512e7b0b0bec55a259db5f8b13dc3c0f7894e519f617c2b66f5915ec207e2a1ffc8b6d1b53dbd8f3dff8892140cb5eacc50a6edfbb.css integrity="sha512-J1X9oYaPC/wYQ99RLnsLC+xVolnbX4sT3DwPeJTlGfYXwrZvWRXsIH4qH/yLbRtT29jz3/iJIUDLXqzFCm7fuw=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.dc15078f1fe553ce354f85ec1bfce7ded8b4060d4124a49b19e31dd64345b8d8f03edbbb1b681748650181f9d81da9728ca10c2b9cb2ae7bf8983d4b669ba876.js integrity="sha512-3BUHjx/lU841T4XsG/zn3ti0Bg1BJKSbGeMd1kNFuNjwPtu7G2gXSGUBgfnYHalyjKEMK5yyrnv4mD1LZpuodg==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/"><meta property="og:site_name" content="Runming Chen"><meta property="og:title" content="Zhuangdong_Course_Note_VFXShader"><meta property="og:description" content="Zhuangdong_Course_Note_VFXShader"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2025-05-27T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zhuangdong_Course_Note_VFXShader"><meta name=twitter:description content="Zhuangdong_Course_Note_VFXShader"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Notes","name":"Zhuangdong_Course_Note_VFXShader","headline":"Zhuangdong_Course_Note_VFXShader","description":"Zhuangdong_Course_Note_VFXShader","inLanguage":"en","url":"https:\/\/rcrunming.com\/notes\/courses\/zhuangdongstaintrocourse\/zhuangdong_note_vfxshader\/","author":{"@type":"Person","name":"Runming"},"copyrightYear":"2025","dateCreated":"2025-05-27T00:00:00\u002b00:00","datePublished":"2025-05-27T00:00:00\u002b00:00","dateModified":"2025-05-27T00:00:00\u002b00:00","mainEntityOfPage":"true","wordCount":"2756"}]</script><meta name=author content="Runming"><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KLCF0CEN9Z"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KLCF0CEN9Z")</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] z-index-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 padding-main-menu"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Runming Chen</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/notes/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Notes>Notes</p></a><a href=/portfolio/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Portfolio>Portfolio</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 padding-top-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/notes/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Notes>Notes</p></a></li><li class=mt-1><a href=/portfolio/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Portfolio>Portfolio</p></a></li></ul></div></label></div></div></div></div><script type=text/javascript src=/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g==" data-target-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/background_13824845206636284721_hu_f9782f9bbf816a16.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g==" data-target-id=background-blur></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Zhuangdong_Course_Note_VFXShader</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><span>2756 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">13 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#1-透混-ab-alphablend>1. 透混 AB (AlphaBlend)</a></li><li><a href=#2-透叠-ad-additive>2. 透叠 AD (Additive)</a></li><li><a href=#3-透切-ac-alphacutout>3. 透切 AC (AlphaCutOut)</a></li><li><a href=#4-自定义混合-custom>4. 自定义混合 Custom</a></li></ul><ul><li><a href=#1-排序问题>1. 排序问题</a></li><li><a href=#2-贴图预乘问题>2. 贴图预乘问题</a></li><li><a href=#3-案例ghostflow>3. 案例GhostFlow</a></li><li><a href=#4-案例ghostwarp>4. 案例GhostWarp</a></li></ul><ul><li><a href=#火焰特效>火焰特效</a></li><li><a href=#水波纹特效>水波纹特效</a></li></ul><ul><li><a href=#screenuv>ScreenUV</a></li><li><a href=#screenwarp>ScreenWarp</a></li></ul><ul><li><a href=#181-序列帧动画原理>18.1 序列帧动画原理</a></li><li><a href=#182-极坐标动画polarcoord>18.2 极坐标动画（PolarCoord）</a></li></ul><ul><li><a href=#191-平移translation>19.1 平移（Translation）</a></li><li><a href=#192-缩放scale>19.2 缩放（Scale）</a></li><li><a href=#193-旋转rotation>19.3 旋转（Rotation）</a></li><li><a href=#194-复合动画animationghost>19.4 复合动画（AnimationGhost）</a></li></ul><ul><li><a href=#201-时钟指针动画>20.1 时钟指针动画</a></li><li><a href=#202-阴影投影pass>20.2 阴影投影Pass</a></li></ul><ul><li><a href=#211-灰度图与噪声控制消融>21.1 灰度图与噪声控制消融</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#1-透混-ab-alphablend>1. 透混 AB (AlphaBlend)</a></li><li><a href=#2-透叠-ad-additive>2. 透叠 AD (Additive)</a></li><li><a href=#3-透切-ac-alphacutout>3. 透切 AC (AlphaCutOut)</a></li><li><a href=#4-自定义混合-custom>4. 自定义混合 Custom</a></li></ul><ul><li><a href=#1-排序问题>1. 排序问题</a></li><li><a href=#2-贴图预乘问题>2. 贴图预乘问题</a></li><li><a href=#3-案例ghostflow>3. 案例GhostFlow</a></li><li><a href=#4-案例ghostwarp>4. 案例GhostWarp</a></li></ul><ul><li><a href=#火焰特效>火焰特效</a></li><li><a href=#水波纹特效>水波纹特效</a></li></ul><ul><li><a href=#screenuv>ScreenUV</a></li><li><a href=#screenwarp>ScreenWarp</a></li></ul><ul><li><a href=#181-序列帧动画原理>18.1 序列帧动画原理</a></li><li><a href=#182-极坐标动画polarcoord>18.2 极坐标动画（PolarCoord）</a></li></ul><ul><li><a href=#191-平移translation>19.1 平移（Translation）</a></li><li><a href=#192-缩放scale>19.2 缩放（Scale）</a></li><li><a href=#193-旋转rotation>19.3 旋转（Rotation）</a></li><li><a href=#194-复合动画animationghost>19.4 复合动画（AnimationGhost）</a></li></ul><ul><li><a href=#201-时钟指针动画>20.1 时钟指针动画</a></li><li><a href=#202-阴影投影pass>20.2 阴影投影Pass</a></li></ul><ul><li><a href=#211-灰度图与噪声控制消融>21.1 灰度图与噪声控制消融</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">13 透明特效相关的四种模式<div id=13-透明特效相关的四种模式 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#13-%e9%80%8f%e6%98%8e%e7%89%b9%e6%95%88%e7%9b%b8%e5%85%b3%e7%9a%84%e5%9b%9b%e7%a7%8d%e6%a8%a1%e5%bc%8f aria-label=Anchor>#</a></span></h1><h2 class="relative group">1. 透混 AB (AlphaBlend)<div id=1-透混-ab-alphablend class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#1-%e9%80%8f%e6%b7%b7-ab-alphablend aria-label=Anchor>#</a></span></h2><ul><li>###用途###：<ul><li>复杂轮廓、无明确边缘的物体</li><li>半透明物体</li><li>一般特效打底</li></ul></li><li>###优点###：移动端性能较好，边缘效果自然</li><li>###缺点###：有排序问题</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Shader</span> <span class=s>&#34;Zhuangdong/AP1/L07/L07_AB&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Properties</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>_MainTex</span> <span class=p>(</span><span class=s>&#34;RGB: 颜色 A: 透贴&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;white&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=nf>_Opacity</span> <span class=p>(</span><span class=s>&#34;透明度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Tags</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Queue&#34;</span> <span class=o>=</span> <span class=s>&#34;Transparent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=c1>//让透明物体最后渲染,防止出现后面物体消失的现象
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=s>&#34;RenderType&#34;</span> <span class=o>=</span> <span class=s>&#34;Transparent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;ForceNoShadowCasting&#34;</span> <span class=o>=</span> <span class=s>&#34;True&#34;</span><span class=c1>//关闭投影
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=s>&#34;IgnoreProject&#34;</span> <span class=o>=</span> <span class=s>&#34;True&#34;</span><span class=c1>//不影响投射器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Name</span> <span class=s>&#34;FORWARD&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>Tags</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ForwardBase&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>Blend</span> <span class=n>One</span> <span class=n>OneMinusSrcAlpha</span><span class=c1>//声明混合方式
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>CGPROGRAM</span> 
</span></span><span class=line><span class=cl>            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span> 
</span></span><span class=line><span class=cl>            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span> 
</span></span><span class=line><span class=cl>            <span class=err>#</span><span class=n>include</span> <span class=s>&#34;UnityCG.cginc&#34;</span> 
</span></span><span class=line><span class=cl>            <span class=err>#</span><span class=n>pragma</span> <span class=n>multi_compile_fwdbase_fullshadows</span>
</span></span><span class=line><span class=cl>            <span class=cp>#pragma target 3.0 
</span></span></span><span class=line><span class=cl><span class=cp></span>            <span class=n>uniform</span> <span class=n>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span> <span class=n>uniform</span> <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>uniform</span> <span class=n>half</span> <span class=n>_Opacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>struct</span> <span class=n>VertexInput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>float4</span> <span class=nl>vertex</span> <span class=p>:</span> <span class=n>POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float2</span> <span class=nl>uv0</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>            <span class=k>struct</span> <span class=n>VertexOutput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>float4</span> <span class=nl>pos</span> <span class=p>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float2</span> <span class=nl>uv0</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>            <span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=nf>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>,</span> <span class=n>_MainTex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> <span class=c1>//固定写法
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Opacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>FallBack</span> <span class=s>&#34;Diffuse&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 class="relative group">2. 透叠 AD (Additive)<div id=2-透叠-ad-additive class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#2-%e9%80%8f%e5%8f%a0-ad-additive aria-label=Anchor>#</a></span></h2><ul><li><p>###用途###：</p><ul><li>发光体、辉光表现</li><li>特效提亮</li></ul></li><li><p>###缺点###：</p><ul><li>有排序问题</li><li>多层叠加易OverDraw</li><li>作为辉光效果, 通常可用后处理代替</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB案例为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>pass</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=n>Blend</span> <span class=n>One</span> <span class=n>One</span>
</span></span><span class=line><span class=cl>        <span class=c1>//只需要把AB案例的BlendMode修改即可
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 class="relative group">3. 透切 AC (AlphaCutOut)<div id=3-透切-ac-alphacutout class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#3-%e9%80%8f%e5%88%87-ac-alphacutout aria-label=Anchor>#</a></span></h2><ul><li>###用途###：<ul><li>复杂轮廓、明确边缘（如树叶、头发、金属镂空）</li><li>卡通特效（配合抗锯齿）</li></ul></li><li>###优点###：无排序问题</li><li>###缺点###：边缘生硬，移动端性能较差</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB案例为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Tags</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;RenderType&#34;</span> <span class=o>=</span> <span class=s>&#34;TransparentCutout&#34;</span><span class=c1>//对应AC
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=s>&#34;ForceNoShadowCasting&#34;</span> <span class=o>=</span> <span class=s>&#34;True&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;IgnoreProject&#34;</span> <span class=o>=</span> <span class=s>&#34;True&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>pass</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>            <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>clip</span><span class=p>(</span><span class=n>opacity</span> <span class=o>-</span> <span class=n>_Cutoff</span><span class=p>);</span><span class=c1>//透明剪切
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 class="relative group">4. 自定义混合 Custom<div id=4-自定义混合-custom class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#4-%e8%87%aa%e5%ae%9a%e4%b9%89%e6%b7%b7%e5%90%88-custom aria-label=Anchor>#</a></span></h2><ul><li><p>###用途###：自定义混合公式，灵活实现特殊效果</p></li><li><p>###组合###: Src * SrcFactor op Dst * DstFactor</p></li><li><p>###元素###:</p><ul><li>Src 源, 当前Shader绘制结果</li><li>Dst 目标, 当前Shader绘制前的背景</li><li>SrcFactor 源乘子</li><li>DstFactor 目标乘子</li><li>op 混合运算符</li></ul><p>乘子决定相关元素以什么方式参与混合, 混合运算符决定混合的形式, 详细内容请查阅Unity官方文档</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=s>&#34;FORWARD&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Tags</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ForwardBase&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>BlendOp</span> <span class=p>[</span><span class=n>_BlendOp</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>Blend</span> <span class=p>[</span><span class=n>_BlendSrc</span><span class=p>]</span> <span class=p>[</span><span class=n>_BlendDst</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1>//在Tags后添加公式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span></code></pre></div><hr><h1 class="relative group">15 常见问题<div id=15-常见问题 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#15-%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 aria-label=Anchor>#</a></span></h1><h2 class="relative group">1. 排序问题<div id=1-排序问题 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#1-%e6%8e%92%e5%ba%8f%e9%97%ae%e9%a2%98 aria-label=Anchor>#</a></span></h2><ul><li>透明物体渲染时，前后关系不明确</li><li>###解决方法###：<ul><li>Detach/Attach（DDC软件修改模型顶点顺序）</li><li>ZWrite Off（关闭深度写入）</li></ul></li></ul><h2 class="relative group">2. 贴图预乘问题<div id=2-贴图预乘问题 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#2-%e8%b4%b4%e5%9b%be%e9%a2%84%e4%b9%98%e9%97%ae%e9%a2%98 aria-label=Anchor>#</a></span></h2><ul><li>有的贴图资产已做预乘（BaseColor * Alpha），有的没有，混合方式需区分<ul><li>AB模式：预乘用 <code>One OneMinusSrcAlpha</code>，不预乘用 <code>SrcAlpha OneMinusSrcAlpha</code>, 或在frag做乘法</li><li>AD模式：预乘可无A通道，不预乘需在frag做乘法</li></ul></li></ul><h2 class="relative group">3. 案例GhostFlow<div id=3-案例ghostflow class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#3-%e6%a1%88%e4%be%8bghostflow aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB为模板
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>Shader</span> <span class=s>&#34;Zhuangdong/AP1/L08/L08_GhostFlow&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Properties</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>_MainTex</span> <span class=p>(</span><span class=s>&#34;RGB: 颜色 A: 透贴&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;gray&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=nf>_Opacity</span> <span class=p>(</span><span class=s>&#34;透明度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>                <span class=nf>_WarpTex</span> <span class=p>(</span><span class=s>&#34;扭曲图&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;gray&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=nf>_WarpInt</span> <span class=p>(</span><span class=s>&#34;扭曲强度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>                <span class=nf>_NoiseInt</span><span class=p>(</span><span class=s>&#34;噪声强度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>                <span class=nf>_FlowSpeed</span> <span class=p>(</span><span class=s>&#34;流动速度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>...</span>
</span></span><span class=line><span class=cl>                <span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span>
</span></span><span class=line><span class=cl>                    <span class=n>Blend</span> <span class=n>One</span> <span class=n>OneMinusSrcAlpha</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span>
</span></span><span class=line><span class=cl>                    <span class=k>struct</span> <span class=n>VertexInput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>float4</span> <span class=nl>vertex</span> <span class=p>:</span> <span class=n>POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=k>struct</span> <span class=n>VertexOutput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>float4</span> <span class=nl>pos</span> <span class=p>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv0</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv1</span> <span class=p>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>uv1</span> <span class=o>=</span> <span class=nf>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>,</span> <span class=n>_WarpTex</span><span class=p>);</span> <span class=c1>//开启Tiling
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=n>o</span><span class=p>.</span><span class=n>uv1</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>o</span><span class=p>.</span><span class=n>uv1</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_FlowSpeed</span><span class=p>);</span><span class=c1>//启动V轴流动
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>half3</span> <span class=n>var_WarpTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_WarpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>half2</span> <span class=n>uvBias</span> <span class=o>=</span> <span class=p>(</span><span class=n>var_WarpTex</span><span class=p>.</span><span class=n>rg</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=n>_WarpInt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half2</span> <span class=n>uv0</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span> <span class=o>+</span> <span class=n>uvBias</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>uv0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>noise</span> <span class=o>=</span> <span class=nf>lerp</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>var_WarpTex</span><span class=p>.</span><span class=n>b</span> <span class=o>*</span> <span class=mf>2.0</span><span class=p>,</span> <span class=n>_NoiseInt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>noise</span> <span class=o>=</span> <span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>noise</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Opacity</span> <span class=o>*</span> <span class=n>noise</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>FallBack</span> <span class=s>&#34;Diffuse&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></div><hr><ul><li>###核心思路###：通过扰动贴图和流动速度参数，实现透明特效的动态变化</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>o</span><span class=p>.</span><span class=n>uv1</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>o</span><span class=p>.</span><span class=n>uv1</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_FlowSpeed</span><span class=p>);</span> <span class=c1>// V轴流动
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Opacity</span> <span class=o>*</span> <span class=n>noise</span><span class=p>;</span>
</span></span></code></pre></div><ul><li><code>_Time</code>：随时间递增的参数, 有x,y,z,w四个分量, 代表不同速度挡位</li><li><code>_FlowSpeed</code> 控制流动速度</li><li><code>frac</code> 取余, 这里是为了防止_Time无限增长导致出现摩尔纹</li><li><code>noise = lerp(1.0, var_WarpTex.b * 2.0, _NoiseInt)</code> 保证明度不变暗</li><li><code>_NoiseInt</code> 此参数数值越高, noise越清晰, 超过1时, noise对比度加强</li><li><code>max(0.0, noise)</code> 防止出现负值导致颜色异常</li></ul><h2 class="relative group">4. 案例GhostWarp<div id=4-案例ghostwarp class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#4-%e6%a1%88%e4%be%8bghostwarp aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以GhostFlow为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>half3</span> <span class=n>var_WarpTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_WarpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>half2</span> <span class=n>uvBias</span> <span class=o>=</span> <span class=p>(</span><span class=n>var_WarpTex</span><span class=p>.</span><span class=n>rg</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=n>_WarpInt</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>half2</span> <span class=n>uv0</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span> <span class=o>+</span> <span class=n>uvBias</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>uv0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><ul><li>###原理###：WarpTex的rg通道控制UV扰动方向，-0.5保证扰动均匀分布</li><li>###注意###：WarpInt过大时，扰动会很突兀. 这是明暗两边灰度值差异过大导致的</li></ul><hr><h1 class="relative group">14, 16 火焰与水波纹特效案例<div id=14-16-火焰与水波纹特效案例 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#14-16-%e7%81%ab%e7%84%b0%e4%b8%8e%e6%b0%b4%e6%b3%a2%e7%ba%b9%e7%89%b9%e6%95%88%e6%a1%88%e4%be%8b aria-label=Anchor>#</a></span></h1><h2 class="relative group">火焰特效<div id=火焰特效 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e7%81%ab%e7%84%b0%e7%89%b9%e6%95%88 aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以GhostFlow为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Shader</span> <span class=s>&#34;Zhuangdong/AP1/L09/L09_Fire&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Properties</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>_Mask</span> <span class=p>(</span><span class=s>&#34;R:外焰 G:内焰 B:透贴&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;blue&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=nf>_Noise</span> <span class=p>(</span><span class=s>&#34;R:Noise1 G:Noise2&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;gray&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=nf>_Noise1Params</span> <span class=p>(</span><span class=s>&#34;Noise1 x:大小 y:流速 z:强度&#34;</span><span class=p>,</span> <span class=n>vector</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nf>_Noise2Params</span> <span class=p>(</span><span class=s>&#34;Noise2 x:大小 y:流速 z:强度&#34;</span><span class=p>,</span> <span class=n>vector</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nf>_color1</span> <span class=p>(</span><span class=s>&#34;外焰颜色&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nf>_color2</span> <span class=p>(</span><span class=s>&#34;内焰颜色&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>...</span>
</span></span><span class=line><span class=cl>                <span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span>
</span></span><span class=line><span class=cl>                    <span class=n>Blend</span> <span class=n>One</span> <span class=n>OneMinusSrcAlpha</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>struct</span> <span class=n>VertexInput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>float4</span> <span class=nl>vertex</span> <span class=p>:</span> <span class=n>POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=k>struct</span> <span class=n>VertexOutput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>float4</span> <span class=nl>pos</span> <span class=p>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv0</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv1</span> <span class=p>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=nl>uv2</span> <span class=p>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>uv1</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span> <span class=o>*</span> <span class=n>_Noise1Params</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=nf>float2</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_Noise1Params</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=n>o</span><span class=p>.</span><span class=n>uv2</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span> <span class=o>*</span> <span class=n>_Noise2Params</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=nf>float2</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_Noise2Params</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>warpMask</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_Mask</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span><span class=p>).</span><span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>var_Noise1</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_Noise</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv1</span><span class=p>).</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>var_Noise2</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_Noise</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv2</span><span class=p>).</span><span class=n>g</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>noise</span> <span class=o>=</span> <span class=n>var_Noise1</span> <span class=o>*</span> <span class=n>_Noise1Params</span><span class=p>.</span><span class=n>z</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                                     <span class=n>var_Noise2</span> <span class=o>*</span> <span class=n>_Noise2Params</span><span class=p>.</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>float2</span> <span class=n>warpUV</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span> <span class=o>-</span> <span class=nf>float2</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>noise</span><span class=p>)</span> <span class=o>*</span> <span class=n>warpMask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half3</span> <span class=n>var_Mask</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_Mask</span><span class=p>,</span> <span class=n>warpUV</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>_color1</span> <span class=o>*</span> <span class=n>var_Mask</span><span class=p>.</span><span class=n>r</span> <span class=o>+</span> <span class=n>_color2</span> <span class=o>*</span> <span class=n>var_Mask</span><span class=p>.</span><span class=n>g</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_Mask</span><span class=p>.</span><span class=n>r</span> <span class=o>+</span> <span class=n>var_Mask</span><span class=p>.</span><span class=n>g</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>FallBack</span> <span class=s>&#34;Diffuse&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></div><ul><li>###原理###：两层Noise扰动叠加，控制火焰动态, 同时通过mask自定义内焰外焰的颜色</li><li>###关键点###：<ul><li><code>_NoiseParams.x</code> 控制Tiling</li><li><code>_NoiseParams.y</code> 控制速度</li><li><code>_NoiseParams.z</code> 控制扰动强度</li><li><code>float2(0,0, frac())</code> 如果v.uv - frac()的话, 纹理会往对角线方向流动, 这是因为frac会自动识别为float2(frac(), frac())</li></ul></li></ul><h2 class="relative group">水波纹特效<div id=水波纹特效 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#%e6%b0%b4%e6%b3%a2%e7%ba%b9%e7%89%b9%e6%95%88 aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以Fire为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Shader</span> <span class=s>&#34;Zhuangdong/AP1/L09/L09_Water&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Properties</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>_MainTex</span> <span class=p>(</span><span class=s>&#34;颜色贴图&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;white&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=nf>_WarpTex</span> <span class=p>(</span><span class=s>&#34;扰动图&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;gray&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=nf>_Speed</span> <span class=p>(</span><span class=s>&#34;x: 流速x y: 流速y&#34;</span><span class=p>,</span> <span class=n>vector</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>_Warp1Params</span> <span class=p>(</span><span class=s>&#34;Noise1 x: 大小 y: 流速x z: 流速y w: 强度&#34;</span><span class=p>,</span> <span class=n>vector</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>_Warp2Params</span> <span class=p>(</span><span class=s>&#34;Noise2 x: 大小 y: 流速x z: 流速y w: 强度&#34;</span><span class=p>,</span> <span class=n>vector</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Tags</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;RenderType&#34;</span> <span class=o>=</span> <span class=s>&#34;Opaque&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Name</span> <span class=s>&#34;FORWARD&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>Tags</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ForwardBase&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>...</span>
</span></span><span class=line><span class=cl>            <span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span> <span class=o>-</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_Speed</span><span class=p>);</span><span class=c1>//主贴图流动
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>o</span><span class=p>.</span><span class=n>uv1</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span> <span class=o>*</span> <span class=n>_Warp1Params</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_Warp1Params</span><span class=p>.</span><span class=n>yz</span><span class=p>);</span><span class=c1>//扰动贴图1流动
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>o</span><span class=p>.</span><span class=n>uv2</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span> <span class=o>*</span> <span class=n>_Warp2Params</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_Warp2Params</span><span class=p>.</span><span class=n>yz</span><span class=p>);</span><span class=c1>//扰动贴图2流动
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>float4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>half3</span> <span class=n>var_Warp1</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_WarpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv1</span><span class=p>).</span><span class=n>rgb</span><span class=p>;</span><span class=c1>//扰动值1
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>half3</span> <span class=n>var_Warp2</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_WarpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv2</span><span class=p>).</span><span class=n>rgb</span><span class=p>;</span><span class=c1>//扰动值2
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>half2</span> <span class=n>warp</span> <span class=o>=</span> <span class=p>(</span><span class=n>var_Warp1</span><span class=p>.</span><span class=n>xy</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=n>_Warp1Params</span><span class=p>.</span><span class=n>w</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                            <span class=p>(</span><span class=n>var_Warp2</span><span class=p>.</span><span class=n>xy</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=n>_Warp2Params</span><span class=p>.</span><span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float2</span> <span class=n>warpUV</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span> <span class=o>+</span> <span class=n>warp</span><span class=p>;</span><span class=c1>//添加扰动值
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>warpUV</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nf>float4</span><span class=p>(</span><span class=n>var_MainTex</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>FallBack</span> <span class=s>&#34;Diffuse&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>###原理###：主纹理UV加上两层扰动Noise，实现水面波动效果</li></ul><hr><h1 class="relative group">17 ScreenUV&amp;ScreenWarp<div id=17-screenuvscreenwarp class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#17-screenuvscreenwarp aria-label=Anchor>#</a></span></h1><h2 class="relative group">ScreenUV<div id=screenuv class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#screenuv aria-label=Anchor>#</a></span></h2><p>通过屏幕空间UV采样，实现纹理随摄像机距离变化和流动的特效。</p><p>关键在于用视空间坐标矫正畸变，并叠加流动效果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=n>float3</span> <span class=n>posVS</span> <span class=o>=</span> <span class=nf>UnityObjectToViewPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span><span class=c1>//顶点位置OS转VS
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>o</span><span class=p>.</span><span class=n>screenUV</span> <span class=o>=</span> <span class=n>posVS</span><span class=p>.</span><span class=n>xy</span> <span class=o>/</span> <span class=n>posVS</span><span class=p>.</span><span class=n>z</span><span class=p>;</span><span class=c1>//VS空间畸变矫正
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>float</span> <span class=n>originDist</span> <span class=o>=</span> <span class=nf>UnityObjectToViewPos</span><span class=p>(</span><span class=nf>float3</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>)).</span><span class=n>z</span><span class=p>;</span><span class=c1>//原点位置
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>o</span><span class=p>.</span><span class=n>screenUV</span> <span class=o>*=</span> <span class=n>originDist</span><span class=p>;</span> <span class=c1>//o.screenUV * originDist
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>o</span><span class=p>.</span><span class=n>screenUV</span> <span class=o>=</span> <span class=n>o</span><span class=p>.</span><span class=n>screenUV</span> <span class=o>*</span> <span class=n>_ScreenTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>-</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_ScreenTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>);</span><span class=c1>//增加tiling 和 offset 和 流动
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>half</span> <span class=n>var_ScreenTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_ScreenTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>screenUV</span><span class=p>).</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Opacity</span> <span class=o>*</span> <span class=n>var_ScreenTex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>###要点###:</p><ul><li><code>o.screenUV</code> 视空间矫正UV，防止深度畸变</li><li><code>originDist</code> 通过原点距离控制纹理缩放。</li><li><code>time</code> 叠加流动效果。</li></ul><h2 class="relative group">ScreenWarp<div id=screenwarp class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#screenwarp aria-label=Anchor>#</a></span></h2><p>利用 GrabPass 获取背景，通过主纹理的某个通道扰动屏幕UV，实现半透明区域的背景扭曲（类似PS正片叠底）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Shader</span> <span class=s>&#34;Zhuangdong/AP1/L10/L10_ScreenWarp&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Properties</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>_MainTex</span> <span class=p>(</span><span class=s>&#34;RGB: 颜色 A: 透贴&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;white&#34;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=nf>_Opacity</span> <span class=p>(</span><span class=s>&#34;透明度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>        <span class=nf>_WarpMidVal</span> <span class=p>(</span><span class=s>&#34;扭曲中间值&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>        <span class=nf>_WarpInt</span> <span class=p>(</span><span class=s>&#34;扭曲强度&#34;</span><span class=p>,</span> <span class=nf>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.2</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=n>GrabPass</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;_BGTex&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=n>uniform</span> <span class=n>sampler2D</span> <span class=n>_BGTex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>            <span class=k>struct</span> <span class=n>VertexOutput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>float4</span> <span class=nl>pos</span> <span class=p>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float2</span> <span class=nl>uv0</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float4</span> <span class=nl>grabPos</span> <span class=p>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span><span class=c1>//背景采样坐标
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>};</span>
</span></span><span class=line><span class=cl>            <span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=nf>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>,</span> <span class=n>_MainTex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>o</span><span class=p>.</span><span class=n>grabPos</span> <span class=o>=</span> <span class=nf>ComputeGrabScreenPos</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>pos</span><span class=p>);</span><span class=c1>//针对grabpass的背景纹理采样坐标
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>                <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>i</span><span class=p>.</span><span class=n>grabPos</span><span class=p>.</span><span class=n>xy</span> <span class=o>+=</span> <span class=p>(</span><span class=n>var_MainTex</span><span class=p>.</span><span class=n>b</span> <span class=o>-</span> <span class=n>_WarpMidVal</span><span class=p>)</span> <span class=o>*</span> <span class=n>_WarpInt</span> <span class=o>*</span> <span class=n>_Opacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>half3</span> <span class=n>var_BGTex</span> <span class=o>=</span> <span class=nf>tex2Dproj</span><span class=p>(</span><span class=n>_BGTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>grabPos</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//tex2Dproj是专门采样这类贴图的指令
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>var_BGTex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Opacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span></code></pre></div><p>###要点###:</p><ul><li><code>GrabPass</code> 获取背景并保存在BGTex中</li><li><code>WarpMidVal</code> 调整UV采样位置</li><li><code>_Opacity</code> 透明度和i.grabPos绑定,透明度越低, 扭曲越明显</li></ul><p>###同类方法###:</p><ul><li><code>GrabPass</code>: 适合高质量但性能开销大</li><li><code>CommandBuffer</code>: 前Srp时代管线自定义方法</li><li><code>Lwrp/Urp</code>: 后Srp时代管线自定义方法(推荐)</li></ul><h1 class="relative group">18. 序列帧动画（Sequence）<div id=18-序列帧动画sequence class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#18-%e5%ba%8f%e5%88%97%e5%b8%a7%e5%8a%a8%e7%94%bbsequence aria-label=Anchor>#</a></span></h1><h2 class="relative group">18.1 序列帧动画原理<div id=181-序列帧动画原理 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#181-%e5%ba%8f%e5%88%97%e5%b8%a7%e5%8a%a8%e7%94%bb%e5%8e%9f%e7%90%86 aria-label=Anchor>#</a></span></h2><p>在特效制作中，常用一张包含多帧的序列帧贴图，每一帧代表动画的一个状态。通过切换UV采样区域，实现动画播放效果。</p><ul><li>案例贴图为3行4列，每帧依次排列。</li><li>特效层悬浮于物体表面（通过顶点沿法线方向挤出）。</li><li>UV起点为左上，需调整初始采样区域。</li></ul><p>###关键代码：###</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//在AB案例基础上添加一个pass
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>pass</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=s>&#34;FORWARD&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Tags</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ForwardBase&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Blend</span> <span class=n>One</span> <span class=n>One</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>//顶点沿法线方向挤出
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span> <span class=o>+=</span> <span class=n>v</span><span class=p>.</span><span class=n>normal</span> <span class=o>*</span> <span class=mf>0.01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=nf>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv</span><span class=p>,</span> <span class=n>_Sequence</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//计算当前帧索引
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>float</span> <span class=n>id</span> <span class=o>=</span> <span class=nf>floor</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_Speed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>idV</span> <span class=o>=</span> <span class=nf>floor</span><span class=p>(</span><span class=n>id</span> <span class=o>/</span> <span class=n>_ColCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>idU</span> <span class=o>=</span> <span class=n>id</span> <span class=o>-</span> <span class=n>idV</span> <span class=o>*</span> <span class=n>_ColCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>stepU</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>_ColCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>stepV</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>_RowCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>//uv缩放并调整起点到左上
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>float2</span> <span class=n>initUV</span> <span class=o>=</span> <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>*</span> <span class=nf>float2</span><span class=p>(</span><span class=n>stepU</span><span class=p>,</span> <span class=n>stepV</span><span class=p>)</span> <span class=o>+</span> <span class=nf>float2</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>stepV</span> <span class=o>*</span> <span class=p>(</span><span class=n>_RowCount</span> <span class=o>-</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>initUV</span> <span class=o>+</span> <span class=nf>float2</span><span class=p>(</span><span class=n>idU</span> <span class=o>*</span> <span class=n>stepU</span><span class=p>,</span> <span class=o>-</span><span class=n>idV</span> <span class=o>*</span> <span class=n>stepV</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>half4</span> <span class=n>var_Sequence</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_Sequence</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>var_Sequence</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=n>var_Sequence</span><span class=p>.</span><span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>ENDCG</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>###要点总结：###</p><ul><li><code>floor</code>向下取整, 比如1.9输出1</li><li><code>id</code> 横向每次移动 <code>1/_ColCount</code></li><li><code>idV = floor(id / _ColCount)</code> 当id为列数的整数倍时, idV增加1</li><li><code>idU = id - idV * _ColCount</code>纵向每满一行移动 <code>1/_RowCount</code>, 同时idU清零</li><li><code>float2(idU * stepU, -idV * stepV)</code>每次移动<code>1/_ColCount</code>单位, 当移动次数等于<code>_ColCount</code>时, <code>idU</code>清零回到最左边, 同时纵向移动<code>1/_RowCount</code>单位</li></ul><p>###注###: 特效算法尽量简单，避免overdraw。</p><hr><h2 class="relative group">18.2 极坐标动画（PolarCoord）<div id=182-极坐标动画polarcoord class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#182-%e6%9e%81%e5%9d%90%e6%a0%87%e5%8a%a8%e7%94%bbpolarcoord aria-label=Anchor>#</a></span></h2><p>极坐标变换可实现径向流动、扫描等特效。通过将UV从笛卡尔坐标系转换为极坐标，并叠加时间流动，实现特殊动画效果。</p><p>###关键代码：###</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>half4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span> <span class=o>-</span> <span class=nf>float2</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>theta</span> <span class=o>=</span> <span class=nf>atan2</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>theta</span> <span class=o>=</span> <span class=n>theta</span> <span class=o>/</span> <span class=mf>3.1415926</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>p</span> <span class=o>=</span> <span class=nf>length</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span> <span class=o>+</span> <span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=nf>float2</span><span class=p>(</span><span class=n>theta</span><span class=p>,</span> <span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>half4</span> <span class=n>var_MainTex</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>half3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>half</span> <span class=n>opacity</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>r</span><span class=p>)</span> <span class=o>*</span> <span class=n>_Opacity</span> <span class=o>*</span> <span class=n>i</span><span class=p>.</span><span class=n>color</span><span class=p>.</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>half4</span><span class=p>(</span><span class=n>finalRGB</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>图片极坐标</p><p>###要点总结：###</p><p>图片atan2</p><ul><li><code>atan2</code> 计算角度θ, 结果为(-Π, Π), 归一化到[0,1]。</li></ul><p>图片length</p><ul><li><code>length</code> 决定了贴图采样的起始点</li><li><code>float2(theta, p)</code>UV映射到极坐标，实现径向动画。</li><li><code>i.color</code> 顶点色用于柔化边缘。</li></ul><hr><h1 class="relative group">19. 顶点动画（Vertex Animation）<div id=19-顶点动画vertex-animation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#19-%e9%a1%b6%e7%82%b9%e5%8a%a8%e7%94%bbvertex-animation aria-label=Anchor>#</a></span></h1><h2 class="relative group">19.1 平移（Translation）<div id=191-平移translation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#191-%e5%b9%b3%e7%a7%bbtranslation aria-label=Anchor>#</a></span></h2><p>通过正弦函数让顶点在Y轴方向周期性移动，实现整体上下浮动效果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=cp>#define TWO_PI 6.283185
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Translation</span> <span class=p>(</span><span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>_MoveRange</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_MoveSpeed</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>Translation</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###要点：###</p><ul><li><code>frac</code> FractionalPrat, 取小数部分, 保证时间参数在[0,1]循环，防止溢出。</li></ul><p>图片sin</p><ul><li><code>sin</code> sin(0, 2Π)是一个从0到1再到0的周期运动。</li></ul><hr><h2 class="relative group">19.2 缩放（Scale）<div id=192-缩放scale class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#192-%e7%bc%a9%e6%94%bescale aria-label=Anchor>#</a></span></h2><p>所有顶点按同一比例缩放.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>Scaling</span> <span class=p>(</span><span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*=</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=n>_ScaleRange</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_ScaleSpeed</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>Scaling</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=nf>TRANSFORM_TEX</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>,</span> <span class=n>_MainTex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###要点：###</p><ul><li>保证缩放值大于0，避免反向缩放。</li></ul><hr><h2 class="relative group">19.3 旋转（Rotation）<div id=193-旋转rotation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#193-%e6%97%8b%e8%bd%acrotation aria-label=Anchor>#</a></span></h2><p>顶点绕Y轴周期性旋转，实现摇头、摆动等效果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//以AB为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>Rotation</span> <span class=p>(</span><span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>angleY</span> <span class=o>=</span> <span class=n>_RotateRange</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_Rotatepeed</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>radY</span> <span class=o>=</span> <span class=nf>radians</span><span class=p>(</span><span class=n>angleY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>sinY</span><span class=p>,</span> <span class=n>cosY</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>sincos</span><span class=p>(</span><span class=n>radY</span><span class=p>,</span> <span class=n>sinY</span><span class=p>,</span> <span class=n>cosY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xz</span> <span class=o>=</span> <span class=nf>float2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>cosY</span> <span class=o>-</span> <span class=n>vertex</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>sinY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>sinY</span> <span class=o>+</span> <span class=n>vertex</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>cosY</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###要点：###</p><ul><li><code>radians</code> 角度转弧度, 弧度写法提升性能</li><li><code>sincos(raY, sinY, cosY)</code> 等价于sinY = sin(radY), cosY = cos(radY), 这种写法提高性能。</li><li><code>vertex.xz</code> 旋转矩阵 M (x * cosθ - y * sinθ, x * sinθ + y * cosθ)</li></ul><hr><h2 class="relative group">19.4 复合动画（AnimationGhost）<div id=194-复合动画animationghost class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#194-%e5%a4%8d%e5%90%88%e5%8a%a8%e7%94%bbanimationghost aria-label=Anchor>#</a></span></h2><p>将缩放、平移、旋转等多种动画结合，配合顶点色实现复杂运动（如幽灵、天使圈等）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=c1>//以AB为模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>AnimGhost</span> <span class=p>(</span><span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>,</span> <span class=n>inout</span> <span class=n>float3</span> <span class=n>color</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 天使圈缩放
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>float</span> <span class=n>scale</span> <span class=o>=</span> <span class=n>_ScaleParams</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>color</span><span class=p>.</span><span class=n>g</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_ScaleParams</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*=</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=n>scale</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>-=</span> <span class=n>_ScaleParams</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=o>-</span><span class=n>scale</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 幽灵摆动
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>float</span> <span class=n>swingX</span> <span class=o>=</span> <span class=n>_SwingXparams</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_SwingXparams</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>_SwingXparams</span><span class=p>.</span><span class=n>z</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>swingZ</span> <span class=o>=</span> <span class=n>_SwingZparams</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_SwingZparams</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>_SwingZparams</span><span class=p>.</span><span class=n>z</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xz</span> <span class=o>+=</span> <span class=nf>float2</span><span class=p>(</span><span class=n>swingX</span><span class=p>,</span> <span class=n>swingZ</span><span class=p>)</span> <span class=o>*</span> <span class=n>color</span><span class=p>.</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 幽灵摇头
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>float</span> <span class=n>radY</span> <span class=o>=</span> <span class=nf>radians</span><span class=p>(</span><span class=n>_ShakeYparams</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>color</span><span class=p>.</span><span class=n>r</span><span class=p>)</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_ShakeYparams</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>color</span><span class=p>.</span><span class=n>g</span> <span class=o>*</span> <span class=n>_ShakeYparams</span><span class=p>.</span><span class=n>z</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>sinY</span><span class=p>,</span> <span class=n>cosY</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>sincos</span><span class=p>(</span><span class=n>radY</span><span class=p>,</span> <span class=n>sinY</span><span class=p>,</span> <span class=n>cosY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xz</span> <span class=o>=</span> <span class=nf>float2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>cosY</span> <span class=o>-</span> <span class=n>vertex</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>sinY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>sinY</span> <span class=o>+</span> <span class=n>vertex</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>cosY</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 幽灵起伏
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>float</span> <span class=n>swingY</span> <span class=o>=</span> <span class=n>_SwingYparams</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=nf>sin</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>z</span> <span class=o>*</span> <span class=n>_SwingYparams</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>color</span><span class=p>.</span><span class=n>g</span> <span class=o>*</span> <span class=n>_SwingYparams</span><span class=p>.</span><span class=n>z</span><span class=p>)</span> <span class=o>*</span> <span class=n>TWO_PI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>swingY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理顶点色
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>float</span> <span class=n>lightness</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=n>color</span><span class=p>.</span><span class=n>g</span> <span class=o>*</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=n>scale</span> <span class=o>*</span> <span class=mf>2.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=nf>float3</span><span class=p>(</span><span class=n>lightness</span><span class=p>,</span> <span class=n>lightness</span><span class=p>,</span> <span class=n>lightness</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>###要点：###</p><ul><li><p>顶点色R、G通道分别控制不同动画区域。</p></li><li><p><code>vertex.y -= _ScaleParams.z * -scale</code></p><p>缩放动画是以模型原点为中心缩放的,</p><p>控制y轴缩放幅度, 避免天使圈离开原地</p></li><li><p><code>vertex.y * _SwingXparams.z</code></p><p>图片frac(time)</p><p>sin的的结果受vertex.y影响</p></li><li><p><code>_ShakeYoarams.z</code> <code>_SwingYparams.z</code>让天使环和其他部分的动画, 产生时间上的滞后</p></li><li><p><code>lightness</code> 光环亮度随time变化</p></li></ul><hr><h1 class="relative group">20. 时钟动画（ClockAnim）<div id=20-时钟动画clockanim class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#20-%e6%97%b6%e9%92%9f%e5%8a%a8%e7%94%bbclockanim aria-label=Anchor>#</a></span></h1><h2 class="relative group">20.1 时钟指针动画<div id=201-时钟指针动画 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#201-%e6%97%b6%e9%92%9f%e6%8c%87%e9%92%88%e5%8a%a8%e7%94%bb aria-label=Anchor>#</a></span></h2><p>通过C#脚本获取系统时间，驱动Shader中时针、分针、秒针的旋转，实现真实时钟动画。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=kt>float</span> <span class=n>angle</span><span class=p>,</span> <span class=kt>float</span> <span class=n>offset</span><span class=p>,</span> <span class=kt>float</span> <span class=n>mask</span><span class=p>,</span> <span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>-=</span> <span class=n>offset</span> <span class=o>*</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>radZ</span> <span class=o>=</span> <span class=nf>radians</span><span class=p>(</span><span class=n>angle</span> <span class=o>*</span> <span class=n>mask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>sinZ</span><span class=p>,</span> <span class=n>cosZ</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>sincos</span><span class=p>(</span><span class=n>radZ</span><span class=p>,</span> <span class=n>sinZ</span><span class=p>,</span> <span class=n>cosZ</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=nf>float2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>cosZ</span> <span class=o>-</span> <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>sinZ</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>sinZ</span> <span class=o>+</span> <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>cosZ</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>offset</span> <span class=o>*</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ClockAnim</span><span class=p>(</span><span class=n>float3</span> <span class=n>color</span><span class=p>,</span> <span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=n>_HourHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=n>_MinuteHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=n>_SecondHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>ClockAnim</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>color</span><span class=p>.</span><span class=n>rgb</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>###要点###:</p><ul><li><code>angle</code> 代表每个时间单位的旋转角度</li><li><code>offset</code> 偏移旋转中心. 初始中心在模型原点, 需要调整</li></ul><p>###C#脚本绑定系统时间：###</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HelloWorld</span> <span class=p>:</span> <span class=n>MonoBehaviour</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// --------- Public -------</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Material</span> <span class=n>clockMat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// --------- private --------</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>bool</span> <span class=n>valid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>hourAnglePropID</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>minuteAnglePropID</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>secondAnglePropID</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Start is called before the first frame update</span>
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=n>Start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>clockMat</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>hourAnglePropID</span> <span class=p>=</span> <span class=n>Shader</span><span class=p>.</span><span class=n>PropertyToID</span><span class=p>(</span><span class=s>&#34;_HourHandAngle&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>minuteAnglePropID</span> <span class=p>=</span> <span class=n>Shader</span><span class=p>.</span><span class=n>PropertyToID</span><span class=p>(</span><span class=s>&#34;_MinuteHandAngle&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>secondAnglePropID</span> <span class=p>=</span> <span class=n>Shader</span><span class=p>.</span><span class=n>PropertyToID</span><span class=p>(</span><span class=s>&#34;_SecondHandAngle&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>clockMat</span><span class=p>.</span><span class=n>HasProperty</span><span class=p>(</span><span class=n>hourAnglePropID</span><span class=p>)</span> <span class=p>&amp;&amp;</span> <span class=n>clockMat</span><span class=p>.</span><span class=n>HasProperty</span><span class=p>(</span><span class=n>minuteAnglePropID</span><span class=p>)</span> <span class=p>&amp;&amp;</span> <span class=n>clockMat</span><span class=p>.</span><span class=n>HasProperty</span><span class=p>(</span><span class=n>secondAnglePropID</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>valid</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;hourAnglePropID&#34;</span> <span class=p>+</span> <span class=n>hourAnglePropID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;minuteAnglePropID&#34;</span> <span class=p>+</span> <span class=n>minuteAnglePropID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;secondAnglePropID&#34;</span> <span class=p>+</span> <span class=n>secondAnglePropID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=n>valid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Update is called once per frame</span>
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=n>Update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(!</span><span class=n>valid</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>second</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Second</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>secondAngle</span> <span class=p>=</span> <span class=n>second</span> <span class=p>/</span><span class=m>60.0f</span> <span class=p>*</span> <span class=m>360.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>clockMat</span><span class=p>.</span><span class=n>SetFloat</span><span class=p>(</span><span class=n>secondAnglePropID</span><span class=p>,</span> <span class=n>secondAngle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>minute</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Minute</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>minuteAngle</span> <span class=p>=</span> <span class=n>minute</span> <span class=p>/</span><span class=m>60.0f</span> <span class=p>*</span> <span class=m>360.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>clockMat</span><span class=p>.</span><span class=n>SetFloat</span><span class=p>(</span><span class=n>minuteAnglePropID</span><span class=p>,</span> <span class=n>minuteAngle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>hour</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Hour</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>hourAngle</span> <span class=p>=</span> <span class=p>(</span><span class=n>hour</span> <span class=p>%</span> <span class=m>12</span><span class=p>)</span> <span class=p>/</span> <span class=m>12.0f</span> <span class=p>*</span> <span class=m>360.0f</span> <span class=p>+</span> <span class=n>minuteAngle</span> <span class=p>/</span> <span class=m>360.0f</span> <span class=p>*</span> <span class=m>30.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>clockMat</span><span class=p>.</span><span class=n>SetFloat</span><span class=p>(</span><span class=n>hourAnglePropID</span><span class=p>,</span> <span class=n>hourAngle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###要点：###</p><ul><li><p><code>继承</code> 编程术语, 可以让class直接使用其他class现存的方法</p></li><li><p><code>clockMat</code> 模型的材质, 继承自<code>MonoBehaviour</code>的class, 其脚本被允许附着在GameObject上, 并获取该GameObject的材质</p></li><li><p><code>%</code> 取余, 保证hour超过12时归0</p><p>余数 = 被除数 - (除数 * 整数商), 比如7/3 的余数 = 7 - (3 * 2) = 1</p></li></ul><hr><h2 class="relative group">20.2 阴影投影Pass<div id=202-阴影投影pass class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#202-%e9%98%b4%e5%bd%b1%e6%8a%95%e5%bd%b1pass aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=s>&#34;ShadowCaster&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Tags</span> <span class=p>{</span> <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ShadowCaster&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>CGPROGRAM</span>
</span></span><span class=line><span class=cl>    <span class=cp>#pragma vertex vert
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#pragma fragment frag
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#pragma multi_compile_shadowcaster
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#include</span> <span class=cpf>&#34;UnityCG.cginc&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>    <span class=n>uniform</span> <span class=kt>float</span> <span class=n>_HourHandAngle</span><span class=p>,</span> <span class=n>_MinuteHandAngle</span><span class=p>,</span> <span class=n>_SecondHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>appdata</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>float4</span> <span class=nl>vertex</span> <span class=p>:</span> <span class=n>POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>float3</span> <span class=nl>normal</span> <span class=p>:</span> <span class=n>NORMAL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>float3</span> <span class=nl>color</span> <span class=p>:</span> <span class=n>COLOR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>v2f</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>V2F_SHADOW_CASTER</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=kt>float</span> <span class=n>angle</span><span class=p>,</span> <span class=kt>float</span> <span class=n>offset</span><span class=p>,</span> <span class=kt>float</span> <span class=n>mask</span><span class=p>,</span> <span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>-=</span> <span class=n>offset</span> <span class=o>*</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>radZ</span> <span class=o>=</span> <span class=nf>radians</span><span class=p>(</span><span class=n>angle</span> <span class=o>*</span> <span class=n>mask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>sinZ</span><span class=p>,</span> <span class=n>cosZ</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>sincos</span><span class=p>(</span><span class=n>radZ</span><span class=p>,</span> <span class=n>sinZ</span><span class=p>,</span> <span class=n>cosZ</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=nf>float2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>cosZ</span> <span class=o>-</span> <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>sinZ</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>vertex</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>sinZ</span> <span class=o>+</span> <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>cosZ</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>offset</span> <span class=o>*</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>ClockAnim</span><span class=p>(</span><span class=n>float3</span> <span class=n>color</span><span class=p>,</span> <span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=n>_HourHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=n>_MinuteHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>RotateZwithOffset</span><span class=p>(</span><span class=n>_SecondHandAngle</span><span class=p>,</span> <span class=n>_RotateOffset</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>vertex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v2f</span> <span class=nf>vert</span><span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>ClockAnim</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>color</span><span class=p>.</span><span class=n>rgb</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 关键修复：计算带法线偏移的阴影坐标
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>float3</span> <span class=n>posWS</span> <span class=o>=</span> <span class=nf>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span><span class=c1>//动画后的顶点转世界空间
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>float3</span> <span class=n>normalWS</span> <span class=o>=</span> <span class=nf>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span><span class=c1>//法线转世界空间
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityClipSpaceShadowCasterPos</span><span class=p>(</span><span class=n>posWS</span><span class=p>,</span> <span class=n>normalWS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>SHADOW_CASTER_FRAGMENT</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###要点###</p><ul><li><p><code>ShadowCaster</code> 处理投影Pass的固定命名, 以及LightMode的固定模式</p></li><li><p><code>UnityClipSpaceShadowCasterPos(posWS, normalWS)</code> 法线偏移修正, 获得动画前的法线和动画后的顶点，来计算动画后的法线方向，最终输出动画后的顶点位置和修正后的法线在光源视锥体下的裁剪空间坐标</p></li><li><p><code>V2F_SHADOW_CASTER</code> Unity内置宏, 等价于:</p><ul><li>float4 pos : SV_POSITION</li><li>float3 vec : TEXCOORD0 (只在有点光源时使用)</li></ul></li><li><p><code>TRANSFER_SHADOW_CASTER_NORMALOFFSET(o)</code> 输入posWS, normalWS, 输出<code>V2F_SHADOW_CASTER</code></p></li><li><p><code>SHADOW_CASTER_FRAGMENT(i)</code> 输入pos, 根据光源类型处理投影</p></li></ul><p>###注###: 只需要 <code>ShadowCaster</code>, <code>V2F_SHADOW_CASTER</code>, <code>TRANSFER_SHADOW_CASTER_NORMALOFFSET(o)</code>, <code>SHADOW_CASTER_FRAGMENT(i)</code> 4个要素就能获得一个功能完整的阴影投射Pass</p><hr><h1 class="relative group">21. 特效消融动画案例<div id=21-特效消融动画案例 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#21-%e7%89%b9%e6%95%88%e6%b6%88%e8%9e%8d%e5%8a%a8%e7%94%bb%e6%a1%88%e4%be%8b aria-label=Anchor>#</a></span></h1><h2 class="relative group">21.1 灰度图与噪声控制消融<div id=211-灰度图与噪声控制消融 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#211-%e7%81%b0%e5%ba%a6%e5%9b%be%e4%b8%8e%e5%99%aa%e5%a3%b0%e6%8e%a7%e5%88%b6%e6%b6%88%e8%9e%8d aria-label=Anchor>#</a></span></h2><p>通过多通道灰度图、噪声图、顶点色，实现网格消失、随机性、发光等复杂消融特效。</p><p>###关键结构体与函数：###</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=n>VertexInput</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>vertex</span>  <span class=p>:</span> <span class=n>POSITION</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=n>float2</span> <span class=nl>uv0</span>     <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=n>float2</span> <span class=nl>uv1</span>     <span class=p>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>normal</span>  <span class=p>:</span> <span class=n>NORMAL</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>tangent</span> <span class=p>:</span> <span class=n>TANGENT</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>color</span> <span class=p>:</span> <span class=n>COLOR</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>VertexOutput</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>pos</span> <span class=p>:</span> <span class=n>SV_POSITION</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=n>float2</span> <span class=nl>uv0</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=n>float2</span> <span class=nl>uv1</span> <span class=p>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>posWS</span> <span class=p>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=n>float3</span> <span class=nl>nDirWS</span> <span class=p>:</span> <span class=n>TEXCOORD3</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=n>float3</span> <span class=nl>tDirWS</span> <span class=p>:</span> <span class=n>TEXCOORD4</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=n>float3</span> <span class=nl>bDirWS</span> <span class=p>:</span> <span class=n>TEXCOORD5</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nl>effectMask</span> <span class=p>:</span> <span class=n>TEXCOORD6</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=nf>LIGHTING_COORDS</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>float4</span> <span class=nf>CyberpunkAnim</span><span class=p>(</span><span class=kt>float</span> <span class=n>noise</span><span class=p>,</span> <span class=kt>float</span> <span class=n>mask</span><span class=p>,</span> <span class=n>float3</span> <span class=n>normal</span><span class=p>,</span> <span class=n>inout</span> <span class=n>float3</span> <span class=n>vertex</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>baseMask</span> <span class=o>=</span> <span class=nf>abs</span><span class=p>(</span><span class=nf>frac</span><span class=p>(</span><span class=n>vertex</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>_EffParams</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>_Time</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>_EffParams</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=mf>2.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>baseMask</span> <span class=o>=</span> <span class=nf>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>baseMask</span> <span class=o>*</span> <span class=mf>2.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>baseMask</span> <span class=o>+=</span> <span class=p>(</span><span class=n>noise</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=n>_EffParams</span><span class=p>.</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=n>effectMask</span> <span class=o>=</span> <span class=nf>float4</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>effectMask</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=nf>smoothstep</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=n>baseMask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>effectMask</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=nf>smoothstep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.7</span><span class=p>,</span> <span class=n>baseMask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>effectMask</span><span class=p>.</span><span class=n>z</span> <span class=o>=</span> <span class=nf>smoothstep</span><span class=p>(</span><span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=n>baseMask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>effectMask</span><span class=p>.</span><span class=n>w</span> <span class=o>=</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>vertex</span><span class=p>.</span><span class=n>xz</span> <span class=o>+=</span> <span class=n>normal</span><span class=p>.</span><span class=n>xz</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>effectMask</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>*</span> <span class=n>_EffParams</span><span class=p>.</span><span class=n>w</span> <span class=o>*</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>effectMask</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###顶点着色器：###</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>noise</span> <span class=o>=</span> <span class=nf>tex2Dlod</span><span class=p>(</span><span class=n>_EffectMap02</span><span class=p>,</span> <span class=nf>float4</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv1</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>)).</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>effectMask</span> <span class=o>=</span> <span class=nf>CyberpunkAnim</span><span class=p>(</span><span class=n>noise</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>color</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>uv0</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>uv1</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>posWS</span> <span class=o>=</span> <span class=nf>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>nDirWS</span> <span class=o>=</span> <span class=nf>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>tDirWS</span> <span class=o>=</span> <span class=nf>normalize</span><span class=p>(</span> <span class=nf>mul</span><span class=p>(</span> <span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=nf>float4</span><span class=p>(</span> <span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=mf>0.0</span> <span class=p>)</span> <span class=p>).</span><span class=n>xyz</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>bDirWS</span> <span class=o>=</span> <span class=nf>normalize</span><span class=p>(</span><span class=nf>cross</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>nDirWS</span><span class=p>,</span> <span class=n>o</span><span class=p>.</span><span class=n>tDirWS</span><span class=p>)</span> <span class=o>*</span> <span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>TRANSFER_VERTEX_TO_FRAGMENT</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###片段着色器:###</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>float4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span><span class=p>{</span> 
</span></span><span class=line><span class=cl><span class=c1>// ...（向量、光照、采样等略）...
</span></span></span><span class=line><span class=cl><span class=c1>//光照模型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>float3</span> <span class=n>baseCol</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_BaseColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span>  <span class=n>Lambert</span> <span class=o>=</span> <span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>nDotl</span><span class=p>);</span><span class=c1>//lambert
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>float</span> <span class=n>specCol</span> <span class=o>=</span> <span class=n>var_SpecTex</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>specpow</span> <span class=o>=</span> <span class=nf>lerp</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>_SpecularPow_Value</span><span class=p>,</span> <span class=n>var_SpecTex</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>float</span>   <span class=n>Phong</span> <span class=o>=</span> <span class=nf>pow</span><span class=p>(</span><span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>vDotr</span><span class=p>),</span> <span class=n>_SpecularPow_Value</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>shadow</span> <span class=o>=</span> <span class=nf>LIGHT_ATTENUATION</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>float3</span> <span class=n>dirlighting</span> <span class=o>=</span> <span class=p>(</span><span class=n>baseCol</span> <span class=o>*</span> <span class=n>Lambert</span> <span class=o>+</span> <span class=n>specCol</span> <span class=o>*</span> <span class=n>Phong</span><span class=p>)</span> <span class=o>*</span> <span class=n>_LightColor0</span> <span class=o>*</span> <span class=n>shadow</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=n>float3</span> <span class=n>EnvCol</span> <span class=o>=</span> <span class=nf>TriColAmbient</span><span class=p>(</span><span class=n>nDirWS</span><span class=p>,</span> <span class=n>_TopCol</span><span class=p>,</span> <span class=n>_MidCol</span><span class=p>,</span> <span class=n>_BotCol</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>fresnel</span> <span class=o>=</span> <span class=nf>pow</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>ndotv</span><span class=p>,</span> <span class=n>_FresnelPow</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>occlusion</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>a</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=n>float3</span> <span class=n>envLighting</span> <span class=o>=</span> <span class=p>(</span><span class=n>baseCol</span> <span class=o>*</span> <span class=n>EnvCol</span> <span class=o>*</span> <span class=n>_EnvDiffInt</span> <span class=o>+</span> <span class=n>var_Cubemap</span> <span class=o>*</span> <span class=n>fresnel</span><span class=o>*</span> <span class=n>_EnvSpecint</span> <span class=o>*</span> <span class=n>var_SpecTex</span><span class=p>.</span><span class=n>a</span><span class=p>)</span> <span class=o>*</span> <span class=n>occlusion</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//自发光
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>float3</span> <span class=n>emission</span> <span class=o>=</span> <span class=n>var_EmitTex</span> <span class=o>*</span> <span class=n>_EmitInt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>float3</span> <span class=n>_EffectMap01_var</span> <span class=o>=</span> <span class=nf>tex2D</span><span class=p>(</span><span class=n>_EffectMap01</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv1</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>meshMask</span> <span class=o>=</span> <span class=n>_EffectMap01_var</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>faceRandomMask</span> <span class=o>=</span> <span class=n>_EffectMap01_var</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>faceSlopMask</span> <span class=o>=</span> <span class=n>_EffectMap01_var</span><span class=p>.</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>smallMask</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>effectMask</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>midMask</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>effectMask</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>bigMask</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>effectMask</span><span class=p>.</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>baseMask</span> <span class=o>=</span> <span class=n>i</span><span class=p>.</span><span class=n>effectMask</span><span class=p>.</span><span class=n>w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>midOpacity</span> <span class=o>=</span> <span class=nf>saturate</span><span class=p>(</span><span class=nf>floor</span><span class=p>(</span><span class=nf>min</span><span class=p>(</span><span class=n>faceRandomMask</span><span class=p>,</span> <span class=mf>0.999999</span><span class=p>)</span> <span class=o>+</span> <span class=n>midMask</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>bigOpacity</span> <span class=o>=</span> <span class=nf>saturate</span><span class=p>(</span><span class=nf>floor</span><span class=p>(</span><span class=nf>min</span><span class=p>(</span><span class=n>faceSlopMask</span><span class=p>,</span> <span class=mf>0.999999</span><span class=p>)</span> <span class=o>+</span> <span class=n>bigMask</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>opacity</span> <span class=o>=</span> <span class=nf>lerp</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=nf>min</span><span class=p>(</span><span class=n>bigOpacity</span><span class=p>,</span> <span class=n>midOpacity</span><span class=p>),</span> <span class=n>baseMask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>float</span> <span class=n>meshEmitInt</span> <span class=o>=</span> <span class=p>(</span><span class=n>bigMask</span> <span class=o>-</span> <span class=n>smallMask</span><span class=p>)</span> <span class=o>*</span> <span class=n>meshMask</span><span class=p>;</span><span class=c1>//只在半透明的区域有发光效果
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>meshEmitInt</span> <span class=o>=</span> <span class=n>meshEmitInt</span> <span class=o>*</span> <span class=n>meshEmitInt</span> <span class=o>*</span> <span class=mf>2.0</span><span class=p>;</span><span class=c1>//进行固定值的power,让发光区域缩小
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>emission</span> <span class=o>+=</span> <span class=n>_EffCol</span> <span class=o>*</span> <span class=n>meshEmitInt</span> <span class=o>*</span> <span class=n>baseMask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>float3</span> <span class=n>FinalColor</span> <span class=o>=</span> <span class=n>dirlighting</span> <span class=o>+</span> <span class=n>envLighting</span> <span class=o>+</span> <span class=n>emission</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=nf>float4</span><span class=p>(</span><span class=n>FinalColor</span> <span class=o>*</span> <span class=n>opacity</span><span class=p>,</span> <span class=n>opacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>###要点:###</p><ul><li><code>EffMap01</code><ul><li>R - WireframeMap 记录模型线框</li><li>G - RandomGrayScale 记录基于面的随机灰度图</li><li>B - DisappearanceGrayscale 记录基于面的统一深度图</li></ul></li><li><code>EffMap02</code><ul><li>3DPerlinNoise</li></ul></li><li><code>mask</code> 顶点色, 让动画只作用于人物</li><li><code>baseMask = abs(frac(vertex.y * _EffParams.x - _Time.x * _EffParams.y) -0.5) * 2.0;</code><ul><li><code>frac(vertex.y)</code> 只取小数, 视觉表现为贴图 Gradient Linear 1</li><li><code>EffectParams.x</code> 控制Gradient Linear 1 Tiling</li><li><code>EffectParams.y</code> 控制动画速度和方向</li><li><code>abs(frac() -0.5) * 2.0</code> abs取绝对值, 最终结果将 Gradient Linear 1 转变成 Gradient Linear 3</li></ul></li><li><code>baseMask = min()</code> 增加取值为1的范围</li><li><code>baseMask += (noise - 0.5) * _EffParams.z;</code> 使baseMask取值非1的区域产生变化, <code>_EffParams.z</code>控制变化强度</li><li><code>smoothstep</code> 对指定区域进行波形调整</li><li><code>vertex.xz +=</code> 对透明部分进行动画, <code>EffParams.w</code>控制动画强度</li><li><code>floor</code> 小于1的取0, 大于1的取1</li><li><code>saturate</code> 限定值域为(0, 1)</li><li><code>meshEmitInt * meshEmitInt</code> 等价于Power = value^2</li></ul></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><a href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_forwardrendering/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_forwardrendering/>庄懂的技术美术入门课 - 前向渲染</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span>2160 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">11 mins</span></div></div><div class="py-1 prose dark:prose-invert"></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part3/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part3/>EssenceOfLinearAlgebra_Part3</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span>287 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">2 mins</span></div></div><div class="py-1 prose dark:prose-invert"></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part4/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part4/>EssenceOfLinearAlgebra_Part4</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span>553 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">3 mins</span></div></div><div class="py-1 prose dark:prose-invert"></div></div><div class="px-6 pt-4 pb-2"></div></div></a></section></div><script type=text/javascript src=/js/page.min.407e5b2727c1f241c95d53db24c776bea71bfc18e09511b815d669ad8caca6e9e18a53864ad364b1ccccfa2f2956768d33cfe193bfb64d3406f3b5ece354ba57.js integrity="sha512-QH5bJyfB8kHJXVPbJMd2vqcb/BjglRG4FdZprYyspunhilOGStNksczM+i8pVnaNM8/hk7+2TTQG87Xs41S6Vw==" data-oid="views_Notes/Courses/ZhuangDong'sTAIntroCourse/Zhuangdong_Note_VFXShader/index.md" data-oid-likes="likes_Notes/Courses/ZhuangDong'sTAIntroCourse/Zhuangdong_Note_VFXShader/index.md"></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Zhuangdong_Course_Note_LightingMap</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span></a></span><span><a class="flex text-right group ml-3" href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_forwardrendering/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">庄懂的技术美术入门课 - 前向渲染</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href title>Changelog</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2025 Runming Chen. All Rights Reserved.</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-index-500" data-url=https://rcrunming.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>