<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Zhuangdong_Course_Note_LightingMap &middot; Runming Chen</title>
  <meta name="title" content="Zhuangdong_Course_Note_LightingMap &middot; Runming Chen" />
  
  <meta name="description" content="Zhuangdong_Course_Note_LightingMap" />
  
  
  
  <link rel="canonical" href="https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.0c6dae116bf63812c1ff643378e6e081c16f70d12b83736b707756c7d83a333867f32fc561f3ba63e1694f0e168433bfd3199eef98816292295040edfcadb322.css"
    integrity="sha512-DG2uEWv2OBLB/2QzeObggcFvcNErg3NrcHdWx9g6Mzhn8y/FYfO6Y&#43;FpTw4WhDO/0xme75iBYpIpUEDt/K2zIg==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.6058b4918066fb5fe2087811b2e2da9b9c2f84df532b63b55f3724ab0ca025a3a7f956a75d3a6f363aa0cacd6bb27f5a61e02167fdd1c270e4dce9e1b62c6c66.js"
    integrity="sha512-YFi0kYBm&#43;1/iCHgRsuLam5wvhN9TK2O1XzckqwygJaOn&#43;VanXTpvNjqgys1rsn9aYeAhZ/3RwnDk3OnhtixsZg==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
  <script src="/lib/zoom/zoom.min.3530c2657381259433194af312ec3d322a97a2ad85661810299757fe793b24c3b8e07ab97fa8e5cf96cff1208f271e75394b6eaa56c2e39e7e2c3ca49fb1921c.js" integrity="sha512-NTDCZXOBJZQzGUrzEuw9MiqXoq2FZhgQKZdX/nk7JMO44Hq5f6jlz5bP8SCPJx51OUtuqlbC455&#43;LDykn7GSHA=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/">
  <meta property="og:site_name" content="Runming Chen">
  <meta property="og:title" content="Zhuangdong_Course_Note_LightingMap">
  <meta property="og:description" content="Zhuangdong_Course_Note_LightingMap">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
    <meta property="article:published_time" content="2025-05-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-05-31T00:00:00+00:00">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Zhuangdong_Course_Note_LightingMap">
  <meta name="twitter:description" content="Zhuangdong_Course_Note_LightingMap">

    
  
  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Notes",
    "name": "Zhuangdong_Course_Note_LightingMap",
    "headline": "Zhuangdong_Course_Note_LightingMap",
    "description": "Zhuangdong_Course_Note_LightingMap",
    
    "inLanguage": "en",
    "url" : "https:\/\/rcrunming.com\/notes\/courses\/zhuangdongstaintrocourse\/zhuangdong_note_lightingmap\/",
    "author" : {
      "@type": "Person",
      "name": "Runming"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-05-31T00:00:00\u002b00:00",
    "datePublished": "2025-05-31T00:00:00\u002b00:00",
    
    "dateModified": "2025-05-31T00:00:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1862"
  }]
  </script>


  
  
  <meta name="author" content="Runming" />
  
  
  

<script src="/lib/jquery/jquery.slim.min.03cb160e3cfdb2667a2e2c80d283bebcf63ff8bbc4b629c9ab2babf6fae1d0c07ad470edae783efa4fabda2ac01c58d60e63b98b3c336be8208460f08f4354f5.js" integrity="sha512-A8sWDjz9smZ6LiyA0oO&#43;vPY/&#43;LvEtinJqyur9vrh0MB61HDtrng&#43;&#43;k&#43;r2irAHFjWDmO5izwza&#43;gghGDwj0NU9Q=="></script>






















  
  

  <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-KLCF0CEN9Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KLCF0CEN9Z');
</script>





  
  
  
  
  <meta name="theme-color"/>
  
  

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a
      >
    </div>
    
    
      <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px] z-index-100">
  <div
    id="menu-blur"
    class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 padding-main-menu">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Runming Chen</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            
            
            
  <a
  href="/notes/"
  
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
  <p class="text-base font-medium" title="Notes">
    Notes
  </p>
</a>



            
            
  <a
  href="/portfolio/"
  
  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
  
  <p class="text-base font-medium" title="Portfolio">
    Portfolio
  </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class=" flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 padding-top-[5px]">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
  <a
    href="/notes/"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="Notes">
      Notes
    </p>
  </a>
</li>




                    

                    
  <li class="mt-1">
  <a
    href="/portfolio/"
    
    class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="Portfolio">
      Portfolio
    </p>
  </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>





  </div>
</div>


<script
  type="text/javascript"
  src="/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js"
  integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g=="
  data-target-id="menu-blur"></script>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  


  <article>
    
      
      
      
      
        
 
  
   
  
 



<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/background_13824845206636284721_hu_1fce84dd96a44c9c.jpg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>


<script type="text/javascript" src="/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js" integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g==" data-target-id="background-blur"></script>

      
    


    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Zhuangdong_Course_Note_LightingMap
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  

  
  
    
  

  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <span>1862 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">9 mins</span>
    

    
    
  </div>

  

  
  

  
  



      </div>

      
      
      
      
      

      

      

        

        

        

      

    </header>

    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
        <div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
          <div
            class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]
            
            ">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#221-烘焙前的设置">22.1 烘焙前的设置</a></li>
    <li><a href="#222-合批策略与烘焙过程分析">22.2 合批策略与烘焙过程分析</a></li>
  </ul>

  <ul>
    <li><a href="#231-外部烘焙流程">23.1 外部烘焙流程</a></li>
    <li><a href="#232-shader核心结构">23.2 Shader核心结构</a></li>
  </ul>

  <ul>
    <li><a href="#功能与文件结构">功能与文件结构</a></li>
    <li><a href="#全局参数简明说明">全局参数简明说明</a></li>
    <li><a href="#烘焙流程">烘焙流程</a></li>
  </ul>

  <ul>
    <li><a href="#类与继承-方法与生命周期">类与继承, 方法与生命周期</a></li>
    <li><a href="#lightmapsinfo">LightmapsInfo</a>
      <ul>
        <li><a href="#lightmapdata">LightmapData</a></li>
        <li><a href="#结构体和构造函数">结构体和构造函数</a></li>
        <li><a href="#构造函数的多种用法">构造函数的多种用法</a></li>
        <li><a href="#dictionary字典">Dictionary（字典）</a></li>
        <li><a href="#foreach-循环">foreach 循环</a></li>
      </ul>
    </li>
    <li><a href="#44-lightmapsbuffer-缓存">4.4 LightmapsBuffer 缓存</a>
      <ul>
        <li><a href="#1-lightmapsbuffer缓存的作用与实现">1. LightmapsBuffer：缓存的作用与实现</a></li>
        <li><a href="#2-清理缓存clearbuffer--clear">2. 清理缓存（ClearBuffer &amp; Clear）</a></li>
        <li><a href="#3-写入缓存writebuffer">3. 写入缓存（WriteBuffer）</a></li>
        <li><a href="#4-合成-lightmapcreatelightmaps">4. 合成 Lightmap（CreateLightmaps）</a></li>
        <li><a href="#5-保存-lightmapoverridelightmaps">5. 保存 Lightmap（OverrideLightmaps）</a></li>
        <li><a href="#6-烘焙模式bakemode与场景设置arrangebakescene">6. 烘焙模式（BakeMode）与场景设置（ArrangeBakeScene）</a></li>
        <li><a href="#7-执行烘焙bake与反射探头烘焙bakereflectprobe">7. 执行烘焙（Bake）与反射探头烘焙（BakeReflectProbe）</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1-编辑器类的基本结构">1. 编辑器类的基本结构</a></li>
    <li><a href="#2-功能按钮的绘制">2. 功能按钮的绘制</a></li>
    <li><a href="#3-全局参数的调节与监听">3. 全局参数的调节与监听</a></li>
  </ul>

  <ul>
    <li><a href="#1-基本结构">1. 基本结构</a></li>
    <li><a href="#2-获取当前材质">2. 获取当前材质</a></li>
    <li><a href="#3-使用默认-inspector-界面">3. 使用默认 Inspector 界面</a></li>
    <li><a href="#4-添加自发光gi开关">4. 添加自发光GI开关</a></li>
  </ul>

  <ul>
    <li><a href="#1-lightmap-uv-的标准计算">1. Lightmap UV 的标准计算</a></li>
    <li><a href="#2-metapass专用于烘焙的着色通道">2. MetaPass：专用于烘焙的着色通道</a></li>
    <li><a href="#分支控制shader_feature">分支控制（shader_feature）</a></li>
    <li><a href="#skybox-特殊说明">Skybox 特殊说明</a></li>
    <li><a href="#3-shadowcaster自定义投影-pass">3. ShadowCaster：自定义投影 Pass</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#221-烘焙前的设置">22.1 烘焙前的设置</a></li>
    <li><a href="#222-合批策略与烘焙过程分析">22.2 合批策略与烘焙过程分析</a></li>
  </ul>

  <ul>
    <li><a href="#231-外部烘焙流程">23.1 外部烘焙流程</a></li>
    <li><a href="#232-shader核心结构">23.2 Shader核心结构</a></li>
  </ul>

  <ul>
    <li><a href="#功能与文件结构">功能与文件结构</a></li>
    <li><a href="#全局参数简明说明">全局参数简明说明</a></li>
    <li><a href="#烘焙流程">烘焙流程</a></li>
  </ul>

  <ul>
    <li><a href="#类与继承-方法与生命周期">类与继承, 方法与生命周期</a></li>
    <li><a href="#lightmapsinfo">LightmapsInfo</a>
      <ul>
        <li><a href="#lightmapdata">LightmapData</a></li>
        <li><a href="#结构体和构造函数">结构体和构造函数</a></li>
        <li><a href="#构造函数的多种用法">构造函数的多种用法</a></li>
        <li><a href="#dictionary字典">Dictionary（字典）</a></li>
        <li><a href="#foreach-循环">foreach 循环</a></li>
      </ul>
    </li>
    <li><a href="#44-lightmapsbuffer-缓存">4.4 LightmapsBuffer 缓存</a>
      <ul>
        <li><a href="#1-lightmapsbuffer缓存的作用与实现">1. LightmapsBuffer：缓存的作用与实现</a></li>
        <li><a href="#2-清理缓存clearbuffer--clear">2. 清理缓存（ClearBuffer &amp; Clear）</a></li>
        <li><a href="#3-写入缓存writebuffer">3. 写入缓存（WriteBuffer）</a></li>
        <li><a href="#4-合成-lightmapcreatelightmaps">4. 合成 Lightmap（CreateLightmaps）</a></li>
        <li><a href="#5-保存-lightmapoverridelightmaps">5. 保存 Lightmap（OverrideLightmaps）</a></li>
        <li><a href="#6-烘焙模式bakemode与场景设置arrangebakescene">6. 烘焙模式（BakeMode）与场景设置（ArrangeBakeScene）</a></li>
        <li><a href="#7-执行烘焙bake与反射探头烘焙bakereflectprobe">7. 执行烘焙（Bake）与反射探头烘焙（BakeReflectProbe）</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1-编辑器类的基本结构">1. 编辑器类的基本结构</a></li>
    <li><a href="#2-功能按钮的绘制">2. 功能按钮的绘制</a></li>
    <li><a href="#3-全局参数的调节与监听">3. 全局参数的调节与监听</a></li>
  </ul>

  <ul>
    <li><a href="#1-基本结构">1. 基本结构</a></li>
    <li><a href="#2-获取当前材质">2. 获取当前材质</a></li>
    <li><a href="#3-使用默认-inspector-界面">3. 使用默认 Inspector 界面</a></li>
    <li><a href="#4-添加自发光gi开关">4. 添加自发光GI开关</a></li>
  </ul>

  <ul>
    <li><a href="#1-lightmap-uv-的标准计算">1. Lightmap UV 的标准计算</a></li>
    <li><a href="#2-metapass专用于烘焙的着色通道">2. MetaPass：专用于烘焙的着色通道</a></li>
    <li><a href="#分支控制shader_feature">分支控制（shader_feature）</a></li>
    <li><a href="#skybox-特殊说明">Skybox 特殊说明</a></li>
    <li><a href="#3-shadowcaster自定义投影-pass">3. ShadowCaster：自定义投影 Pass</a></li>
  </ul>
</nav>
  </div>
</details>



            
            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        



        <div class="article-content max-w-prose mb-20">
          
<h1 class="relative group">22. Unity内置LightingMap烘焙系统 
    <div id="22-unity内置lightingmap烘焙系统" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#22-unity%e5%86%85%e7%bd%aelightingmap%e7%83%98%e7%84%99%e7%b3%bb%e7%bb%9f" aria-label="Anchor">#</a>
    </span>        
    
</h1>

<h2 class="relative group">22.1 烘焙前的设置 
    <div id="221-烘焙前的设置" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#221-%e7%83%98%e7%84%99%e5%89%8d%e7%9a%84%e8%ae%be%e7%bd%ae" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ol>
<li>
<p>###设置天空盒###</p>
<ul>
<li>路径：Windows → Rendering → Lighting Settings → Skybox Material</li>
</ul>
</li>
<li>
<p>###场景物体设置为静态（Static）###</p>
<ul>
<li>启用 Contribute GI 和 Reflection Probe Static</li>
<li>各静态选项说明：
<ul>
<li>Contribute GI：响应全局光照</li>
<li>Occluder/Occludee Static：响应遮挡剔除（OccCulling）</li>
<li>Batching Static：合批优化</li>
<li>Navigation Static/Off Mesh Link Generation：导航相关</li>
<li>Reflection Probe Static：决定物体是否出现在反射探头记录中</li>
</ul>
</li>
</ul>
</li>
<li>
<p>###主平行光、自发光材质、反射探头设置###</p>
<ul>
<li>自发光材质 Global Illumination 设为 Baked，Color 设为 HDR</li>
</ul>
</li>
<li>
<p>###LightingMode 设置###</p>
<ul>
<li>路径：Windows → Rendering → Lighting Settings → MixedLighting → LightingMode</li>
<li>LightingMode 选项：
<ul>
<li>Baked Indirect</li>
<li>Subtractive</li>
<li>ShadowMask</li>
</ul>
</li>
<li>Directional Light Mode：
<ul>
<li>RealTime</li>
<li>Mixed</li>
<li>Baked</li>
</ul>
</li>
<li>ShadowMask Mode 需在 ProjectSetting → Quality → Shadow → Shadowmask Mode 开启<br>
###注###: ShadoeMask Mode 额外生成一张Shadowmask贴图</li>
</ul>
<p>###组合列表###:</p>
<ul>
<li>Bake Indirect
<ul>
<li>
<p>Runtime</p>
<p>LM = GI = EmitLighting + SkyLighting</p>
<p>投影: 实时投影</p>
</li>
<li>
<p>Mixed</p>
<p>LM = GI = EmitLighting + SkyLighting + LightsGI</p>
<p>投影: 实时投影</p>
</li>
<li>
<p>Baked</p>
<p>LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting</p>
<p>投影: 静态物: 投影写入LM 动态物: 无</p>
</li>
</ul>
</li>
<li>Subtractive
<ul>
<li>
<p>Runtime</p>
<p>LM = GI = EmitLighting + SkyLighting</p>
<p>投影: 实时投影, RealTime Shadow Color设置失效</p>
</li>
<li>
<p>Mixed</p>
<p>LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting</p>
<p>投影: 静态物: 投影写入LM 动态物: 实时; RealTime Shadow Color设置有效</p>
</li>
<li>
<p>Baked</p>
<p>LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting</p>
<p>投影: 静态物: 投影写入LM 动态物: 无; RealTime Shadow Color设置失效</p>
</li>
</ul>
</li>
<li>ShadowMask
<ul>
<li>
<p>Runtime</p>
<p>LM-light = GI = EmitLighting + SkyLighting</p>
<p>LM-shadowmask = null</p>
<p>投影: 实时投影</p>
</li>
<li>
<p>Mixed</p>
<p>LM-light = GI = EmitLighting + SkyLighting + LightsGI</p>
<p>LM-shadowmask = LightsShadow</p>
<p>投影: 静态物: 投影写入LM 动态物: 实时投影</p>
</li>
<li>
<p>Baked</p>
<p>LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting</p>
<p>LM-shadowmask = null</p>
<p>投影: 静态物: 投影写入LM 动态物: 无</p>
</li>
</ul>
</li>
</ul>
<p>###Lighting说明###:</p>
<ul>
<li>EmitLighting 代表发光材质造成的光照</li>
<li>SkyLighting 代表天空球造成的光照</li>
<li>LightsGI 代表主光造成的反弹光</li>
<li>LightsLighting 代表主光造成的光照</li>
<li>LM = Lightmap, DL = DirectLighting</li>
</ul>
<p>###注###: Subtractive和ShadowMask对动态物体的实时投影的处理不同</p>
<p>ShadowMask对动静态物的投影混合更自然</p>
</li>
<li>
<p>###Lightmapping Setting###</p>
<ul>
<li>Lightmapper: Progressive CPU</li>
<li>Lightmap Resolution: 40</li>
<li>Directional Mode: Non-Directional（一般不推荐, 效果不明显, 能耗翻倍）</li>
</ul>
</li>
</ol>
<p>###常见方案：###</p>
<ul>
<li>全实时光照：不需要Lightmap</li>
<li>全实时直接光照 + Baked Indirect</li>
<li>静态物体烘焙，动态物体实时（Subtractive/ShadowMask）</li>
<li>辅助光只用于烘焙（Baked/Mixed）Mixed决定是否影响动态物体</li>
<li>特效 RealTime</li>
</ul>
<hr>

<h2 class="relative group">22.2 合批策略与烘焙过程分析 
    <div id="222-合批策略与烘焙过程分析" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#222-%e5%90%88%e6%89%b9%e7%ad%96%e7%95%a5%e4%b8%8e%e7%83%98%e7%84%99%e8%bf%87%e7%a8%8b%e5%88%86%e6%9e%90" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>###定义###: 把渲染过程相同的几个批次的渲染合并起来, 节省资源, 增加速度</p>
<p>一般情况下, 共用Material, 参数相同才能合批</p>
<p>###常见策略###:</p>
<ul>
<li>Unity static设置</li>
<li>Unity SRPBatching (同Shader即可合批)</li>
<li>GPU Instancing</li>
<li>手动合批 (DDC软件内合并模型)</li>
</ul>
<p>###注###:
Windows → Analisis → FrameDebugger</p>
<p>FrameDebugger 可查看合批与渲染过程</p>
<hr>

<h1 class="relative group">23. 外部LightingMap烘焙与自定义Shader 
    <div id="23-外部lightingmap烘焙与自定义shader" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#23-%e5%a4%96%e9%83%a8lightingmap%e7%83%98%e7%84%99%e4%b8%8e%e8%87%aa%e5%ae%9a%e4%b9%89shader" aria-label="Anchor">#</a>
    </span>        
    
</h1>

<h2 class="relative group">23.1 外部烘焙流程 
    <div id="231-外部烘焙流程" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#231-%e5%a4%96%e9%83%a8%e7%83%98%e7%84%99%e6%b5%81%e7%a8%8b" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>使用3dsMax/MAYA烘焙LightingMap，需为模型创建UV2</li>
<li>贴图：
<ul>
<li>AO Map 代替SkyLighting</li>
<li>EmitLighting</li>
<li>LightsShadow</li>
<li>LightGI + LightsLighting</li>
<li>Alpha</li>
</ul>
</li>
<li>用SD的Blur HQ节点消除噪点，合并贴图节省资源</li>
</ul>
<p>###光照构成###</p>
<pre><code>    光照构成
                           -漫反射(Lambert)  -
          -简单光源-主平行光|                  |    -遮挡(LM)         -
         |                 -镜面反射(Phong)  -                        |
    光照-|                                                            |-结果
         |          -天光       -漫反射(Cubemap)   -遮挡(LM)-          |
          -复杂环境-|-自发光     -漫反射-(1Col)     -遮挡(LM)-          |        
                   |-其他环境光  -漫反射            -忽略               |
                   |                              -遮挡(SurfaceOcc)-  |
                                -镜面反射(Cubemap)|                 |- 
                                                  -衰减(Fresnel)   -
</code></pre>

<h2 class="relative group">23.2 Shader核心结构 
    <div id="232-shader核心结构" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#232-shader%e6%a0%b8%e5%bf%83%e7%bb%93%e6%9e%84" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Shader</span> <span class="s">&#34;Zhuangdong/AP1/L15/L15_LightingMap&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Properties</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ... 贴图与参数声明 ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">SubShader</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Tags</span> <span class="p">{</span> <span class="s">&#34;RenderType&#34;</span> <span class="o">=</span> <span class="s">&#34;Opaque&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Pass</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Name</span> <span class="s">&#34;FORWARD&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Tags</span> <span class="p">{</span> <span class="s">&#34;LightMode&#34;</span> <span class="o">=</span> <span class="s">&#34;ForwardBase&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">CGPROGRAM</span>
</span></span><span class="line"><span class="cl">            <span class="cp">#pragma vertex vert
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>            <span class="cp">#pragma fragment frag
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>            <span class="cp">#include</span> <span class="cpf">&#34;UnityCG.cginc&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>            <span class="c1">// ... 以orge案例为模板, 顶点着色器移除TRANSFER_VERTEX_TO_FRAGMENT(o) ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="n">VertexOutput</span> <span class="nf">vert</span><span class="p">(</span><span class="n">VertexInput</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">                    <span class="p">...</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">//案例需要2个uv, 这里将2个uv合并到一个float4, 节省TEXCOORD
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">o</span><span class="p">.</span><span class="n">uvs</span> <span class="o">=</span> <span class="nf">float4</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv0</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">uv1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="p">...</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">float3</span> <span class="nf">DecodeNormal</span> <span class="p">(</span><span class="n">float2</span> <span class="n">maskXY</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//贴图只有RG两个通道，我们要补上B通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float2</span> <span class="n">nDirTSxy</span> <span class="o">=</span> <span class="n">maskXY</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//贴图值域在(0,1),法线是向量，向量值域在(-1,1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">float</span> <span class="n">nDirTSz</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">nDirTSxy</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">nDirTSxy</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">nDirTSxy</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">nDirTSxy</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//sqrt取平方根,x平方+y平方+z平方=1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">return</span> <span class="nf">float3</span><span class="p">(</span><span class="n">nDirTSxy</span><span class="p">,</span> <span class="n">nDirTSz</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">float4</span> <span class="nf">frag</span><span class="p">(</span><span class="n">VertexOutput</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">COLOR</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ... 采样、向量、点乘 ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//提取表面信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">float</span> <span class="n">occlusion</span> <span class="o">=</span> <span class="n">var_MaskTex</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">matMask</span> <span class="o">=</span> <span class="n">var_MaskTex</span><span class="p">.</span><span class="n">g</span><span class="p">;</span><span class="c1">//金属贴图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">diffCol</span> <span class="o">=</span> <span class="n">var_MainTex</span><span class="p">.</span><span class="n">rgb</span> <span class="o">*</span> <span class="nf">lerp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">_MetalDarken</span><span class="p">,</span> <span class="nf">pow</span><span class="p">(</span><span class="n">matMask</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//这里给金属叠加_MetalDarken，降低金属部分的diff
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">float</span> <span class="n">specPow</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">_SpecParams</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">_SpecParams</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">matMask</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">specInt</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">_SpecParams</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">_SpecParams</span><span class="p">.</span><span class="n">w</span><span class="p">,</span> <span class="n">matMask</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">reflectMip</span> <span class="o">=</span> <span class="nf">clamp</span><span class="p">(</span><span class="nf">lerp</span><span class="p">(</span><span class="n">_EnvReflectParams</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">_EnvReflectParams</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">matMask</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//clamp即clamp(value,min,max)会将value限制在(min,max)中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">float</span> <span class="n">reflectInt</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">_EnvReflectParams</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">_EnvReflectParams</span><span class="p">.</span><span class="n">w</span><span class="p">,</span> <span class="n">matMask</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">fresnel</span> <span class="o">=</span> <span class="nf">lerp</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nf">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ndotv</span><span class="p">),</span> <span class="n">_FresnelPow</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">matMask</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//区分金属和非金属的Fresnel强度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//提取光照信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">float</span> <span class="n">skyLightOcc</span> <span class="o">=</span> <span class="n">var_LightMap</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">emitLightingInt</span> <span class="o">=</span> <span class="n">var_LightMap</span><span class="p">.</span><span class="n">g</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">mainLightGIInt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">var_LightMap</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="n">_GIpow</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">mainLightShadow</span> <span class="o">=</span> <span class="n">var_LightMap</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//采样纹理Cube
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">var_SkyCube</span> <span class="o">=</span> <span class="nf">texCUBElod</span><span class="p">(</span><span class="n">_SkyCube</span><span class="p">,</span> <span class="nf">float4</span><span class="p">(</span><span class="n">vrDirWS</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">)).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">float3</span> <span class="n">var_EnvCube</span> <span class="o">=</span> <span class="nf">texCUBElod</span><span class="p">(</span><span class="n">_EnvCube</span><span class="p">,</span> <span class="nf">float4</span><span class="p">(</span><span class="n">vrDirWS</span><span class="p">,</span> <span class="n">reflectMip</span><span class="p">)).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//MainLight
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//Diff
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">halfShadowCol</span> <span class="o">=</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">_HalfShadowCol</span><span class="p">.</span><span class="n">rgb</span><span class="p">,</span> <span class="n">_MainLightCol</span><span class="p">,</span> <span class="n">mainLightShadow</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//先给阴影和主光赋予颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">mainLightCol</span> <span class="o">=</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">_MainLightCol</span><span class="p">,</span> <span class="n">halfShadowCol</span><span class="p">,</span> <span class="n">_HalfShadowCol</span><span class="p">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">mainLightShadow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//再用投影mask去掉阴影颜色，留下的就是主光颜色和半影颜色，这里_HalfShadowCol.a控制半影强度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">mainLightDiff</span> <span class="o">=</span> <span class="n">diffCol</span> <span class="o">*</span> <span class="n">mainLightCol</span> <span class="o">*</span> <span class="nf">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">nDotl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//DiffCol*Lambert*MainLight
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//Spec
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">mainLightSpec</span> <span class="o">=</span> <span class="n">mainLightCol</span> <span class="o">*</span> <span class="nf">pow</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vDotr</span><span class="p">),</span> <span class="n">specPow</span><span class="p">)</span> <span class="o">*</span> <span class="n">specInt</span><span class="p">;</span><span class="c1">//Phong
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//GI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">mainLightGI</span> <span class="o">=</span> <span class="n">_GICol</span> <span class="o">*</span> <span class="n">occlusion</span> <span class="o">*</span> <span class="n">mainLightGIInt</span> <span class="o">*</span> <span class="n">_GIInt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//GI也就是主光的反弹光，这里叠加AO增加变化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//Mixed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">mainLight</span> <span class="o">=</span> <span class="p">(</span><span class="n">mainLightDiff</span> <span class="o">+</span> <span class="n">mainLightSpec</span> <span class="o">+</span> <span class="n">mainLightGI</span> <span class="o">*</span> <span class="n">_MainLightGIOn</span><span class="p">)</span> <span class="o">*</span> <span class="n">_MainLightOn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//这里GI已经有环境AO的信息了，所以不用*LM
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">                <span class="c1">//OtherLight
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">skyLightDiff</span> <span class="o">=</span> <span class="n">diffCol</span> <span class="o">*</span> <span class="n">var_SkyCube</span> <span class="o">*</span> <span class="n">_SkyCol</span> <span class="o">*</span> <span class="n">_SkyLightInt</span> <span class="o">*</span> <span class="n">skyLightOcc</span> <span class="o">*</span> <span class="n">occlusion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//这里是物体漫反射*天光漫反射*LM(LightingMap)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">emitLightDiff</span> <span class="o">=</span> <span class="n">diffCol</span> <span class="o">*</span> <span class="n">_EmissionCol</span> <span class="o">*</span> <span class="n">emitLightingInt</span> <span class="o">*</span> <span class="n">occlusion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//同上，这部分不受环境AO影响，所以不用*_SkyLightOcc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//OtherEnvSpec
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">float3</span> <span class="n">envLightSpec</span> <span class="o">=</span> <span class="n">var_EnvCube</span> <span class="o">*</span> <span class="n">reflectInt</span> <span class="o">*</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">occlusion</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">float3</span> <span class="n">OtherLight</span> <span class="o">=</span> <span class="n">skyLightDiff</span> <span class="o">*</span> <span class="n">_SkyLightOn</span> <span class="o">+</span> <span class="n">emitLightDiff</span> <span class="o">*</span> <span class="n">_EmitLightOn</span> <span class="o">+</span> <span class="n">envLightSpec</span> <span class="o">*</span> <span class="n">_EnvReflectOn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">float3</span> <span class="n">finalRGB</span> <span class="o">=</span> <span class="n">mainLight</span> <span class="o">+</span> <span class="n">OtherLight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nf">float4</span><span class="p">(</span><span class="n">finalRGB</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">ENDCG</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">FallBack</span> <span class="s">&#34;Diffuse&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>###关键参数说明###:</p>
<ul>
<li>_SpecParams
<ul>
<li>x: 非金属高光次幂</li>
<li>y: 非金属高光强度</li>
<li>z: 金属高光次幂</li>
<li>w: 金属高光强度</li>
</ul>
</li>
<li>_EnvReflectParams
<ul>
<li>x: 非金属Cube采样Mip值</li>
<li>y: 非金属反射强度</li>
<li>z: 金属Cube采样Mip值</li>
<li>w: 金属反射强度</li>
</ul>
</li>
</ul>
<p>###要点总结：###</p>
<ul>
<li>法线贴图只有RG，需手动补B通道</li>
<li>半影染色</li>
<li>金属/非金属参数分开控制高光、反射</li>
<li>根据光照构成合成光照</li>
</ul>
<hr>

<h1 class="relative group">24-26. LightingController自定义烘焙器与多脚本协作 
    <div id="24-26-lightingcontroller自定义烘焙器与多脚本协作" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#24-26-lightingcontroller%e8%87%aa%e5%ae%9a%e4%b9%89%e7%83%98%e7%84%99%e5%99%a8%e4%b8%8e%e5%a4%9a%e8%84%9a%e6%9c%ac%e5%8d%8f%e4%bd%9c" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>由于此案例代码内容过多, 讲解以摘要为主, 如需源代码请自行到教程处下载</p>

<h2 class="relative group">功能与文件结构 
    <div id="功能与文件结构" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e5%8a%9f%e8%83%bd%e4%b8%8e%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>###LightingController###：负责整个烘焙流程的主脚本。</li>
<li>###LightingControllerGUI###：自定义烘焙面板（UI），让操作更直观。</li>
<li>###EmissionShaderGUI###：让材质球在Inspector界面可以设置自发光参与GI。</li>
<li>###Building/EmitLight/Sky###：分别对应建筑、发光、天空球的Shader。</li>
</ul>
<hr>

<h2 class="relative group">全局参数简明说明 
    <div id="全局参数简明说明" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e5%85%a8%e5%b1%80%e5%8f%82%e6%95%b0%e7%ae%80%e6%98%8e%e8%af%b4%e6%98%8e" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>###MetalDarken###：金属部分的暗度（影响金属表面反光强度）。</li>
<li>###MainLightCol###：主光颜色。</li>
<li>###SpecParams###：高光参数（x/z为高光次幂，y/w为高光强度，分别对应金属/非金属）。</li>
<li>###SkyLightInt###：天光强度。</li>
<li>###ReflectParams###：反射参数（x/z为CubeMap Mip，y/w为反射强度）。</li>
<li>###FresnelPow###：菲涅尔现象的强度。</li>
<li>###EmissionCol###：自发光颜色。</li>
</ul>
<hr>

<h2 class="relative group">烘焙流程 
    <div id="烘焙流程" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e7%83%98%e7%84%99%e6%b5%81%e7%a8%8b" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ol>
<li>###收集场景烘焙信息###：包括贴图数量、路径、纹理对象</li>
<li>###创建缓存###：为主光、天光、自发光GI和最终合成的Lightmap分别准备缓存。</li>
<li>###烘焙###：依次烘焙主光、天光、自发光GI，每步结果都存入缓存。</li>
<li>###合成Lightmap###：把三步烘焙的结果合成一张最终Lightmap。</li>
<li>###替换旧Lightmap###：用新合成的Lightmap覆盖场景原有的光照贴图。</li>
<li>###重置场景光照环境###：修改场景设置。</li>
<li>###更新全局参数###：同步参数到所有相关材质。</li>
<li>###烘焙反射探头###：让反射效果也能正确显示。</li>
</ol>
<p>###核心代码示例：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">MultiBake</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LightmapsBuffer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bake</span><span class="p">(</span><span class="n">BakeMode</span><span class="p">.</span><span class="n">BakeMainLight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">info</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LightmapsInfo</span><span class="p">(</span><span class="n">LightmapSettings</span><span class="p">.</span><span class="n">lightmaps</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">.</span><span class="n">WriteBuffer</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">LightmapsBuffer</span><span class="p">.</span><span class="n">BufferType</span><span class="p">.</span><span class="n">MainLight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bake</span><span class="p">(</span><span class="n">BakeMode</span><span class="p">.</span><span class="n">BakeSkyLight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">.</span><span class="n">WriteBuffer</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">LightmapsBuffer</span><span class="p">.</span><span class="n">BufferType</span><span class="p">.</span><span class="n">SkyLight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bake</span><span class="p">(</span><span class="n">BakeMode</span><span class="p">.</span><span class="n">BakeEmissionGI</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">.</span><span class="n">WriteBuffer</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">LightmapsBuffer</span><span class="p">.</span><span class="n">BufferType</span><span class="p">.</span><span class="n">EmissionGI</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">.</span><span class="n">CreateLightmaps</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">.</span><span class="n">OverrideLightmaps</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">ArrangeBakeScene</span><span class="p">(</span><span class="n">BakeMode</span><span class="p">.</span><span class="n">Default</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">UpdateGlobalProperties</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">BakeReflectProbe</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>

<h1 class="relative group">LightingController 
    <div id="lightingcontroller" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#lightingcontroller" aria-label="Anchor">#</a>
    </span>        
    
</h1>

<h2 class="relative group">类与继承, 方法与生命周期 
    <div id="类与继承-方法与生命周期" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e7%b1%bb%e4%b8%8e%e7%bb%a7%e6%89%bf-%e6%96%b9%e6%b3%95%e4%b8%8e%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">public</span> <span class="n">class</span> <span class="nl">LightingController</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span></code></pre></div><ul>
<li>###class###：可以理解为“蓝图”，比如Shader是蓝图，Material是根据蓝图做出来的“物品”。</li>
<li>###继承（inheritance）###：比如“载具”是父类，“小轿车”是子类，子类自动拥有父类的基本功能。</li>
<li><code>MonoBehaviour</code>：Unity所有能挂在物体上的脚本都要继承它，才能参与游戏生命周期。</li>
<li><code>[ExecuteInEditMode]</code>: 一般情况下, 脚本只会在PlayMode下运行, 这个指令让脚本在预览窗口也会运行</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">private</span> <span class="kt">void</span> <span class="nf">OnEnable</span><span class="p">()</span> <span class="p">{</span><span class="nf">UpdateGlobalProperties</span><span class="p">();};</span>
</span></span></code></pre></div><ul>
<li>
<p><code>void</code> 不同于之前案例的方法, void类函数不返回值, 它主要用于执行特定操作.</p>
</li>
<li>
<p><code>OnEnable</code> 意味着这个函数在游戏生命周期的OnEnable阶段开始运行</p>
<p>###注###: UpdateGlobalProperties() 的方法写在OnEnable后面, 这在C#是允许的</p>
</li>
</ul>

<h2 class="relative group">LightmapsInfo 
    <div id="lightmapsinfo" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#lightmapsinfo" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>要了解以下概念, 才能理解LightmapsInfo的作用</p>
<p>LightmapData, 结构体 struct、构造函数、Dictionary（字典）和 foreach 循环</p>
<hr>

<h3 class="relative group">LightmapData 
    <div id="lightmapdata" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#lightmapdata" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>LightmapData[]是Unity的数据类型, 它是当前场景所有光照贴图的集合</li>
<li>lightmapsData是自定义名称, 代表LightmapData[], 用于函数内部操作</li>
<li>LightmapsData[]里面包含多个实例, 每个实例代表每张Lightingmap, 每个实例包含:
<ul>
<li>lightmapColor</li>
<li>lightmapDir</li>
<li>shadowMask</li>
<li>occlusionMask</li>
</ul>
</li>
</ul>

<h3 class="relative group">结构体和构造函数 
    <div id="结构体和构造函数" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e7%bb%93%e6%9e%84%e4%bd%93%e5%92%8c%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###结构体（struct）###：可以理解为一个“容器”，里面可以装不同类型的数据。</li>
<li>###语法### <code>public/private 名称(和class/struct同名) (类型, 参数名)</code></li>
<li>###构造函数###：用来初始化结构体（或类）的特殊函数，名字和结构体同名。</li>
</ul>
<p>###示例：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">struct</span> <span class="nc">LightmapsInfo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Texture2D</span><span class="p">&gt;</span> <span class="n">lightmapsInfo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">LightmapsInfo</span><span class="p">(</span><span class="n">LightmapData</span><span class="p">[]</span> <span class="n">lightmapsData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 这里会自动初始化所有内容</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">public</span> <span class="n">class</span> <span class="n">Person</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">public</span> <span class="n">string</span> <span class="n">Name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">public</span> <span class="kt">int</span> <span class="n">Age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">public</span> <span class="nf">Person</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>如果没有构造函数，你需要手动一项项赋值，非常繁琐。</li>
<li>有了构造函数，只需 <code>new LightmapsInfo(参数)</code>，所有内容自动安排好。</li>
</ul>
<hr>

<h3 class="relative group">构造函数的多种用法 
    <div id="构造函数的多种用法" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e7%9a%84%e5%a4%9a%e7%a7%8d%e7%94%a8%e6%b3%95" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>构造函数可以有多个，参数不同或方法不同即可。</li>
<li>还可以在构造函数里做参数检查，防止出错。</li>
</ul>
<p>###示例：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">LightmapsInfo</span><span class="p">(</span><span class="n">LightmapData</span><span class="p">[]</span> <span class="n">lightmapsData</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">lightmapsData</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 做一些容错处理</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 其他初始化内容</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>

<h3 class="relative group">Dictionary（字典） 
    <div id="dictionary字典" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#dictionary%e5%ad%97%e5%85%b8" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###Dictionary### 是一种“键值对”容器，可以通过“名字”快速找到对应的内容。</li>
<li>例如：<code>Dictionary&lt;string, Texture2D&gt;</code>，可以用字符串名字查找对应的贴图路径和对象。</li>
</ul>
<p>###案例：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Texture2D</span><span class="p">&gt;</span> <span class="n">myDict</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Texture2D</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">myDict</span><span class="p">[</span><span class="s">&#34;MainLight&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="n">mainLightTex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Texture2D</span> <span class="n">tex</span> <span class="p">=</span> <span class="n">myDict</span><span class="p">[</span><span class="s">&#34;MainLight&#34;</span><span class="p">];</span>
</span></span></code></pre></div><hr>

<h3 class="relative group">foreach 循环 
    <div id="foreach-循环" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#foreach-%e5%be%aa%e7%8e%af" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###foreach### 用于遍历集合（如数组、List、Dictionary等)</li>
</ul>
<p>###示例：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">//data代表实例</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">data</span> <span class="k">in</span> <span class="n">lightmapsData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">texture</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">lightmapColor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="p">=</span> <span class="n">AssetDatabase</span><span class="p">.</span><span class="n">GetAssetPath</span><span class="p">(</span><span class="n">texture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">lightmapsInfo</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">texture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span><span class="p">[]</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nf">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">num</span> <span class="n">in</span> <span class="n">numbers</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">num</span><span class="p">);</span> <span class="c1">// 输出：1, 2, 3, 4, 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><hr>

<h2 class="relative group">4.4 LightmapsBuffer 缓存 
    <div id="44-lightmapsbuffer-缓存" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#44-lightmapsbuffer-%e7%bc%93%e5%ad%98" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>在 Unity 的光照烘焙流程中，我们需要对不同类型的光照贴图进行缓存、合成和保存。</p>
<hr>

<h3 class="relative group">1. LightmapsBuffer：缓存的作用与实现 
    <div id="1-lightmapsbuffer缓存的作用与实现" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#1-lightmapsbuffer%e7%bc%93%e5%ad%98%e7%9a%84%e4%bd%9c%e7%94%a8%e4%b8%8e%e5%ae%9e%e7%8e%b0" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###缓存（Buffer）###：可以理解为“存储箱”，用来临时保存不同类型的光照贴图，方便后续处理和传递。</li>
<li>###枚举（enum）###：用来定义一组常量，让代码更清晰易懂。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">BufferType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MainLight</span><span class="p">,</span>  <span class="c1">// 主光光照: BufferA</span>
</span></span><span class="line"><span class="cl">    <span class="n">SkyLight</span><span class="p">,</span>   <span class="c1">// 天光光照: BufferB</span>
</span></span><span class="line"><span class="cl">    <span class="n">EmissionGI</span><span class="p">,</span> <span class="c1">// 自发光GI: BufferC</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lightmap</span>    <span class="c1">// 合成Lightmap</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 分别为不同类型的光照创建缓存</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Texture2D</span><span class="p">[]</span> <span class="n">_bufferA</span><span class="p">;</span>   <span class="c1">// 主光</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Texture2D</span><span class="p">[]</span> <span class="n">_bufferB</span><span class="p">;</span>   <span class="c1">// 天光</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Texture2D</span><span class="p">[]</span> <span class="n">_bufferC</span><span class="p">;</span>   <span class="c1">// 自发光</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Texture2D</span><span class="p">[]</span> <span class="n">_lightmap</span><span class="p">;</span>  <span class="c1">// 最终合成</span>
</span></span></code></pre></div><hr>

<h3 class="relative group">2. 清理缓存（ClearBuffer &amp; Clear） 
    <div id="2-清理缓存clearbuffer--clear" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#2-%e6%b8%85%e7%90%86%e7%bc%93%e5%ad%98clearbuffer--clear" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###switch-case###：根据不同类型（BufferType），执行不同的清理逻辑。</li>
<li>###void(类型 参数名)###：
<ul>
<li>如果是单个数据，参数名就是这个数据在函数内的临时名称</li>
<li>如果是集合，参数名就是这个集合在函数内的临时名称</li>
<li>如果是enum, 参数名就是enum内元素的临时名称。</li>
</ul>
</li>
</ul>
<hr>

<h3 class="relative group">3. 写入缓存（WriteBuffer） 
    <div id="3-写入缓存writebuffer" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#3-%e5%86%99%e5%85%a5%e7%bc%93%e5%ad%98writebuffer" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>先判断类型，若是最终 Lightmap 则直接返回。</li>
<li>清理对应类型的缓存。</li>
<li>创建新缓存，并从 info 中复制纹理。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="p">==</span> <span class="n">BufferType</span><span class="p">.</span><span class="n">Lightmap</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 清理缓存</span>
</span></span><span class="line"><span class="cl"><span class="n">ClearBuffer</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 创建缓存并从 info 复制纹理</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">lightmapsCount</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">lightmapsCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Texture2D</span><span class="p">[</span><span class="n">lightmapsCount</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">lightmapsCount</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">lightmap</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">lightmapsInfo</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">ElementAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Texture2D</span><span class="p">(</span><span class="n">lightmap</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">lightmap</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">lightmap</span><span class="p">.</span><span class="n">format</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Graphics</span><span class="p">.</span><span class="n">CopyTexture</span><span class="p">(</span><span class="n">lightmap</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>
<p><code>info.lightmapsInfo.Values.ElementAt(i)</code>：从字典中按顺序取出第 i 个贴图。</p>
</li>
<li>
<p><code>Texture2D(纹理宽度,高度,格式(默认RGB24),是否生成mipmap)</code></p>
</li>
<li>
<p><code>Graphics.CopyTexture</code>：Unity API，用于高效复制贴图数据。</p>
</li>
</ul>
<hr>

<h3 class="relative group">4. 合成 Lightmap（CreateLightmaps） 
    <div id="4-合成-lightmapcreatelightmaps" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#4-%e5%90%88%e6%88%90-lightmapcreatelightmaps" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>依次读取主光、天光、自发光三种缓存的像素，合成到一张新的 Lightmap 上。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">width</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">colA</span> <span class="p">=</span> <span class="n">_bufferA</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetPixel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">colB</span> <span class="p">=</span> <span class="n">_bufferB</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetPixel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">colC</span> <span class="p">=</span> <span class="n">_bufferC</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetPixel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">newCol</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Color</span><span class="p">(</span><span class="n">colA</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">colB</span><span class="p">.</span><span class="n">g</span><span class="p">,</span> <span class="n">colC</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">lightmap</span><span class="p">.</span><span class="n">SetPixel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">newCol</span><span class="p">.</span><span class="n">linear</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>每个像素点都从三张缓存贴图中取出对应颜色，合成到最终 Lightmap。</li>
<li>注意：缓存保存的是 Texture2D 对象，需要逐像素读取和写入。</li>
</ul>
<hr>

<h3 class="relative group">5. 保存 Lightmap（OverrideLightmaps） 
    <div id="5-保存-lightmapoverridelightmaps" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#5-%e4%bf%9d%e5%ad%98-lightmapoverridelightmaps" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>将合成好的 Lightmap 编码为 EXR 格式（支持 HDR），并写入磁盘。</li>
<li>刷新 Unity 资源数据库，让新文件被识别。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">lightmapsCount</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">bytes</span> <span class="p">=</span> <span class="n">_lightmap</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">EncodeToEXR</span><span class="p">(</span><span class="n">Texture2D</span><span class="p">.</span><span class="n">EXRFlags</span><span class="p">.</span><span class="n">CompressZIP</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">File</span><span class="p">.</span><span class="n">WriteAllBytes</span><span class="p">(</span><span class="n">lightmapsInfo</span><span class="p">.</span><span class="n">Keys</span><span class="p">.</span><span class="n">ElementAt</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">bytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">AssetDatabase</span><span class="p">.</span><span class="n">Refresh</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>EncodeToEXR</code>：Unity API，将贴图编码为 EXR 格式, EXR是Unity光照系统专用的格式</li>
<li><code>Texture2D.EXRFlags.CompressZip</code> 压缩为zip</li>
<li><code>File.WriteAllBytes</code>：.NET API，将字节数组写入文件。</li>
<li><code>lightmapsInfo.Keys.ElementAt(i)</code>从dictionary lightmapsInfo获取第i个key,即路径</li>
<li><code>AssetDatabase.Refresh()</code>：刷新资源数据库（仅编辑器模式下可用）。</li>
</ul>
<hr>

<h3 class="relative group">6. 烘焙模式（BakeMode）与场景设置（ArrangeBakeScene） 
    <div id="6-烘焙模式bakemode与场景设置arrangebakescene" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#6-%e7%83%98%e7%84%99%e6%a8%a1%e5%bc%8fbakemode%e4%b8%8e%e5%9c%ba%e6%99%af%e8%ae%be%e7%bd%aearrangebakescene" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###BakeMode###：用枚举定义不同的烘焙模式（全部、主光、天光、自发光）。</li>
<li>###ArrangeBakeScene###：根据不同模式设置场景参数，如环境光类型和强度。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">RenderSettings</span><span class="p">.</span><span class="n">ambientMode</span> <span class="p">=</span> <span class="n">AmbientMode</span><span class="p">.</span><span class="n">Skybox</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RenderSettings</span><span class="p">.</span><span class="n">ambientIntensity</span> <span class="p">=</span> <span class="m">1.0f</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li><code>ambientMode</code> 决定环境光类型（天空盒、渐变、单色）。</li>
<li><code>ambientIntensity</code> 控制环境光强度（烘焙后生效）。</li>
</ul>
<p>对应lightingSetting → lighting → Scene → Environment Lighting → Source &amp; Intensity Multiplier</p>
<p>设置主光为静态：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">staticFlags</span> <span class="p">=</span> <span class="n">StaticEditorFlags</span><span class="p">.</span><span class="n">ContributeGI</span> <span class="p">|</span> <span class="n">StaticEditorFlags</span><span class="p">.</span><span class="n">ReflectionProbeStatic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">GameObjectUtility</span><span class="p">.</span><span class="n">SetStaticEditorFlags</span><span class="p">(</span><span class="n">mainlight</span><span class="p">.</span><span class="n">gameObject</span><span class="p">,</span> <span class="n">staticFlags</span><span class="p">);</span>
</span></span></code></pre></div><hr>

<h3 class="relative group">7. 执行烘焙（Bake）与反射探头烘焙（BakeReflectProbe） 
    <div id="7-执行烘焙bake与反射探头烘焙bakereflectprobe" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#7-%e6%89%a7%e8%a1%8c%e7%83%98%e7%84%99bake%e4%b8%8e%e5%8f%8d%e5%b0%84%e6%8e%a2%e5%a4%b4%e7%83%98%e7%84%99bakereflectprobe" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>###Bake###：直接调用 Unity API 进行光照烘焙。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">Bake</span><span class="p">(</span><span class="n">BakeMode</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lightmapping</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lightmapping</span><span class="p">.</span><span class="n">Bake</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>###BakeReflectProbe###：遍历场景所有反射探头，逐个烘焙并保存。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">BakeReflectProbe</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">allProbe</span> <span class="p">=</span> <span class="n">FindObjectsOfType</span><span class="p">&lt;</span><span class="n">ReflectionProbe</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">probe</span> <span class="k">in</span> <span class="n">allProbe</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">path</span> <span class="p">=</span> <span class="n">AssetDatabase</span><span class="p">.</span><span class="n">GetAssetPath</span><span class="p">(</span><span class="n">probe</span><span class="p">.</span><span class="n">texture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lightmapping</span><span class="p">.</span><span class="n">BakeReflectionProbe</span><span class="p">(</span><span class="n">probe</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">AssetDatabase</span><span class="p">.</span><span class="n">Refresh</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>FindObjectsOfType&lt;&gt;()</code>：查找场景中所有反射探头。</li>
<li><code>AssetDatabase.GetAssetPath()</code>获取这些反射探头的贴图和路径</li>
<li><code>Lightmapping.BakeReflectionProbe()</code>：Unity API，烘焙反射探头。</li>
</ul>
<p>###注###: 如果不自定义存储路径的话, 反射探头烘焙出来的Cubemap默认存在LightingData中</p>
<hr>

<h1 class="relative group">4.5 LightingControllerGUI：自定义烘焙面板 
    <div id="45-lightingcontrollergui自定义烘焙面板" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#45-lightingcontrollergui%e8%87%aa%e5%ae%9a%e4%b9%89%e7%83%98%e7%84%99%e9%9d%a2%e6%9d%bf" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>在了解了烘焙流程和方法后，我们还需要一个###自定义的 UI 面板###，让烘焙操作和参数调整更加直观。下面介绍 LightingControllerGUI 的实现思路和关键代码。</p>
<hr>

<h2 class="relative group">1. 编辑器类的基本结构 
    <div id="1-编辑器类的基本结构" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#1-%e7%bc%96%e8%be%91%e5%99%a8%e7%b1%bb%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%bb%93%e6%9e%84" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>###UnityEditor.Editor###：自定义编辑器类必须继承自 <code>Editor</code>，并实现 <code>OnInspectorGUI()</code> 方法。</li>
<li>###OnInspectorGUI()###：用于绘制 Inspector 面板的内容。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">LightingControllerGUI</span> <span class="p">:</span> <span class="n">Editor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">OnInspectorGUI</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">controller</span> <span class="p">=</span> <span class="n">target</span> <span class="k">as</span> <span class="n">LightingController</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">controller</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">DrawFunctionButtons</span><span class="p">(</span><span class="n">controller</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">DrawGlobalProperties</span><span class="p">(</span><span class="n">controller</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>override</code> 当class中的方法被设定为virtual或abstract, 只能用override引用并重写执行的内容</li>
<li><code>target as LightingController</code>：获取当前 Inspector 绑定的对象，必须是 MonoBehaviour 派生类。</li>
<li><code>DrawFunctionButtons</code>：绘制烘焙相关的操作按钮。</li>
<li><code>DrawGlobalProperties</code>：绘制全局参数的调节控件。</li>
</ul>
<hr>

<h2 class="relative group">2. 功能按钮的绘制 
    <div id="2-功能按钮的绘制" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#2-%e5%8a%9f%e8%83%bd%e6%8c%89%e9%92%ae%e7%9a%84%e7%bb%98%e5%88%b6" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>使用 <code>GUILayout.Button(&quot;按钮名称&quot;)</code> 创建按钮，点击后执行对应方法。</li>
<li><code>EditorGUILayout.BeginHorizontal()</code> 和 <code>EndHorizontal()</code> 用于让多个按钮在同一行显示。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="s">&#34;禁术·多重烘培&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">controller</span><span class="p">.</span><span class="n">MultiBake</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">BeginHorizontal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 可以在这里添加更多按钮</span>
</span></span><span class="line"><span class="cl"><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">EndHorizontal</span><span class="p">();</span>
</span></span></code></pre></div><hr>

<h2 class="relative group">3. 全局参数的调节与监听 
    <div id="3-全局参数的调节与监听" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#3-%e5%85%a8%e5%b1%80%e5%8f%82%e6%95%b0%e7%9a%84%e8%b0%83%e8%8a%82%e4%b8%8e%e7%9b%91%e5%90%ac" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>使用 <code>EditorGUILayout.BeginFoldoutHeaderGroup</code> 创建可折叠的参数组。</li>
<li>用 <code>EditorGUILayout.Slider</code> 创建可拖拽的滑块，方便调整参数。</li>
<li>用 <code>EditorGUI.BeginChangeCheck()</code> 和 <code>EndChangeCheck()</code> 监听参数变化，变化时自动更新。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">EditorGUI</span><span class="p">.</span><span class="n">BeginChangeCheck</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">_groupAToggle</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">BeginFoldoutHeaderGroup</span><span class="p">(</span><span class="n">_groupAToggle</span><span class="p">,</span> <span class="s">&#34;材质属性&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">_groupAToggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//等价于if (groupAToggle == true)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">controller</span><span class="p">.</span><span class="n">metalDarken</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">Slider</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;金属压暗&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">controller</span><span class="p">.</span><span class="n">metalDarken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="m">0.0f</span><span class="p">,</span> <span class="m">5.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">EndFoldoutHeaderGroup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">EditorGUI</span><span class="p">.</span><span class="n">EndChangeCheck</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">controller</span><span class="p">.</span><span class="n">UpdateGlobalProperties</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">EditorUtility</span><span class="p">.</span><span class="n">SetDirty</span><span class="p">(</span><span class="n">controller</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>_groupAToggle</code>：用于控制折叠组的展开/收起，未赋值时默认为 <code>false</code>。</li>
<li><code>EditorUtility.SetDirty(controller)</code>：标记对象为“已修改”，确保参数变动能被 Unity 记录。</li>
</ul>
<hr>

<h1 class="relative group">EmissionShaderGUI：自定义自发光参数面板 
    <div id="emissionshadergui自定义自发光参数面板" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#emissionshadergui%e8%87%aa%e5%ae%9a%e4%b9%89%e8%87%aa%e5%8f%91%e5%85%89%e5%8f%82%e6%95%b0%e9%9d%a2%e6%9d%bf" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>通过自定义 <code>ShaderGUI</code>，我们可以让材质球的 Inspector 面板出现“开启自发光GI”的选项，方便控制自发光是否参与全局光照（GI）。</p>
<hr>

<h2 class="relative group">1. 基本结构 
    <div id="1-基本结构" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#1-%e5%9f%ba%e6%9c%ac%e7%bb%93%e6%9e%84" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>###继承 ShaderGUI###：自定义材质 Inspector 面板时，需要继承 <code>ShaderGUI</code> 类。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">EmissionShaderGUI</span> <span class="p">:</span> <span class="n">ShaderGUI</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 具体实现见下方</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>继承后，Unity 会自动获取使用该脚本的 Shader 和 Material 信息。</li>
</ul>
<hr>

<h2 class="relative group">2. 获取当前材质 
    <div id="2-获取当前材质" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#2-%e8%8e%b7%e5%8f%96%e5%bd%93%e5%89%8d%e6%9d%90%e8%b4%a8" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>通过 <code>materialEditor.target as Material</code> 获取当前正在编辑的材质实例。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">material</span> <span class="p">=</span> <span class="n">materialEditor</span><span class="p">.</span><span class="n">target</span> <span class="k">as</span> <span class="n">Material</span><span class="p">;</span>
</span></span></code></pre></div><hr>

<h2 class="relative group">3. 使用默认 Inspector 界面 
    <div id="3-使用默认-inspector-界面" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#3-%e4%bd%bf%e7%94%a8%e9%bb%98%e8%ae%a4-inspector-%e7%95%8c%e9%9d%a2" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>如果不需要自定义复杂的 UI，可以直接调用基类的 <code>OnGUI</code>，这样会显示默认的属性面板。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">base</span><span class="p">.</span><span class="n">OnGUI</span><span class="p">(</span><span class="n">materialEditor</span><span class="p">,</span> <span class="n">properties</span><span class="p">);</span>
</span></span></code></pre></div><hr>

<h2 class="relative group">4. 添加自发光GI开关 
    <div id="4-添加自发光gi开关" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#4-%e6%b7%bb%e5%8a%a0%e8%87%aa%e5%8f%91%e5%85%89gi%e5%bc%80%e5%85%b3" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>使用 <code>EditorGUILayout.Toggle</code> 创建一个勾选框，控制自发光是否参与全局光照。</li>
<li>Toggle有4个参数
<ul>
<li>label 文本内容</li>
<li>value 条件</li>
<li>style 按键风格</li>
<li>option 按键尺寸</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">ifEmissionGIOn</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="n">Toggle</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;开启自发光GI&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">material</span><span class="p">.</span><span class="n">globalIlluminationFlags</span> <span class="p">==</span> <span class="n">MaterialGlobalIlluminationFlags</span><span class="p">.</span><span class="n">AnyEmissive</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">material</span><span class="p">.</span><span class="n">globalIlluminationFlags</span> <span class="p">=</span> <span class="n">ifEmissionGIOn</span>
</span></span><span class="line"><span class="cl">    <span class="p">?</span> <span class="n">MaterialGlobalIlluminationFlags</span><span class="p">.</span><span class="n">AnyEmissive</span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span> <span class="n">MaterialGlobalIlluminationFlags</span><span class="p">.</span><span class="n">EmissiveIsBlack</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li><code>EditorGUILayout.Toggle(&quot;界面文本&quot;, 条件)</code>：根据条件显示勾选状态。</li>
<li>三元运算符 <code>条件 ? 结果A : 结果B</code>，等价于 if-else 语句：</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ifEmissionGIOn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">material</span><span class="p">.</span><span class="n">globalIlluminationFlags</span> <span class="p">=</span> <span class="n">MaterialGlobalIlluminationFlags</span><span class="p">.</span><span class="n">AnyEmissive</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="n">material</span><span class="p">.</span><span class="n">globalIlluminationFlags</span> <span class="p">=</span> <span class="n">MaterialGlobalIlluminationFlags</span><span class="p">.</span><span class="n">EmissiveIsBlack</span><span class="p">;</span>
</span></span></code></pre></div><hr>

<h1 class="relative group">Shader 讲解与案例分析 
    <div id="shader-讲解与案例分析" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#shader-%e8%ae%b2%e8%a7%a3%e4%b8%8e%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>在本案例中，Shader 与其他案例相比有以下几个关键差别：</p>
<ul>
<li>Lightmap UV 的计算方式</li>
<li>MetaPass 的实现</li>
<li>分支声明（shader_feature）</li>
<li>ShadowCaster 的自定义</li>
</ul>
<hr>

<h2 class="relative group">1. Lightmap UV 的标准计算 
    <div id="1-lightmap-uv-的标准计算" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#1-lightmap-uv-%e7%9a%84%e6%a0%87%e5%87%86%e8%ae%a1%e7%ae%97" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>在 Unity 中，Lightmap 的 UV 坐标通常这样计算：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">float2</span> <span class="n">lmUV</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv1</span><span class="p">.</span><span class="n">xy</span> <span class="p">*</span> <span class="n">unity_LightmapST</span><span class="p">.</span><span class="n">xy</span> <span class="p">+</span> <span class="n">unity_LightmapST</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li><code>uv1</code> 是模型的第二套 UV（专门用于光照贴图）。</li>
<li><code>unity_LightmapST</code> 是 Unity 自动传入的缩放/偏移参数。</li>
</ul>
<hr>

<h2 class="relative group">2. MetaPass：专用于烘焙的着色通道 
    <div id="2-metapass专用于烘焙的着色通道" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#2-metapass%e4%b8%93%e7%94%a8%e4%ba%8e%e7%83%98%e7%84%99%e7%9a%84%e7%9d%80%e8%89%b2%e9%80%9a%e9%81%93" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>MetaPass 是 Unity 光照烘焙系统专用的 Shader 通道。只有带有 MetaPass 的 Shader 才能参与到光照烘焙。</p>
<p>###案例代码（Building.Shader 的 MetaPass）：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Pass</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="s">&#34;META&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tags</span> <span class="p">{</span> <span class="s">&#34;LightMode&#34;</span> <span class="o">=</span> <span class="s">&#34;Meta&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">CGPROGRAM</span>
</span></span><span class="line"><span class="cl">    <span class="cp">#pragma vertex vert
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#pragma fragment frag
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#include</span> <span class="cpf">&#34;UnityCG.cginc&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#include</span> <span class="cpf">&#34;UnityMetaPass.cginc&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#pragma shader_feature __ _BAKE_MAINLIGHT _BAKE_SKYLIGHT _BAKE_EMISSIONGI
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">VertexInput</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">float4</span> <span class="nl">vertex</span>   <span class="p">:</span> <span class="n">POSITION</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">float2</span> <span class="nl">uv0</span>      <span class="p">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">float2</span> <span class="nl">uv1</span>      <span class="p">:</span> <span class="n">TEXCOORD1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">float2</span> <span class="nl">uv2</span>      <span class="p">:</span> <span class="n">TEXCOORD2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">VertexOutput</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">float4</span> <span class="nl">pos</span> <span class="p">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">float2</span> <span class="nl">uv</span> <span class="p">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">VertexOutput</span> <span class="nf">vert</span> <span class="p">(</span><span class="n">VertexInput</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">VertexOutput</span> <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">VertexOutput</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="nf">UnityMetaVertexPosition</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">uv1</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">uv2</span><span class="p">,</span> <span class="n">unity_LightmapST</span><span class="p">,</span> <span class="n">unity_DynamicLightmapST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">float4</span> <span class="nf">frag</span><span class="p">(</span><span class="n">VertexOutput</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">COLOR</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">UnityMetaInput</span> <span class="n">metaIN</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">UNITY_INITIALIZE_OUTPUT</span><span class="p">(</span><span class="n">UnityMetaInput</span><span class="p">,</span> <span class="n">metaIN</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">metaIN</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="nf">Luminance</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">).</span><span class="n">rgb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">metaIN</span><span class="p">.</span><span class="n">SpecularColor</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">metaIN</span><span class="p">.</span><span class="n">Emission</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">UnityMetaFragment</span><span class="p">(</span><span class="n">metaIN</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">ENDCG</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>###要点说明：###</p>
<ul>
<li><code>UnityStandardMeta.cgnic</code> PBR流程META Pass专用</li>
<li><code>UnityMetaPass.cginc</code> 属于<code>UnityStandardMeta.cgnic</code>的一部分, 由于案例不是PBR流程, 出于优化的考虑, 只引用该cginc. 相比 <code>UnityStandardMeta.cgnic</code>需要自定义顶点着色器部分</li>
<li><code>UnityMetaVertexPosition</code>：将顶点和 UV 转换到烘焙空间。</li>
<li><code>UnityMetaInput</code>：包含 Albedo、SpecularColor、Emission 等烘焙所需数据的数组。</li>
<li><code>UNITY_INITIALIZE_OUTPUT</code>初始化<code>UnityMetaInput</code></li>
<li><code>Luminance</code>：将颜色转为灰度，保证烘焙时只考虑明暗，不受高光和自发光影响。</li>
</ul>
<hr>

<h2 class="relative group">分支控制（shader_feature） 
    <div id="分支控制shader_feature" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#%e5%88%86%e6%94%af%e6%8e%a7%e5%88%b6shader_feature" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">//LightingController.cs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="n">BakeMode</span><span class="p">.</span><span class="nl">Default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 关闭主光
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mainlight</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 设置环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">RenderSettings</span><span class="p">.</span><span class="n">ambientMode</span> <span class="o">=</span> <span class="n">AmbientMode</span><span class="p">.</span><span class="n">Skybox</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">RenderSettings</span><span class="p">.</span><span class="n">ambientIntensity</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 设置Shader全局分支
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Shader</span><span class="p">.</span><span class="nf">DisableKeyword</span><span class="p">(</span><span class="s">&#34;_BAKE_MAINLIGHT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Shader</span><span class="p">.</span><span class="nf">DisableKeyword</span><span class="p">(</span><span class="s">&#34;_BAKE_SKYLIGHT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Shader</span><span class="p">.</span><span class="nf">DisableKeyword</span><span class="p">(</span><span class="s">&#34;_BAKE_EMISSIONGI&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#pragma shader_feature __ _BAKE_MAINLIGHT _BAKE_SKYLIGHT _BAKE_EMISSIONGI
</span></span></span></code></pre></div><ul>
<li>需要在脚本和Shader 设置全局分支</li>
<li>通过分支声明，可以让 Shader 针对不同烘焙模式输出不同内容。</li>
<li>在代码中用 <code>#if defined(...)</code> 进行分支判断：</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#if defined (_BAKE_EMISSIONGI)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="n">metaIN</span><span class="p">.</span><span class="n">Emission</span> <span class="o">=</span> <span class="n">opacity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined (_BAKE_MAINLIGHT) || defined (_BAKE_SKYLIGHT)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="n">metaIN</span><span class="p">.</span><span class="n">Emission</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span></code></pre></div><hr>

<h2 class="relative group">Skybox 特殊说明 
    <div id="skybox-特殊说明" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#skybox-%e7%89%b9%e6%ae%8a%e8%af%b4%e6%98%8e" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>Skybox 的 Shader 不需要 MetaPass，Unity 内部会自动处理天空盒的光照烘焙。</li>
</ul>
<hr>

<h2 class="relative group">3. ShadowCaster：自定义投影 Pass 
    <div id="3-shadowcaster自定义投影-pass" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#3-shadowcaster%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8a%95%e5%bd%b1-pass" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>由于本案例场景是非封闭盒状，且法线朝内，Unity 默认的 ShadowCaster 不能正确投影。需要自定义 ShadowCaster Pass。</p>
<p>###案例代码：###</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Pass</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="s">&#34;ShadowCaster&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tags</span> <span class="p">{</span> <span class="s">&#34;LightMode&#34;</span> <span class="o">=</span> <span class="s">&#34;ShadowCaster&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">ZWrite</span> <span class="n">On</span> <span class="n">ZTest</span> <span class="n">LEqual</span> <span class="n">Cull</span> <span class="n">off</span>
</span></span><span class="line"><span class="cl">    <span class="n">CGPROGRAM</span>
</span></span><span class="line"><span class="cl">    <span class="cp">#pragma vertex vert
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#pragma fragment frag
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#pragma multi_compile_shadowcaster
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="cp">#include</span> <span class="cpf">&#34;UnityCG.cginc&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">v2f</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">V2F_SHADOW_CASTER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">v2f</span> <span class="nf">vert</span><span class="p">(</span><span class="n">appdata_base</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">float4</span> <span class="nf">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_Target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">SHADOW_CASTER_FRAGMENT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">ENDCG</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>###要点说明：###</p>
<ul>
<li><code>appdata_base</code>：Unity 预定义的顶点输入结构，包含 POSITION、NORMAL、TEXCOORD0。</li>
<li><code>V2F_SHADOW_CASTER</code>：输出结构, 包含投影所需的裁剪空间位置和辅助向量, 等价于:
<ul>
<li>float4 pos : SV_POSITION;</li>
<li>float3 vec : TEXCOORD0;</li>
</ul>
</li>
<li><code>TRANSFER_SHADOW_CASTER_NORMALOFFSET(o)</code>：计算投影偏移，保证投影正确。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">float4</span> <span class="n">clipPos</span> <span class="o">=</span> <span class="nf">UnityClipSpaceShadowCasterPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span> \
</span></span><span class="line"><span class="cl">    <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="nf">UnityApplyLinearShadowBias</span><span class="p">(</span><span class="n">clipPos</span><span class="p">);</span> \
</span></span><span class="line"><span class="cl">    <span class="n">o</span><span class="p">.</span><span class="n">vec</span> <span class="o">=</span> <span class="nf">ComputeOffsetData</span><span class="p">(</span><span class="n">clipPos</span><span class="p">);</span>
</span></span></code></pre></div><ul>
<li><code>SHADOW_CASTER_FRAGMENT(i)</code> Unity内置宏, 在片段着色器中计算阴影投射</li>
<li><code>Cull off</code>：关闭剔除，保证内表面也能投影。</li>
</ul>
<p>###注###: uv0: TEXCOORD0 在VertexInput里会自动识别为模型的第一套UV, 在VertexOutput, TEXCOORD0就是通用插值寄存器, 是开发者自定义的数据通道, 需要在vert中手动从输入数据计算并赋值</p>

          
          
          
        </div>

        

        

        

        
  
  
    <h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
    <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
      
        

  <a href="/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/">Zhuangdong_Course_Note_VFXShader</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          







  

  
  
  

  
  
    
  

  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <span>2756 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">13 mins</span>
    

    
    
  </div>

  

  
  

  
  



        </div>

        
        <div class="py-1 prose dark:prose-invert">
          
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

      
        

  <a href="/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_forwardrendering/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_forwardrendering/">庄懂的技术美术入门课 - 前向渲染</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          







  

  
  
  

  
  
    
  

  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <span>2160 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">11 mins</span>
    

    
    
  </div>

  

  
  

  
  



        </div>

        
        <div class="py-1 prose dark:prose-invert">
          
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

      
        

  <a href="/notes/foundation/linearalgebra/essenceoflinearalgebra_part3/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/notes/foundation/linearalgebra/essenceoflinearalgebra_part3/">EssenceOfLinearAlgebra_Part3</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          







  

  
  
  

  
  
    
  

  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <span>287 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">2 mins</span>
    

    
    
  </div>

  

  
  

  
  



        </div>

        
        <div class="py-1 prose dark:prose-invert">
          
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

      
    </section>
  


      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.407e5b2727c1f241c95d53db24c776bea71bfc18e09511b815d669ad8caca6e9e18a53864ad364b1ccccfa2f2956768d33cfe193bfb64d3406f3b5ece354ba57.js"
          integrity="sha512-QH5bJyfB8kHJXVPbJMd2vqcb/BjglRG4FdZprYyspunhilOGStNksczM&#43;i8pVnaNM8/hk7&#43;2TTQG87Xs41S6Vw=="
          data-oid="views_Notes\Courses\ZhuangDong&#39;sTAIntroCourse\Zhuangdong_Note_LightingMap\index.md"
          data-oid-likes="likes_Notes\Courses\ZhuangDong&#39;sTAIntroCourse\Zhuangdong_Note_LightingMap\index.md"></script>
      

    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
      
      
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/">
              <span class="flex flex-col">
                <span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Zhuangdong_Course_Note_VFXShader</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a
    href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
        <ul class="flex flex-col list-none sm:flex-row">
          
            <li
              class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                Changelog
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          © 2025 Runming Chen. All Rights Reserved.
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script> 
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-index-500"
  data-url="https://rcrunming.com/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
