<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Zhuangdong_Course_Note_LightingMap &#183; Runming Chen</title><meta name=title content="Zhuangdong_Course_Note_LightingMap &#183; Runming Chen"><meta name=description content="Zhuangdong_Course_Note_LightingMap"><link rel=canonical href=https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/><link type=text/css rel=stylesheet href=/css/main.bundle.min.2755fda1868f0bfc1843df512e7b0b0bec55a259db5f8b13dc3c0f7894e519f617c2b66f5915ec207e2a1ffc8b6d1b53dbd8f3dff8892140cb5eacc50a6edfbb.css integrity="sha512-J1X9oYaPC/wYQ99RLnsLC+xVolnbX4sT3DwPeJTlGfYXwrZvWRXsIH4qH/yLbRtT29jz3/iJIUDLXqzFCm7fuw=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.dc15078f1fe553ce354f85ec1bfce7ded8b4060d4124a49b19e31dd64345b8d8f03edbbb1b681748650181f9d81da9728ca10c2b9cb2ae7bf8983d4b669ba876.js integrity="sha512-3BUHjx/lU841T4XsG/zn3ti0Bg1BJKSbGeMd1kNFuNjwPtu7G2gXSGUBgfnYHalyjKEMK5yyrnv4mD1LZpuodg==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/"><meta property="og:site_name" content="Runming Chen"><meta property="og:title" content="Zhuangdong_Course_Note_LightingMap"><meta property="og:description" content="Zhuangdong_Course_Note_LightingMap"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2025-05-31T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-31T00:00:00+00:00"><meta property="og:image" content="https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/featured.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rcrunming.com/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/featured.jpg"><meta name=twitter:title content="Zhuangdong_Course_Note_LightingMap"><meta name=twitter:description content="Zhuangdong_Course_Note_LightingMap"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Notes","name":"Zhuangdong_Course_Note_LightingMap","headline":"Zhuangdong_Course_Note_LightingMap","description":"Zhuangdong_Course_Note_LightingMap","inLanguage":"en","url":"https:\/\/rcrunming.com\/notes\/courses\/zhuangdongstaintrocourse\/zhuangdong_note_lightingmap\/","author":{"@type":"Person","name":"Runming"},"copyrightYear":"2025","dateCreated":"2025-05-31T00:00:00\u002b00:00","datePublished":"2025-05-31T00:00:00\u002b00:00","dateModified":"2025-05-31T00:00:00\u002b00:00","mainEntityOfPage":"true","wordCount":"3802"}]</script><meta name=author content="Runming"><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script defer type=text/javascript src=/js/mermaid.bundle.9258d4044c1e2c33ffe95c12c42818a81812d9b20f0c8e283e65b8d2745854c8ca14953622c5c489499c47e5762aa352432c64c2d160ffd39056d9be5241571e.js integrity="sha512-kljUBEweLDP/6VwSxCgYqBgS2bIPDI4oPmW40nRYVMjKFJU2IsXEiUmcR+V2KqNSQyxkwtFg/9OQVtm+UkFXHg=="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KLCF0CEN9Z"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KLCF0CEN9Z")</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] z-index-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 padding-main-menu"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Runming Chen</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/notes/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Notes>Notes</p></a><a href=/portfolio/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Portfolio>Portfolio</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class="ltr:mr-1 rtl:ml-1"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title=Zhuangdong_Course_Note_LightingMap>EN</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title=Zhuangdong_Course_Note_LightingMap>EN</p></a><a href=/zh-cn/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="庄懂的技术美术入门课 - 光照贴图">简体中文</p></a></div></div></div></div><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span><div><div class="cursor-pointer flex items-center nested-menu"><span class="ltr:mr-1 rtl:ml-1"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title=Zhuangdong_Course_Note_LightingMap>EN</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title=Zhuangdong_Course_Note_LightingMap>EN</p></a><a href=/zh-cn/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="庄懂的技术美术入门课 - 光照贴图">简体中文</p></a></div></div></div></div><button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 padding-top-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/notes/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Notes>Notes</p></a></li><li class=mt-1><a href=/portfolio/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Portfolio>Portfolio</p></a></li></ul></div></label></div></div></div></div><script type=text/javascript src=/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g==" data-target-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_lightingmap/featured_hu_f3a905bc8ab10082.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.4812321520cc2e4cd52bf9137015a55bb6c0b5e66a6b2c96b8654c0ec99be59e8e6425dd838a6fd9bac54000586f37f4a9680bbefaa2aee4601a69e188005cf6.js integrity="sha512-SBIyFSDMLkzVK/kTcBWlW7bAteZqayyWuGVMDsmb5Z6OZCXdg4pv2brFQABYbzf0qWgLvvqiruRgGmnhiABc9g==" data-target-id=background-blur></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Zhuangdong_Course_Note_LightingMap</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><span>3802 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">18 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#pre-baking-setup>Pre-baking Setup</a><ul><li><a href=#setting-up-skybox>Setting up Skybox</a></li><li><a href=#setting-scene-objects-as-static>Setting Scene Objects as Static</a></li><li><a href=#main-directional-light-emission-material-reflection-probe-settings>Main Directional Light, Emission Material, Reflection Probe Settings</a></li><li><a href=#lightingmode-settings>LightingMode Settings</a></li><li><a href=#combination-list>Combination List</a></li><li><a href=#lighting-explanation>Lighting Explanation</a></li><li><a href=#lightmapping-settings>Lightmapping Settings</a></li><li><a href=#common-solutions>Common Solutions</a></li></ul></li><li><a href=#batching-strategy-and-baking-process-analysis>Batching Strategy and Baking Process Analysis</a><ul><li><a href=#definition>Definition</a></li><li><a href=#common-strategies>Common Strategies</a></li><li><a href=#framedebugger>FrameDebugger</a></li></ul></li></ul><ul><li><a href=#external-baking-process>External Baking Process</a><ul><li><a href=#lighting-composition>Lighting Composition</a></li></ul></li><li><a href=#shader-core-structure>Shader Core Structure</a><ul><li><a href=#key-parameter-explanation>Key Parameter Explanation</a></li><li><a href=#key-points-summary>Key Points Summary</a></li></ul></li></ul><ul><li><ul><li><a href=#functions-and-file-structure>Functions and File Structure</a></li><li><a href=#global-parameter-brief-explanation>Global Parameter Brief Explanation</a></li><li><a href=#baking-process>Baking Process</a></li><li><a href=#core-code-example>Core Code Example</a></li></ul></li><li><a href=#lightingcontroller>LightingController</a><ul><li><a href=#class-and-inheritance-methods-and-lifecycle>Class and Inheritance, Methods and Lifecycle</a></li><li><a href=#lightmapsinfo>LightmapsInfo</a><ul><li><a href=#lightmapdata>LightmapData</a></li><li><a href=#struct>Struct</a></li><li><a href=#constructor>Constructor</a></li><li><a href=#dictionary>Dictionary</a></li><li><a href=#foreach-loop>foreach Loop</a></li></ul></li><li><a href=#lightmapsbuffer-cache>LightmapsBuffer Cache</a><ul><li><a href=#lightmapsbuffer-role-and-implementation-of-cache>LightmapsBuffer: Role and Implementation of Cache</a></li></ul></li><li><a href=#clear-cache-clearbuffer--clear>Clear Cache (ClearBuffer & Clear)</a></li><li><a href=#write-cache-writebuffer>Write Cache (WriteBuffer)</a></li><li><a href=#synthesize-lightmap-createlightmaps>Synthesize Lightmap (CreateLightmaps)</a></li><li><a href=#save-lightmap-overridelightmaps>Save Lightmap (OverrideLightmaps)</a></li><li><a href=#baking-mode-bakemode-and-scene-settings-arrangebakescene>Baking Mode (BakeMode) and Scene Settings (ArrangeBakeScene)</a></li><li><a href=#execute-baking-bake-and-reflection-probe-baking-bakereflectprobe>Execute Baking (Bake) and Reflection Probe Baking (BakeReflectProbe)</a></li></ul></li><li><a href=#lightingcontrollergui-custom-baking-panel>LightingControllerGUI: Custom Baking Panel</a><ul><li><a href=#basic-structure-of-editor-class>Basic Structure of Editor Class</a></li><li><a href=#drawing-function-buttons>Drawing Function Buttons</a></li><li><a href=#global-parameter-adjustment-and-monitoring>Global Parameter Adjustment and Monitoring</a></li></ul></li><li><a href=#emissionshadergui-custom-emission-parameter-panel>EmissionShaderGUI: Custom Emission Parameter Panel</a><ul><li><a href=#basic-structure>Basic Structure</a><ul><li><a href=#inherit-shadergui>Inherit ShaderGUI</a></li></ul></li><li><a href=#get-current-material>Get Current Material</a></li><li><a href=#use-default-inspector-interface>Use Default Inspector Interface</a></li><li><a href=#add-emission-gi-switch>Add Emission GI Switch</a></li></ul></li><li><a href=#shader-explanation-and-case-analysis>Shader Explanation and Case Analysis</a><ul><li><a href=#standard-lightmap-uv-calculation>Standard Lightmap UV Calculation</a></li><li><a href=#metapass-shading-channel-dedicated-to-baking>MetaPass: Shading Channel Dedicated to Baking</a><ul><li><a href=#case-code>Case Code</a></li><li><a href=#key-points-explanation>Key Points Explanation</a></li></ul></li><li><a href=#branch-control-shader_feature>Branch Control (shader_feature)</a><ul><li><a href=#skybox-special-note>Skybox Special Note</a></li></ul></li><li><a href=#shadowcaster-custom-shadow-pass>ShadowCaster: Custom Shadow Pass</a><ul><li><a href=#case-code-1>Case Code</a></li><li><a href=#key-points-explanation-1>Key Points Explanation</a></li></ul></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#pre-baking-setup>Pre-baking Setup</a><ul><li><a href=#setting-up-skybox>Setting up Skybox</a></li><li><a href=#setting-scene-objects-as-static>Setting Scene Objects as Static</a></li><li><a href=#main-directional-light-emission-material-reflection-probe-settings>Main Directional Light, Emission Material, Reflection Probe Settings</a></li><li><a href=#lightingmode-settings>LightingMode Settings</a></li><li><a href=#combination-list>Combination List</a></li><li><a href=#lighting-explanation>Lighting Explanation</a></li><li><a href=#lightmapping-settings>Lightmapping Settings</a></li><li><a href=#common-solutions>Common Solutions</a></li></ul></li><li><a href=#batching-strategy-and-baking-process-analysis>Batching Strategy and Baking Process Analysis</a><ul><li><a href=#definition>Definition</a></li><li><a href=#common-strategies>Common Strategies</a></li><li><a href=#framedebugger>FrameDebugger</a></li></ul></li></ul><ul><li><a href=#external-baking-process>External Baking Process</a><ul><li><a href=#lighting-composition>Lighting Composition</a></li></ul></li><li><a href=#shader-core-structure>Shader Core Structure</a><ul><li><a href=#key-parameter-explanation>Key Parameter Explanation</a></li><li><a href=#key-points-summary>Key Points Summary</a></li></ul></li></ul><ul><li><ul><li><a href=#functions-and-file-structure>Functions and File Structure</a></li><li><a href=#global-parameter-brief-explanation>Global Parameter Brief Explanation</a></li><li><a href=#baking-process>Baking Process</a></li><li><a href=#core-code-example>Core Code Example</a></li></ul></li><li><a href=#lightingcontroller>LightingController</a><ul><li><a href=#class-and-inheritance-methods-and-lifecycle>Class and Inheritance, Methods and Lifecycle</a></li><li><a href=#lightmapsinfo>LightmapsInfo</a><ul><li><a href=#lightmapdata>LightmapData</a></li><li><a href=#struct>Struct</a></li><li><a href=#constructor>Constructor</a></li><li><a href=#dictionary>Dictionary</a></li><li><a href=#foreach-loop>foreach Loop</a></li></ul></li><li><a href=#lightmapsbuffer-cache>LightmapsBuffer Cache</a><ul><li><a href=#lightmapsbuffer-role-and-implementation-of-cache>LightmapsBuffer: Role and Implementation of Cache</a></li></ul></li><li><a href=#clear-cache-clearbuffer--clear>Clear Cache (ClearBuffer & Clear)</a></li><li><a href=#write-cache-writebuffer>Write Cache (WriteBuffer)</a></li><li><a href=#synthesize-lightmap-createlightmaps>Synthesize Lightmap (CreateLightmaps)</a></li><li><a href=#save-lightmap-overridelightmaps>Save Lightmap (OverrideLightmaps)</a></li><li><a href=#baking-mode-bakemode-and-scene-settings-arrangebakescene>Baking Mode (BakeMode) and Scene Settings (ArrangeBakeScene)</a></li><li><a href=#execute-baking-bake-and-reflection-probe-baking-bakereflectprobe>Execute Baking (Bake) and Reflection Probe Baking (BakeReflectProbe)</a></li></ul></li><li><a href=#lightingcontrollergui-custom-baking-panel>LightingControllerGUI: Custom Baking Panel</a><ul><li><a href=#basic-structure-of-editor-class>Basic Structure of Editor Class</a></li><li><a href=#drawing-function-buttons>Drawing Function Buttons</a></li><li><a href=#global-parameter-adjustment-and-monitoring>Global Parameter Adjustment and Monitoring</a></li></ul></li><li><a href=#emissionshadergui-custom-emission-parameter-panel>EmissionShaderGUI: Custom Emission Parameter Panel</a><ul><li><a href=#basic-structure>Basic Structure</a><ul><li><a href=#inherit-shadergui>Inherit ShaderGUI</a></li></ul></li><li><a href=#get-current-material>Get Current Material</a></li><li><a href=#use-default-inspector-interface>Use Default Inspector Interface</a></li><li><a href=#add-emission-gi-switch>Add Emission GI Switch</a></li></ul></li><li><a href=#shader-explanation-and-case-analysis>Shader Explanation and Case Analysis</a><ul><li><a href=#standard-lightmap-uv-calculation>Standard Lightmap UV Calculation</a></li><li><a href=#metapass-shading-channel-dedicated-to-baking>MetaPass: Shading Channel Dedicated to Baking</a><ul><li><a href=#case-code>Case Code</a></li><li><a href=#key-points-explanation>Key Points Explanation</a></li></ul></li><li><a href=#branch-control-shader_feature>Branch Control (shader_feature)</a><ul><li><a href=#skybox-special-note>Skybox Special Note</a></li></ul></li><li><a href=#shadowcaster-custom-shadow-pass>ShadowCaster: Custom Shadow Pass</a><ul><li><a href=#case-code-1>Case Code</a></li><li><a href=#key-points-explanation-1>Key Points Explanation</a></li></ul></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">22. Unity Built-in LightingMap Baking System<div id=22-unity-built-in-lightingmap-baking-system class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#22-unity-built-in-lightingmap-baking-system aria-label=Anchor>#</a></span></h1><h2 class="relative group">Pre-baking Setup<div id=pre-baking-setup class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#pre-baking-setup aria-label=Anchor>#</a></span></h2><h3 class="relative group">Setting up Skybox<div id=setting-up-skybox class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#setting-up-skybox aria-label=Anchor>#</a></span></h3><ul><li>Path: Windows → Rendering → Lighting Settings → Skybox Material</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_LightingSetting src=https://c143d82.webp.li/L22_LightingSetting.png></figure></p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_Skybox src=https://c143d82.webp.li/L22_Skybox.png></figure></p><h3 class="relative group">Setting Scene Objects as Static<div id=setting-scene-objects-as-static class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#setting-scene-objects-as-static aria-label=Anchor>#</a></span></h3><ul><li>Enable Contribute GI and Reflection Probe Static</li><li>Static option descriptions:<ul><li>Contribute GI: Responds to global illumination</li><li>Occluder/Occludee Static: Responds to occlusion culling (OccCulling)</li><li>Batching Static: Batching optimization</li><li>Navigation Static/Off Mesh Link Generation: Navigation related</li><li>Reflection Probe Static: Determines whether objects appear in reflection probe records</li></ul></li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_Static src=https://c143d82.webp.li/L22_Static.png></figure></p><h3 class="relative group">Main Directional Light, Emission Material, Reflection Probe Settings<div id=main-directional-light-emission-material-reflection-probe-settings class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#main-directional-light-emission-material-reflection-probe-settings aria-label=Anchor>#</a></span></h3><ul><li>Set emission material Global Illumination to Baked, Color to HDR</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_GIBake src=https://c143d82.webp.li/L22_GIBake.png></figure></p><h3 class="relative group">LightingMode Settings<div id=lightingmode-settings class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightingmode-settings aria-label=Anchor>#</a></span></h3><ul><li><p>Path: Windows → Rendering → Lighting Settings → MixedLighting → LightingMode</p></li><li><p>LightingMode options:</p><ul><li>Baked Indirect</li><li>Subtractive</li><li>ShadowMask</li></ul></li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_LightingMode src=https://c143d82.webp.li/L22_LightingMode.png></figure></p><ul><li>Directional Light Mode:<ul><li>RealTime</li><li>Mixed</li><li>Baked</li></ul></li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_Mode src=https://c143d82.webp.li/L22_Mode.png></figure></p><p>Note: ShadowMask Mode needs to be enabled in ProjectSetting → Quality → Shadow → Shadowmask Mode. ShadowMask Mode additionally generates a Shadowmask texture.</p><h3 class="relative group">Combination List<div id=combination-list class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#combination-list aria-label=Anchor>#</a></span></h3><ul><li>Bake Indirect<ul><li>Runtime
LM = GI = EmitLighting + SkyLighting
Shadows: Real-time shadows</li><li>Mixed
LM = GI = EmitLighting + SkyLighting + LightsGI
Shadows: Real-time shadows</li><li>Baked
LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting
Shadows: Static objects: shadows written to LM, Dynamic objects: none</li></ul></li><li>Subtractive<ul><li>Runtime
LM = GI = EmitLighting + SkyLighting
Shadows: Real-time shadows, RealTime Shadow Color setting disabled</li><li>Mixed
LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting
Shadows: Static objects: shadows written to LM, Dynamic objects: real-time; RealTime Shadow Color setting effective</li><li>Baked
LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting
Shadows: Static objects: shadows written to LM, Dynamic objects: none; RealTime Shadow Color setting disabled</li></ul></li><li>ShadowMask<ul><li>Runtime
LM-light = GI = EmitLighting + SkyLighting
LM-shadowmask = null
Shadows: Real-time shadows</li><li>Mixed
LM-light = GI = EmitLighting + SkyLighting + LightsGI
LM-shadowmask = LightsShadow
Shadows: Static objects: shadows written to LM, Dynamic objects: real-time shadows</li><li>Baked
LM = GI + DL = (EmitLighting + SkyLighting + LightsGI) + LightsLighting
LM-shadowmask = null
Shadows: Static objects: shadows written to LM, Dynamic objects: none</li></ul></li></ul><h3 class="relative group">Lighting Explanation<div id=lighting-explanation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lighting-explanation aria-label=Anchor>#</a></span></h3><ul><li>EmitLighting represents lighting caused by emission materials</li><li>SkyLighting represents lighting caused by skybox</li><li>LightsGI represents bounce light caused by main light</li><li>LightsLighting represents lighting caused by main light</li><li>LM = Lightmap, DL = DirectLighting</li></ul><p>Note: Subtractive and ShadowMask handle real-time shadows for dynamic objects differently, ShadowMask provides more natural shadow mixing for static and dynamic objects.</p><h3 class="relative group">Lightmapping Settings<div id=lightmapping-settings class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightmapping-settings aria-label=Anchor>#</a></span></h3><ul><li>Lightmapper: Progressive CPU</li><li>Lightmap Resolution: 40</li><li>Directional Mode: Non-Directional (generally not recommended, effect not obvious, energy consumption doubles)</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_OtherSetting src=https://c143d82.webp.li/L22_OtherSetting.png></figure></p><h3 class="relative group">Common Solutions<div id=common-solutions class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#common-solutions aria-label=Anchor>#</a></span></h3><ul><li>Full real-time lighting: No Lightmap needed</li><li>Full real-time direct lighting + Baked Indirect</li><li>Static objects baked, dynamic objects real-time (Subtractive/ShadowMask)</li><li>Auxiliary lights only for baking (Baked/Mixed) Mixed determines whether to affect dynamic objects</li><li>Effects RealTime</li></ul><hr><h2 class="relative group">Batching Strategy and Baking Process Analysis<div id=batching-strategy-and-baking-process-analysis class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#batching-strategy-and-baking-process-analysis aria-label=Anchor>#</a></span></h2><h3 class="relative group">Definition<div id=definition class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#definition aria-label=Anchor>#</a></span></h3><p>Combining several batches of rendering with the same rendering process to save resources and increase speed. Generally, shared Material with same parameters can be batched.</p><h3 class="relative group">Common Strategies<div id=common-strategies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#common-strategies aria-label=Anchor>#</a></span></h3><ul><li>Unity static settings</li><li>Unity SRPBatching (same Shader can be batched)</li><li>GPU Instancing</li><li>Manual batching (merge models in DDC software)</li></ul><h3 class="relative group">FrameDebugger<div id=framedebugger class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#framedebugger aria-label=Anchor>#</a></span></h3><p>Windows → Analysis → FrameDebugger</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_FrameDebugger src=https://c143d82.webp.li/L22_FrameDebugger.png></figure></p><p>FrameDebugger can view batching and rendering process</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L22_FrameDebug src=https://c143d82.webp.li/L22_FrameDebug.png></figure></p><hr><h1 class="relative group">23. External LightingMap Baking and Custom Shader<div id=23-external-lightingmap-baking-and-custom-shader class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#23-external-lightingmap-baking-and-custom-shader aria-label=Anchor>#</a></span></h1><h2 class="relative group">External Baking Process<div id=external-baking-process class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#external-baking-process aria-label=Anchor>#</a></span></h2><ul><li>Use 3dsMax/MAYA to bake LightingMap, need to create UV2 for models</li><li>Textures:<ul><li>AO Map replaces SkyLighting</li><li>EmitLighting</li><li>LightsShadow</li><li>LightGI + LightsLighting</li><li>Alpha</li></ul></li><li>Use SD&rsquo;s Blur HQ node to remove noise, merge textures to save resources</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy alt=L23_Lightingmap src=https://c143d82.webp.li/L23_Lightingmap.png></figure></p><h3 class="relative group">Lighting Composition<div id=lighting-composition class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lighting-composition aria-label=Anchor>#</a></span></h3><div class=mermaid align=center><pre>
flowchart LR
    Lighting --> SimpleLightSource
    SimpleLightSource --> MainDirectionalLight
    MainDirectionalLight --> DiffuseReflection
    MainDirectionalLight --> SpecularReflection
    DiffuseReflection --> Occlusion
    SpecularReflection --> Occlusion
    Occlusion --> Result
    Lighting --> ComplexEnvironment
    ComplexEnvironment --> SkyLight
    ComplexEnvironment --> Emission
    ComplexEnvironment --> OtherAmbientLight
    SkyLight --> DiffuseReflectionCubemap
    Emission --> DiffuseReflection1Col
    OtherAmbientLight --> DiffuseReflection
    DiffuseReflectionCubemap --> Occlusion
    DiffuseReflection1Col --> Occlusion
    DiffuseReflection --> Ignore
    SkyLight --> SpecularReflectionCubemap
    Emission --> SpecularReflectionCubemap
    OtherAmbientLight --> SpecularReflectionCubemap
    SpecularReflectionCubemap --> SurfaceOcclusion
    SpecularReflectionCubemap --> FresnelAttenuation
    SurfaceOcclusion --> Result
    FresnelAttenuation --> Result
    Occlusion --> Result
</pre></div><h2 class="relative group">Shader Core Structure<div id=shader-core-structure class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#shader-core-structure aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Shader</span> <span class=s>&#34;Zhuangdong/AP1/L15/L15_LightingMap&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Properties</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ... Texture and parameter declarations ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>SubShader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Tags</span> <span class=p>{</span> <span class=s>&#34;RenderType&#34;</span> <span class=o>=</span> <span class=s>&#34;Opaque&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Name</span> <span class=s>&#34;FORWARD&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>Tags</span> <span class=p>{</span> <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ForwardBase&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>CGPROGRAM</span>
</span></span><span class=line><span class=cl>            <span class=cp>#pragma vertex vert
</span></span></span><span class=line><span class=cl><span class=cp></span>            <span class=cp>#pragma fragment frag
</span></span></span><span class=line><span class=cl><span class=cp></span>            <span class=cp>#include</span> <span class=cpf>&#34;UnityCG.cginc&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>            <span class=c1>// ... Using orge case as template, vertex shader removes TRANSFER_VERTEX_TO_FRAGMENT(o) ...
</span></span></span><span class=line><span class=cl><span class=c1></span>             <span class=n>VertexOutput</span> <span class=nf>vert</span><span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                    <span class=p>...</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//Case needs 2 UVs, here merge 2 UVs into one float4, saving TEXCOORD
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>o</span><span class=p>.</span><span class=n>uvs</span> <span class=o>=</span> <span class=nf>float4</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>uv1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>float3</span> <span class=nf>DecodeNormal</span> <span class=p>(</span><span class=n>float2</span> <span class=n>maskXY</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Texture only has RG two channels, we need to supplement B channel
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float2</span> <span class=n>nDirTSxy</span> <span class=o>=</span> <span class=n>maskXY</span> <span class=o>*</span> <span class=mf>2.0</span> <span class=o>-</span> <span class=mf>1.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Texture value range is (0,1), normal is vector, vector value range is (-1,1)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kt>float</span> <span class=n>nDirTSz</span> <span class=o>=</span> <span class=nf>sqrt</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=p>(</span><span class=n>nDirTSxy</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>nDirTSxy</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=n>nDirTSxy</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>nDirTSxy</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=c1>//sqrt takes square root, x squared + y squared + z squared = 1
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>return</span> <span class=nf>float3</span><span class=p>(</span><span class=n>nDirTSxy</span><span class=p>,</span> <span class=n>nDirTSz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>float4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// ... Sampling, vectors, dot products ...
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//Extract surface information
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kt>float</span> <span class=n>occlusion</span> <span class=o>=</span> <span class=n>var_MaskTex</span><span class=p>.</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>matMask</span> <span class=o>=</span> <span class=n>var_MaskTex</span><span class=p>.</span><span class=n>g</span><span class=p>;</span><span class=c1>//Metal texture
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>diffCol</span> <span class=o>=</span> <span class=n>var_MainTex</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=nf>lerp</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>_MetalDarken</span><span class=p>,</span> <span class=nf>pow</span><span class=p>(</span><span class=n>matMask</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Here add _MetalDarken to metal, reducing metal part diff
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kt>float</span> <span class=n>specPow</span> <span class=o>=</span> <span class=nf>max</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=nf>lerp</span><span class=p>(</span><span class=n>_SpecParams</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>_SpecParams</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>matMask</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>specInt</span> <span class=o>=</span> <span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=nf>lerp</span><span class=p>(</span><span class=n>_SpecParams</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>_SpecParams</span><span class=p>.</span><span class=n>w</span><span class=p>,</span> <span class=n>matMask</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>reflectMip</span> <span class=o>=</span> <span class=nf>clamp</span><span class=p>(</span><span class=nf>lerp</span><span class=p>(</span><span class=n>_EnvReflectParams</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>_EnvReflectParams</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>matMask</span><span class=p>),</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>7.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//clamp is clamp(value,min,max) which limits value to (min,max)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kt>float</span> <span class=n>reflectInt</span> <span class=o>=</span> <span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=nf>lerp</span><span class=p>(</span><span class=n>_EnvReflectParams</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>_EnvReflectParams</span><span class=p>.</span><span class=n>w</span><span class=p>,</span> <span class=n>matMask</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>fresnel</span> <span class=o>=</span> <span class=nf>lerp</span><span class=p>(</span><span class=nf>pow</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>ndotv</span><span class=p>),</span> <span class=n>_FresnelPow</span><span class=p>),</span> <span class=mf>1.0</span><span class=p>,</span> <span class=n>matMask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Distinguish Fresnel intensity between metal and non-metal
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//Extract lighting information
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kt>float</span> <span class=n>skyLightOcc</span> <span class=o>=</span> <span class=n>var_LightMap</span><span class=p>.</span><span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>emitLightingInt</span> <span class=o>=</span> <span class=n>var_LightMap</span><span class=p>.</span><span class=n>g</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>mainLightGIInt</span> <span class=o>=</span> <span class=nf>pow</span><span class=p>(</span><span class=n>var_LightMap</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>_GIpow</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kt>float</span> <span class=n>mainLightShadow</span> <span class=o>=</span> <span class=n>var_LightMap</span><span class=p>.</span><span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Sample texture Cube
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>var_SkyCube</span> <span class=o>=</span> <span class=nf>texCUBElod</span><span class=p>(</span><span class=n>_SkyCube</span><span class=p>,</span> <span class=nf>float4</span><span class=p>(</span><span class=n>vrDirWS</span><span class=p>,</span> <span class=mf>7.0</span><span class=p>)).</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float3</span> <span class=n>var_EnvCube</span> <span class=o>=</span> <span class=nf>texCUBElod</span><span class=p>(</span><span class=n>_EnvCube</span><span class=p>,</span> <span class=nf>float4</span><span class=p>(</span><span class=n>vrDirWS</span><span class=p>,</span> <span class=n>reflectMip</span><span class=p>)).</span><span class=n>rgb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//MainLight
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//Diff
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>halfShadowCol</span> <span class=o>=</span> <span class=nf>lerp</span><span class=p>(</span><span class=n>_HalfShadowCol</span><span class=p>.</span><span class=n>rgb</span><span class=p>,</span> <span class=n>_MainLightCol</span><span class=p>,</span> <span class=n>mainLightShadow</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//First assign colors to shadow and main light
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>mainLightCol</span> <span class=o>=</span> <span class=nf>lerp</span><span class=p>(</span><span class=n>_MainLightCol</span><span class=p>,</span> <span class=n>halfShadowCol</span><span class=p>,</span> <span class=n>_HalfShadowCol</span><span class=p>.</span><span class=n>a</span><span class=p>)</span> <span class=o>*</span> <span class=n>mainLightShadow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Then use shadow mask to remove shadow color, leaving main light color and penumbra color, here _HalfShadowCol.a controls penumbra intensity
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>mainLightDiff</span> <span class=o>=</span> <span class=n>diffCol</span> <span class=o>*</span> <span class=n>mainLightCol</span> <span class=o>*</span> <span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>nDotl</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//DiffCol*Lambert*MainLight
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//Spec
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>mainLightSpec</span> <span class=o>=</span> <span class=n>mainLightCol</span> <span class=o>*</span> <span class=nf>pow</span><span class=p>(</span><span class=nf>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>vDotr</span><span class=p>),</span> <span class=n>specPow</span><span class=p>)</span> <span class=o>*</span> <span class=n>specInt</span><span class=p>;</span><span class=c1>//Phong
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//GI
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>mainLightGI</span> <span class=o>=</span> <span class=n>_GICol</span> <span class=o>*</span> <span class=n>occlusion</span> <span class=o>*</span> <span class=n>mainLightGIInt</span> <span class=o>*</span> <span class=n>_GIInt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//GI is the bounce light of main light, here add AO for variation
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//Mixed
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>mainLight</span> <span class=o>=</span> <span class=p>(</span><span class=n>mainLightDiff</span> <span class=o>+</span> <span class=n>mainLightSpec</span> <span class=o>+</span> <span class=n>mainLightGI</span> <span class=o>*</span> <span class=n>_MainLightGIOn</span><span class=p>)</span> <span class=o>*</span> <span class=n>_MainLightOn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Here GI already has ambient AO information, so no need to *LM
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>                <span class=c1>//OtherLight
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>skyLightDiff</span> <span class=o>=</span> <span class=n>diffCol</span> <span class=o>*</span> <span class=n>var_SkyCube</span> <span class=o>*</span> <span class=n>_SkyCol</span> <span class=o>*</span> <span class=n>_SkyLightInt</span> <span class=o>*</span> <span class=n>skyLightOcc</span> <span class=o>*</span> <span class=n>occlusion</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Here is object diffuse * sky diffuse * LM(LightingMap)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>emitLightDiff</span> <span class=o>=</span> <span class=n>diffCol</span> <span class=o>*</span> <span class=n>_EmissionCol</span> <span class=o>*</span> <span class=n>emitLightingInt</span> <span class=o>*</span> <span class=n>occlusion</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>//Same as above, this part is not affected by ambient AO, so no need to *_SkyLightOcc
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//OtherEnvSpec
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>float3</span> <span class=n>envLightSpec</span> <span class=o>=</span> <span class=n>var_EnvCube</span> <span class=o>*</span> <span class=n>reflectInt</span> <span class=o>*</span> <span class=n>fresnel</span> <span class=o>*</span> <span class=n>occlusion</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float3</span> <span class=n>OtherLight</span> <span class=o>=</span> <span class=n>skyLightDiff</span> <span class=o>*</span> <span class=n>_SkyLightOn</span> <span class=o>+</span> <span class=n>emitLightDiff</span> <span class=o>*</span> <span class=n>_EmitLightOn</span> <span class=o>+</span> <span class=n>envLightSpec</span> <span class=o>*</span> <span class=n>_EnvReflectOn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>float3</span> <span class=n>finalRGB</span> <span class=o>=</span> <span class=n>mainLight</span> <span class=o>+</span> <span class=n>OtherLight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nf>float4</span><span class=p>(</span><span class=n>finalRGB</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>FallBack</span> <span class=s>&#34;Diffuse&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 class="relative group">Key Parameter Explanation<div id=key-parameter-explanation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#key-parameter-explanation aria-label=Anchor>#</a></span></h3><ul><li><p>_SpecParams</p><ul><li>x: Non-metal specular power</li><li>y: Non-metal specular intensity</li><li>z: Metal specular power</li><li>w: Metal specular intensity</li></ul></li><li><p>_EnvReflectParams</p><ul><li>x: Non-metal Cube sampling Mip value</li><li>y: Non-metal reflection intensity</li><li>z: Metal Cube sampling Mip value</li><li>w: Metal reflection intensity</li></ul></li></ul><h3 class="relative group">Key Points Summary<div id=key-points-summary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#key-points-summary aria-label=Anchor>#</a></span></h3><ul><li>Normal map only has RG, need to manually supplement B channel</li><li>Penumbra coloring</li><li>Metal/non-metal parameters separately control specular and reflection</li><li>Synthesize lighting according to lighting composition</li></ul><hr><h1 class="relative group">24-26 LightingController Custom Baker and Multi-Script Collaboration<div id=24-26-lightingcontroller-custom-baker-and-multi-script-collaboration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#24-26-lightingcontroller-custom-baker-and-multi-script-collaboration aria-label=Anchor>#</a></span></h1><p>Due to the extensive code content in this case, the explanation focuses on summaries. For source code, please download from the tutorial location.</p><p>This case implements a custom baker for completing custom baking, result preview, and material editing functions. The baking process generates three textures corresponding to main light, sky light, and emission light sources, and finally merges these three textures to output the final LightingMap. After baking is complete, you can preview the independent effects of each texture separately and flexibly adjust the final image performance through global parameters.</p><p>Main Light</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L24_MainLight src=https://c143d82.webp.li/L24_MainLight.png></figure></p><p>Sky Light</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L24_SkyLight src=https://c143d82.webp.li/L24_SkyLight.png></figure></p><p>Emission Light</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L24_EmitLight src=https://c143d82.webp.li/L24_EmitLight.png></figure></p><h3 class="relative group">Functions and File Structure<div id=functions-and-file-structure class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#functions-and-file-structure aria-label=Anchor>#</a></span></h3><ul><li><code>LightingController</code>: Main script responsible for the entire baking process.</li><li><code>LightingControllerGUI</code>: Custom baking panel (UI), making operations more intuitive.</li><li><code>EmissionShaderGUI</code>: Allows material spheres to set emission participation in GI in the Inspector interface.</li><li><code>Building/EmitLight/Sky</code>: Respectively correspond to building, emission, and skybox Shaders.</li></ul><hr><h3 class="relative group">Global Parameter Brief Explanation<div id=global-parameter-brief-explanation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#global-parameter-brief-explanation aria-label=Anchor>#</a></span></h3><ul><li><code>MetalDarken</code>: Darkness of metal parts (affects metal surface reflection intensity).</li><li><code>MainLightCol</code>: Main light color.</li><li><code>SpecParams</code>: Specular parameters (x/z are specular power, y/w are specular intensity, respectively corresponding to metal/non-metal).</li><li><code>SkyLightInt</code>: Sky light intensity.</li><li><code>ReflectParams</code>: Reflection parameters (x/z are CubeMap Mip, y/w are reflection intensity).</li><li><code>FresnelPow</code>: Fresnel phenomenon intensity.</li><li><code>EmissionCol</code>: Emission color.</li></ul><hr><h3 class="relative group">Baking Process<div id=baking-process class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#baking-process aria-label=Anchor>#</a></span></h3><ol><li>Collect scene baking information: including texture count, paths, texture objects</li><li>Create cache: Prepare cache for main light, sky light, emission GI and final synthesized Lightmap respectively.</li><li>Bake: Bake main light, sky light, emission GI in sequence, store each step result in cache.</li><li>Synthesize Lightmap: Combine the results of three baking steps into one final Lightmap.</li><li>Replace old Lightmap: Overwrite the scene&rsquo;s original lighting textures with the newly synthesized Lightmap.</li><li>Reset scene lighting environment: Modify scene settings.</li><li>Update global parameters: Synchronize parameters to all related materials.</li><li>Bake reflection probes: Make reflection effects display correctly.</li></ol><h3 class="relative group">Core Code Example<div id=core-code-example class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#core-code-example aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>MultiBake</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>buffer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>LightmapsBuffer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Bake</span><span class=p>(</span><span class=n>BakeMode</span><span class=p>.</span><span class=n>BakeMainLight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>info</span> <span class=p>=</span> <span class=k>new</span> <span class=n>LightmapsInfo</span><span class=p>(</span><span class=n>LightmapSettings</span><span class=p>.</span><span class=n>lightmaps</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>.</span><span class=n>WriteBuffer</span><span class=p>(</span><span class=n>info</span><span class=p>,</span> <span class=n>LightmapsBuffer</span><span class=p>.</span><span class=n>BufferType</span><span class=p>.</span><span class=n>MainLight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Bake</span><span class=p>(</span><span class=n>BakeMode</span><span class=p>.</span><span class=n>BakeSkyLight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>.</span><span class=n>WriteBuffer</span><span class=p>(</span><span class=n>info</span><span class=p>,</span> <span class=n>LightmapsBuffer</span><span class=p>.</span><span class=n>BufferType</span><span class=p>.</span><span class=n>SkyLight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Bake</span><span class=p>(</span><span class=n>BakeMode</span><span class=p>.</span><span class=n>BakeEmissionGI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>.</span><span class=n>WriteBuffer</span><span class=p>(</span><span class=n>info</span><span class=p>,</span> <span class=n>LightmapsBuffer</span><span class=p>.</span><span class=n>BufferType</span><span class=p>.</span><span class=n>EmissionGI</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>.</span><span class=n>CreateLightmaps</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>.</span><span class=n>OverrideLightmaps</span><span class=p>(</span><span class=n>info</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>ArrangeBakeScene</span><span class=p>(</span><span class=n>BakeMode</span><span class=p>.</span><span class=n>Default</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>UpdateGlobalProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>BakeReflectProbe</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 class="relative group">LightingController<div id=lightingcontroller class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightingcontroller aria-label=Anchor>#</a></span></h2><h3 class="relative group">Class and Inheritance, Methods and Lifecycle<div id=class-and-inheritance-methods-and-lifecycle class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#class-and-inheritance-methods-and-lifecycle aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=nl>LightingController</span> <span class=p>:</span> <span class=n>MonoBehaviour</span>
</span></span></code></pre></div><ul><li><code>class</code>: Can be understood as a &ldquo;blueprint&rdquo;, like Shader is a blueprint, Material is an &ldquo;item&rdquo; made according to the blueprint.</li><li><code>Inheritance</code>: Like &ldquo;vehicle&rdquo; is the parent class, &ldquo;car&rdquo; is the child class, child class automatically has the basic functions of parent class.</li><li><code>MonoBehaviour</code>: All Unity scripts that can be attached to objects must inherit from it to participate in the game lifecycle.</li><li><code>[ExecuteInEditMode]</code>: Generally, scripts only run in PlayMode, this directive makes the script also run in preview window</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>private</span> <span class=kt>void</span> <span class=nf>OnEnable</span><span class=p>()</span> <span class=p>{</span><span class=nf>UpdateGlobalProperties</span><span class=p>();};</span>
</span></span></code></pre></div><ul><li><code>void</code> is different from methods in previous cases, void functions don&rsquo;t return values, they are mainly used to perform specific operations.</li><li><code>OnEnable</code> means this function starts running at the OnEnable stage of the game lifecycle</li></ul><p>UpdateGlobalProperties() method is written after OnEnable, which is allowed in C#</p><h3 class="relative group">LightmapsInfo<div id=lightmapsinfo class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightmapsinfo aria-label=Anchor>#</a></span></h3><p>To understand the following concepts to understand the role of LightmapsInfo</p><p>LightmapData, struct, constructor, Dictionary and foreach loop</p><h4 class="relative group">LightmapData<div id=lightmapdata class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightmapdata aria-label=Anchor>#</a></span></h4><ul><li><code>LightmapData[]</code> is Unity&rsquo;s data type, it&rsquo;s the collection of all lighting textures in the current scene</li><li><code>lightmapsData</code> is a custom name, representing <code>LightmapData[]</code>, used for function internal operations</li><li><code>LightmapsData[]</code> contains multiple instances, each instance represents each Lightingmap, each instance contains:<ul><li>lightmapColor</li><li>lightmapDir</li><li>shadowMask</li><li>occlusionMask</li></ul></li></ul><h5 class="relative group">Struct and Constructor<div id=struct-and-constructor class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#struct-and-constructor aria-label=Anchor>#</a></span></h5><h4 class="relative group">Struct<div id=struct class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#struct aria-label=Anchor>#</a></span></h4><p>Can be understood as a &ldquo;container&rdquo; that can hold different types of data.</p><h5 class="relative group">Syntax<div id=syntax class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#syntax aria-label=Anchor>#</a></span></h5><p>public/private name (same as class/struct name) (type, parameter name)</p><h4 class="relative group">Constructor<div id=constructor class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#constructor aria-label=Anchor>#</a></span></h4><p>A special function used to initialize struct (or class), with the same name as the struct.</p><h5 class="relative group">Example<div id=example class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#example aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>struct</span> <span class=nc>LightmapsInfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>readonly</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>Texture2D</span><span class=p>&gt;</span> <span class=n>lightmapsInfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>LightmapsInfo</span><span class=p>(</span><span class=n>LightmapData</span><span class=p>[]</span> <span class=n>lightmapsData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Here all content will be automatically initialized</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>int</span> <span class=n>Age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Constructor
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=nf>Person</span><span class=p>(</span><span class=n>string</span> <span class=n>name</span><span class=p>,</span> <span class=kt>int</span> <span class=n>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Age</span> <span class=o>=</span> <span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>Without constructor, you need to manually assign values one by one, very tedious.</li><li>With constructor, just <code>new LightmapsInfo(parameters)</code>, all content automatically arranged.</li></ul><hr><h5 class="relative group">Multiple Uses of Constructor<div id=multiple-uses-of-constructor class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#multiple-uses-of-constructor aria-label=Anchor>#</a></span></h5><ul><li>Constructor can have multiple, with different parameters or methods.</li><li>Can also do parameter checking in constructor to prevent errors.</li></ul><h5 class="relative group">Example<div id=example-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#example-1 aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=n>LightmapsInfo</span><span class=p>(</span><span class=n>LightmapData</span><span class=p>[]</span> <span class=n>lightmapsData</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>lightmapsData</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Do some error handling</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Other initialization content</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h4 class="relative group">Dictionary<div id=dictionary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#dictionary aria-label=Anchor>#</a></span></h4><ul><li><code>Dictionary</code> is a &ldquo;key-value pair&rdquo; container that can quickly find corresponding content through &ldquo;names&rdquo;.</li><li>For example: <code>Dictionary&lt;string, Texture2D></code>, can use string names to find corresponding texture paths and objects.</li></ul><h5 class="relative group">Case<div id=case class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#case aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>Texture2D</span><span class=p>&gt;</span> <span class=n>myDict</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Dictionary</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>,</span> <span class=n>Texture2D</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=n>myDict</span><span class=p>[</span><span class=s>&#34;MainLight&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=n>mainLightTex</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Texture2D</span> <span class=n>tex</span> <span class=p>=</span> <span class=n>myDict</span><span class=p>[</span><span class=s>&#34;MainLight&#34;</span><span class=p>];</span>
</span></span></code></pre></div><hr><h4 class="relative group">foreach Loop<div id=foreach-loop class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#foreach-loop aria-label=Anchor>#</a></span></h4><p><code>foreach</code> is used to traverse collections (such as arrays, List, Dictionary, etc.)</p><h5 class="relative group">Example<div id=example-2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#example-2 aria-label=Anchor>#</a></span></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>//data represents instance</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>data</span> <span class=k>in</span> <span class=n>lightmapsData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>texture</span> <span class=p>=</span> <span class=n>data</span><span class=p>.</span><span class=n>lightmapColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span> <span class=p>=</span> <span class=n>AssetDatabase</span><span class=p>.</span><span class=n>GetAssetPath</span><span class=p>(</span><span class=n>texture</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>lightmapsInfo</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>texture</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span><span class=p>[]</span> <span class=n>numbers</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nf>foreach</span> <span class=p>(</span><span class=kt>int</span> <span class=n>num</span> <span class=n>in</span> <span class=n>numbers</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>Debug</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=n>num</span><span class=p>);</span> <span class=c1>// Output: 1, 2, 3, 4, 5
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><hr><h3 class="relative group">LightmapsBuffer Cache<div id=lightmapsbuffer-cache class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightmapsbuffer-cache aria-label=Anchor>#</a></span></h3><p>In Unity&rsquo;s lighting baking process, we need to cache, synthesize and save different types of lighting textures.</p><h4 class="relative group">LightmapsBuffer: Role and Implementation of Cache<div id=lightmapsbuffer-role-and-implementation-of-cache class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightmapsbuffer-role-and-implementation-of-cache aria-label=Anchor>#</a></span></h4><h5 class="relative group">Cache (Buffer)<div id=cache-buffer class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#cache-buffer aria-label=Anchor>#</a></span></h5><p>Can be understood as a &ldquo;storage box&rdquo; used to temporarily save different types of lighting textures, convenient for subsequent processing and transfer.</p><h5 class="relative group">Enum<div id=enum class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#enum aria-label=Anchor>#</a></span></h5><p>Used to define a set of constants, making code clearer and easier to understand.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>BufferType</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MainLight</span><span class=p>,</span>  <span class=c1>// Main light lighting: BufferA</span>
</span></span><span class=line><span class=cl>    <span class=n>SkyLight</span><span class=p>,</span>   <span class=c1>// Sky light lighting: BufferB</span>
</span></span><span class=line><span class=cl>    <span class=n>EmissionGI</span><span class=p>,</span> <span class=c1>// Emission GI: BufferC</span>
</span></span><span class=line><span class=cl>    <span class=n>Lightmap</span>    <span class=c1>// Synthesized Lightmap</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create cache for different types of lighting respectively</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>Texture2D</span><span class=p>[]</span> <span class=n>_bufferA</span><span class=p>;</span>   <span class=c1>// Main light</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>Texture2D</span><span class=p>[]</span> <span class=n>_bufferB</span><span class=p>;</span>   <span class=c1>// Sky light</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>Texture2D</span><span class=p>[]</span> <span class=n>_bufferC</span><span class=p>;</span>   <span class=c1>// Emission</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>Texture2D</span><span class=p>[]</span> <span class=n>_lightmap</span><span class=p>;</span>  <span class=c1>// Final synthesis</span>
</span></span></code></pre></div><hr><h3 class="relative group">Clear Cache (ClearBuffer & Clear)<div id=clear-cache-clearbuffer--clear class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#clear-cache-clearbuffer--clear aria-label=Anchor>#</a></span></h3><ul><li><code>switch-case</code>: Execute different clearing logic according to different types (BufferType).</li><li><code>void(type parameter name)</code>:<ul><li>If it&rsquo;s a single data, parameter name is the temporary name of this data in the function</li><li>If it&rsquo;s a collection, parameter name is the temporary name of this collection in the function</li><li>If it&rsquo;s an enum, parameter name is the temporary name of elements in the enum.</li></ul></li></ul><hr><h3 class="relative group">Write Cache (WriteBuffer)<div id=write-cache-writebuffer class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#write-cache-writebuffer aria-label=Anchor>#</a></span></h3><ul><li>First judge the type, if it&rsquo;s the final Lightmap then return directly.</li><li>Clear the corresponding type cache.</li><li>Create new cache and copy textures from info.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=p>==</span> <span class=n>BufferType</span><span class=p>.</span><span class=n>Lightmap</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Clear cache</span>
</span></span><span class=line><span class=cl><span class=n>ClearBuffer</span><span class=p>(</span><span class=n>type</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Create cache and copy textures from info</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>lightmapsCount</span> <span class=p>=</span> <span class=n>info</span><span class=p>.</span><span class=n>lightmapsCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>buffer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Texture2D</span><span class=p>[</span><span class=n>lightmapsCount</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=n>lightmapsCount</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>lightmap</span> <span class=p>=</span> <span class=n>info</span><span class=p>.</span><span class=n>lightmapsInfo</span><span class=p>.</span><span class=n>Values</span><span class=p>.</span><span class=n>ElementAt</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>buffer</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Texture2D</span><span class=p>(</span><span class=n>lightmap</span><span class=p>.</span><span class=n>width</span><span class=p>,</span> <span class=n>lightmap</span><span class=p>.</span><span class=n>height</span><span class=p>,</span> <span class=n>lightmap</span><span class=p>.</span><span class=n>format</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Graphics</span><span class=p>.</span><span class=n>CopyTexture</span><span class=p>(</span><span class=n>lightmap</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=n>buffer</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><p><code>info.lightmapsInfo.Values.ElementAt(i)</code>: Take out the i-th texture from the dictionary in order.</p></li><li><p><code>Texture2D(texture width, height, format (default RGB24), whether to generate mipmap)</code></p></li><li><p><code>Graphics.CopyTexture</code>: Unity API, used for efficient texture data copying.</p></li></ul><hr><h3 class="relative group">Synthesize Lightmap (CreateLightmaps)<div id=synthesize-lightmap-createlightmaps class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#synthesize-lightmap-createlightmaps aria-label=Anchor>#</a></span></h3><ul><li>Read pixels from main light, sky light, emission three types of cache in sequence, synthesize to a new Lightmap.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>x</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>x</span> <span class=p>&lt;</span> <span class=n>width</span><span class=p>;</span> <span class=n>x</span><span class=p>++)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>y</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>y</span> <span class=p>&lt;</span> <span class=n>height</span><span class=p>;</span> <span class=n>y</span><span class=p>++)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>colA</span> <span class=p>=</span> <span class=n>_bufferA</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>GetPixel</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>colB</span> <span class=p>=</span> <span class=n>_bufferB</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>GetPixel</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>colC</span> <span class=p>=</span> <span class=n>_bufferC</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>GetPixel</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>newCol</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Color</span><span class=p>(</span><span class=n>colA</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>colB</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>colC</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=m>1.0f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>lightmap</span><span class=p>.</span><span class=n>SetPixel</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>newCol</span><span class=p>.</span><span class=n>linear</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>Each pixel point takes corresponding colors from three cache textures, synthesizes to the final Lightmap.</li><li>Note: Cache saves Texture2D objects, need to read and write pixel by pixel.</li></ul><hr><h3 class="relative group">Save Lightmap (OverrideLightmaps)<div id=save-lightmap-overridelightmaps class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#save-lightmap-overridelightmaps aria-label=Anchor>#</a></span></h3><ul><li>Encode the synthesized Lightmap to EXR format (supports HDR) and write to disk.</li><li>Refresh Unity resource database to make new files recognized.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=n>lightmapsCount</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>bytes</span> <span class=p>=</span> <span class=n>_lightmap</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>EncodeToEXR</span><span class=p>(</span><span class=n>Texture2D</span><span class=p>.</span><span class=n>EXRFlags</span><span class=p>.</span><span class=n>CompressZIP</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>File</span><span class=p>.</span><span class=n>WriteAllBytes</span><span class=p>(</span><span class=n>lightmapsInfo</span><span class=p>.</span><span class=n>Keys</span><span class=p>.</span><span class=n>ElementAt</span><span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=n>bytes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>AssetDatabase</span><span class=p>.</span><span class=n>Refresh</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><code>EncodeToEXR</code>: Unity API, encodes texture to EXR format, EXR is Unity lighting system&rsquo;s dedicated format</li><li><code>Texture2D.EXRFlags.CompressZip</code> compress to zip</li><li><code>File.WriteAllBytes</code>: .NET API, writes byte array to file.</li><li><code>lightmapsInfo.Keys.ElementAt(i)</code> get the i-th key from dictionary lightmapsInfo, i.e., path</li><li><code>AssetDatabase.Refresh()</code>: Refresh resource database (only available in editor mode).</li></ul><hr><h3 class="relative group">Baking Mode (BakeMode) and Scene Settings (ArrangeBakeScene)<div id=baking-mode-bakemode-and-scene-settings-arrangebakescene class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#baking-mode-bakemode-and-scene-settings-arrangebakescene aria-label=Anchor>#</a></span></h3><ul><li><code>BakeMode</code>: Use enum to define different baking modes (all, main light, sky light, emission).</li><li><code>ArrangeBakeScene</code>: Set scene parameters according to different modes, such as ambient light type and intensity.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>RenderSettings</span><span class=p>.</span><span class=n>ambientMode</span> <span class=p>=</span> <span class=n>AmbientMode</span><span class=p>.</span><span class=n>Skybox</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>RenderSettings</span><span class=p>.</span><span class=n>ambientIntensity</span> <span class=p>=</span> <span class=m>1.0f</span><span class=p>;</span>
</span></span></code></pre></div><ul><li><code>ambientMode</code> determines ambient light type (skybox, gradient, single color).</li><li><code>ambientIntensity</code> controls ambient light intensity (effective after baking).</li></ul><p>Corresponds to lightingSetting → lighting → Scene → Environment Lighting → Source & Intensity Multiplier</p><p>Set main light as static:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>var</span> <span class=n>staticFlags</span> <span class=p>=</span> <span class=n>StaticEditorFlags</span><span class=p>.</span><span class=n>ContributeGI</span> <span class=p>|</span> <span class=n>StaticEditorFlags</span><span class=p>.</span><span class=n>ReflectionProbeStatic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>GameObjectUtility</span><span class=p>.</span><span class=n>SetStaticEditorFlags</span><span class=p>(</span><span class=n>mainlight</span><span class=p>.</span><span class=n>gameObject</span><span class=p>,</span> <span class=n>staticFlags</span><span class=p>);</span>
</span></span></code></pre></div><hr><h3 class="relative group">Execute Baking (Bake) and Reflection Probe Baking (BakeReflectProbe)<div id=execute-baking-bake-and-reflection-probe-baking-bakereflectprobe class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#execute-baking-bake-and-reflection-probe-baking-bakereflectprobe aria-label=Anchor>#</a></span></h3><p><code>Bake</code> directly calls Unity API for lighting baking.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>Bake</span><span class=p>(</span><span class=n>BakeMode</span> <span class=n>mode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Lightmapping</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Lightmapping</span><span class=p>.</span><span class=n>Bake</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>BakeReflectProbe</code> traverses all reflection probes in the scene, bakes and saves them one by one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=k>void</span> <span class=n>BakeReflectProbe</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>allProbe</span> <span class=p>=</span> <span class=n>FindObjectsOfType</span><span class=p>&lt;</span><span class=n>ReflectionProbe</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>probe</span> <span class=k>in</span> <span class=n>allProbe</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>path</span> <span class=p>=</span> <span class=n>AssetDatabase</span><span class=p>.</span><span class=n>GetAssetPath</span><span class=p>(</span><span class=n>probe</span><span class=p>.</span><span class=n>texture</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Lightmapping</span><span class=p>.</span><span class=n>BakeReflectionProbe</span><span class=p>(</span><span class=n>probe</span><span class=p>,</span> <span class=n>path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>AssetDatabase</span><span class=p>.</span><span class=n>Refresh</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><code>FindObjectsOfType&lt;>()</code>: Find all reflection probes in the scene.</li><li><code>AssetDatabase.GetAssetPath()</code> get these reflection probes&rsquo; textures and paths</li><li><code>Lightmapping.BakeReflectionProbe()</code>: Unity API, bake reflection probe.</li></ul><p>If you don&rsquo;t customize storage path, reflection probe baked Cubemap defaults to LightingData</p><hr><h2 class="relative group">LightingControllerGUI: Custom Baking Panel<div id=lightingcontrollergui-custom-baking-panel class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#lightingcontrollergui-custom-baking-panel aria-label=Anchor>#</a></span></h2><p>After understanding the baking process and methods, we also need a custom UI panel to make baking operations and parameter adjustments more intuitive. Below introduces the implementation ideas and key code of LightingControllerGUI.</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L24_LightingController_UI src=https://c143d82.webp.li/L24_LightingController_UI.png></figure></p><hr><h3 class="relative group">Basic Structure of Editor Class<div id=basic-structure-of-editor-class class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#basic-structure-of-editor-class aria-label=Anchor>#</a></span></h3><ul><li><code>UnityEditor.Editor</code>: Custom editor class must inherit from <code>Editor</code> and implement <code>OnInspectorGUI()</code> method.</li><li><code>OnInspectorGUI()</code>: Used to draw the content of Inspector panel.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>LightingControllerGUI</span> <span class=p>:</span> <span class=n>Editor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>OnInspectorGUI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>controller</span> <span class=p>=</span> <span class=n>target</span> <span class=k>as</span> <span class=n>LightingController</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>controller</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>DrawFunctionButtons</span><span class=p>(</span><span class=n>controller</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>DrawGlobalProperties</span><span class=p>(</span><span class=n>controller</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><code>override</code> when methods in class are set as virtual or abstract, can only use override to reference and override execution content</li><li><code>target as LightingController</code>: Get the object bound to current Inspector, must be MonoBehaviour derived class.</li><li><code>DrawFunctionButtons</code>: Draw baking-related operation buttons.</li><li><code>DrawGlobalProperties</code>: Draw global parameter adjustment controls.</li></ul><hr><h3 class="relative group">Drawing Function Buttons<div id=drawing-function-buttons class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#drawing-function-buttons aria-label=Anchor>#</a></span></h3><ul><li>Use <code>GUILayout.Button("button name")</code> to create buttons, execute corresponding methods when clicked.</li><li><code>EditorGUILayout.BeginHorizontal()</code> and <code>EndHorizontal()</code> are used to make multiple buttons display in the same row.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>GUILayout</span><span class=p>.</span><span class=n>Button</span><span class=p>(</span><span class=s>&#34;Forbidden Art·Multiple Baking&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>controller</span><span class=p>.</span><span class=n>MultiBake</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>EditorGUILayout</span><span class=p>.</span><span class=n>BeginHorizontal</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Can add more buttons here</span>
</span></span><span class=line><span class=cl><span class=n>EditorGUILayout</span><span class=p>.</span><span class=n>EndHorizontal</span><span class=p>();</span>
</span></span></code></pre></div><hr><h3 class="relative group">Global Parameter Adjustment and Monitoring<div id=global-parameter-adjustment-and-monitoring class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#global-parameter-adjustment-and-monitoring aria-label=Anchor>#</a></span></h3><ul><li>Use <code>EditorGUILayout.BeginFoldoutHeaderGroup</code> to create collapsible parameter groups.</li><li>Use <code>EditorGUILayout.Slider</code> to create draggable sliders for easy parameter adjustment.</li><li>Use <code>EditorGUI.BeginChangeCheck()</code> and <code>EndChangeCheck()</code> to monitor parameter changes, automatically update when changed.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>EditorGUI</span><span class=p>.</span><span class=n>BeginChangeCheck</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>_groupAToggle</span> <span class=p>=</span> <span class=n>EditorGUILayout</span><span class=p>.</span><span class=n>BeginFoldoutHeaderGroup</span><span class=p>(</span><span class=n>_groupAToggle</span><span class=p>,</span> <span class=s>&#34;Material Properties&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>_groupAToggle</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>//Equivalent to if (groupAToggle == true)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>controller</span><span class=p>.</span><span class=n>metalDarken</span> <span class=p>=</span> <span class=n>EditorGUILayout</span><span class=p>.</span><span class=n>Slider</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;Metal Darkening&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>controller</span><span class=p>.</span><span class=n>metalDarken</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=m>0.0f</span><span class=p>,</span> <span class=m>5.0f</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>EditorGUILayout</span><span class=p>.</span><span class=n>EndFoldoutHeaderGroup</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>EditorGUI</span><span class=p>.</span><span class=n>EndChangeCheck</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>controller</span><span class=p>.</span><span class=n>UpdateGlobalProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>EditorUtility</span><span class=p>.</span><span class=n>SetDirty</span><span class=p>(</span><span class=n>controller</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><code>_groupAToggle</code>: Used to control the expand/collapse of foldout group, defaults to <code>false</code> when not assigned.</li><li><code>EditorUtility.SetDirty(controller)</code>: Mark object as &ldquo;modified&rdquo;, ensure parameter changes can be recorded by Unity.</li></ul><hr><h2 class="relative group">EmissionShaderGUI: Custom Emission Parameter Panel<div id=emissionshadergui-custom-emission-parameter-panel class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#emissionshadergui-custom-emission-parameter-panel aria-label=Anchor>#</a></span></h2><p>Through custom <code>ShaderGUI</code>, we can make the material sphere&rsquo;s Inspector panel appear &ldquo;Enable Emission GI&rdquo; option, convenient for controlling whether emission participates in global illumination (GI).</p><p><figure><img class="my-0 rounded-md" loading=lazy alt=L24_EmitUI src=https://c143d82.webp.li/L24_EmitUI.png></figure></p><hr><h3 class="relative group">Basic Structure<div id=basic-structure class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#basic-structure aria-label=Anchor>#</a></span></h3><h4 class="relative group">Inherit ShaderGUI<div id=inherit-shadergui class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#inherit-shadergui aria-label=Anchor>#</a></span></h4><p>When customizing material Inspector panel, need to inherit <code>ShaderGUI</code> class.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>EmissionShaderGUI</span> <span class=p>:</span> <span class=n>ShaderGUI</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Specific implementation see below</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>After inheritance, Unity will automatically get the Shader and Material information using this script.</p><hr><h3 class="relative group">Get Current Material<div id=get-current-material class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#get-current-material aria-label=Anchor>#</a></span></h3><p>Get the current material instance being edited through <code>materialEditor.target as Material</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>var</span> <span class=n>material</span> <span class=p>=</span> <span class=n>materialEditor</span><span class=p>.</span><span class=n>target</span> <span class=k>as</span> <span class=n>Material</span><span class=p>;</span>
</span></span></code></pre></div><hr><h3 class="relative group">Use Default Inspector Interface<div id=use-default-inspector-interface class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#use-default-inspector-interface aria-label=Anchor>#</a></span></h3><p>If you don&rsquo;t need to customize complex UI, you can directly call the base class&rsquo;s <code>OnGUI</code>, this will display the default property panel.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>base</span><span class=p>.</span><span class=n>OnGUI</span><span class=p>(</span><span class=n>materialEditor</span><span class=p>,</span> <span class=n>properties</span><span class=p>);</span>
</span></span></code></pre></div><hr><h3 class="relative group">Add Emission GI Switch<div id=add-emission-gi-switch class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#add-emission-gi-switch aria-label=Anchor>#</a></span></h3><p>Use <code>EditorGUILayout.Toggle</code> to create a checkbox, control whether emission participates in global illumination.</p><p>Toggle has 4 parameters</p><ul><li>label text content</li><li>value condition</li><li>style button style</li><li>option button size</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>var</span> <span class=n>ifEmissionGIOn</span> <span class=p>=</span> <span class=n>EditorGUILayout</span><span class=p>.</span><span class=n>Toggle</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;Enable Emission GI&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>material</span><span class=p>.</span><span class=n>globalIlluminationFlags</span> <span class=p>==</span> <span class=n>MaterialGlobalIlluminationFlags</span><span class=p>.</span><span class=n>AnyEmissive</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>material</span><span class=p>.</span><span class=n>globalIlluminationFlags</span> <span class=p>=</span> <span class=n>ifEmissionGIOn</span>
</span></span><span class=line><span class=cl>    <span class=p>?</span> <span class=n>MaterialGlobalIlluminationFlags</span><span class=p>.</span><span class=n>AnyEmissive</span>
</span></span><span class=line><span class=cl>    <span class=p>:</span> <span class=n>MaterialGlobalIlluminationFlags</span><span class=p>.</span><span class=n>EmissiveIsBlack</span><span class=p>;</span>
</span></span></code></pre></div><ul><li><code>EditorGUILayout.Toggle("interface text", condition)</code>: Display checkbox state according to condition.</li><li>Ternary operator <code>condition ? resultA : resultB</code>, equivalent to if-else statement:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>ifEmissionGIOn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>material</span><span class=p>.</span><span class=n>globalIlluminationFlags</span> <span class=p>=</span> <span class=n>MaterialGlobalIlluminationFlags</span><span class=p>.</span><span class=n>AnyEmissive</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=n>material</span><span class=p>.</span><span class=n>globalIlluminationFlags</span> <span class=p>=</span> <span class=n>MaterialGlobalIlluminationFlags</span><span class=p>.</span><span class=n>EmissiveIsBlack</span><span class=p>;</span>
</span></span></code></pre></div><hr><h2 class="relative group">Shader Explanation and Case Analysis<div id=shader-explanation-and-case-analysis class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#shader-explanation-and-case-analysis aria-label=Anchor>#</a></span></h2><p>In this case, Shader has several key differences compared to other cases:</p><ul><li>Lightmap UV calculation method</li><li>MetaPass implementation</li><li>Branch declaration (shader_feature)</li><li>Custom ShadowCaster</li></ul><hr><h3 class="relative group">Standard Lightmap UV Calculation<div id=standard-lightmap-uv-calculation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#standard-lightmap-uv-calculation aria-label=Anchor>#</a></span></h3><p>In Unity, Lightmap UV coordinates are usually calculated like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>float2</span> <span class=n>lmUV</span> <span class=p>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv1</span><span class=p>.</span><span class=n>xy</span> <span class=p>*</span> <span class=n>unity_LightmapST</span><span class=p>.</span><span class=n>xy</span> <span class=p>+</span> <span class=n>unity_LightmapST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span>
</span></span></code></pre></div><ul><li><code>uv1</code> is the model&rsquo;s second set of UV (specifically for lighting textures).</li><li><code>unity_LightmapST</code> is the scale/offset parameter automatically passed by Unity.</li></ul><hr><h3 class="relative group">MetaPass: Shading Channel Dedicated to Baking<div id=metapass-shading-channel-dedicated-to-baking class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#metapass-shading-channel-dedicated-to-baking aria-label=Anchor>#</a></span></h3><p>MetaPass is Unity lighting baking system&rsquo;s dedicated Shader channel. Only Shaders with MetaPass can participate in lighting baking.</p><h4 class="relative group">Case Code<div id=case-code class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#case-code aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//Building.Shader&#39;s MetaPass
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=s>&#34;META&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Tags</span> <span class=p>{</span> <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;Meta&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>CGPROGRAM</span>
</span></span><span class=line><span class=cl>    <span class=cp>#pragma vertex vert
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#pragma fragment frag
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#include</span> <span class=cpf>&#34;UnityCG.cginc&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#include</span> <span class=cpf>&#34;UnityMetaPass.cginc&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#pragma shader_feature __ _BAKE_MAINLIGHT _BAKE_SKYLIGHT _BAKE_EMISSIONGI
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>VertexInput</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>float4</span> <span class=nl>vertex</span>   <span class=p>:</span> <span class=n>POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>float2</span> <span class=nl>uv0</span>      <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>float2</span> <span class=nl>uv1</span>      <span class=p>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>float2</span> <span class=nl>uv2</span>      <span class=p>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>VertexOutput</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>float4</span> <span class=nl>pos</span> <span class=p>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>float2</span> <span class=nl>uv</span> <span class=p>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>VertexOutput</span> <span class=nf>vert</span> <span class=p>(</span><span class=n>VertexInput</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>VertexOutput</span> <span class=n>o</span> <span class=o>=</span> <span class=p>(</span><span class=n>VertexOutput</span><span class=p>)</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityMetaVertexPosition</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>uv1</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>uv2</span><span class=p>,</span> <span class=n>unity_LightmapST</span><span class=p>,</span> <span class=n>unity_DynamicLightmapST</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>uv0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>VertexOutput</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>COLOR</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>UnityMetaInput</span> <span class=n>metaIN</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>UNITY_INITIALIZE_OUTPUT</span><span class=p>(</span><span class=n>UnityMetaInput</span><span class=p>,</span> <span class=n>metaIN</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>metaIN</span><span class=p>.</span><span class=n>Albedo</span> <span class=o>=</span> <span class=nf>Luminance</span><span class=p>(</span><span class=nf>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>).</span><span class=n>rgb</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>metaIN</span><span class=p>.</span><span class=n>SpecularColor</span> <span class=o>=</span> <span class=mf>0.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>metaIN</span><span class=p>.</span><span class=n>Emission</span> <span class=o>=</span> <span class=mf>0.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>UnityMetaFragment</span><span class=p>(</span><span class=n>metaIN</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 class="relative group">Key Points Explanation<div id=key-points-explanation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#key-points-explanation aria-label=Anchor>#</a></span></h4><ul><li><code>UnityStandardMeta.cginc</code> PBR process META Pass dedicated</li><li><code>UnityMetaPass.cginc</code> belongs to part of <code>UnityStandardMeta.cginc</code>, since the case is not PBR process, for optimization consideration, only reference this cginc. Compared to <code>UnityStandardMeta.cginc</code> need to customize vertex shader part</li><li><code>UnityMetaVertexPosition</code>: Convert vertex and UV to baking space.</li><li><code>UnityMetaInput</code>: Contains array of baking required data like Albedo, SpecularColor, Emission.</li><li><code>UNITY_INITIALIZE_OUTPUT</code> initialize <code>UnityMetaInput</code></li><li><code>Luminance</code>: Convert color to grayscale, ensure baking only considers brightness, not affected by specular and emission.</li></ul><hr><h3 class="relative group">Branch Control (shader_feature)<div id=branch-control-shader_feature class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#branch-control-shader_feature aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//LightingController.cs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=n>BakeMode</span><span class=p>.</span><span class=nl>Default</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=c1>// Turn off main light
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>mainlight</span><span class=p>.</span><span class=n>enabled</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Set environment
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>RenderSettings</span><span class=p>.</span><span class=n>ambientMode</span> <span class=o>=</span> <span class=n>AmbientMode</span><span class=p>.</span><span class=n>Skybox</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>RenderSettings</span><span class=p>.</span><span class=n>ambientIntensity</span> <span class=o>=</span> <span class=mf>1.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Set Shader global branches
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Shader</span><span class=p>.</span><span class=nf>DisableKeyword</span><span class=p>(</span><span class=s>&#34;_BAKE_MAINLIGHT&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Shader</span><span class=p>.</span><span class=nf>DisableKeyword</span><span class=p>(</span><span class=s>&#34;_BAKE_SKYLIGHT&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Shader</span><span class=p>.</span><span class=nf>DisableKeyword</span><span class=p>(</span><span class=s>&#34;_BAKE_EMISSIONGI&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#pragma shader_feature __ _BAKE_MAINLIGHT _BAKE_SKYLIGHT _BAKE_EMISSIONGI
</span></span></span></code></pre></div><ul><li>Need to set global branches in both script and Shader</li><li>Through branch declaration, can make Shader output different content for different baking modes.</li><li>Use <code>#if defined(...)</code> for branch judgment in code:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#if defined (_BAKE_EMISSIONGI)
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=n>metaIN</span><span class=p>.</span><span class=n>Emission</span> <span class=o>=</span> <span class=n>opacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#elif defined (_BAKE_MAINLIGHT) || defined (_BAKE_SKYLIGHT)
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=n>metaIN</span><span class=p>.</span><span class=n>Emission</span> <span class=o>=</span> <span class=mf>0.0f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><hr><h4 class="relative group">Skybox Special Note<div id=skybox-special-note class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#skybox-special-note aria-label=Anchor>#</a></span></h4><ul><li>Skybox&rsquo;s Shader doesn&rsquo;t need MetaPass, Unity internally handles skybox lighting baking automatically.</li></ul><hr><h3 class="relative group">ShadowCaster: Custom Shadow Pass<div id=shadowcaster-custom-shadow-pass class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#shadowcaster-custom-shadow-pass aria-label=Anchor>#</a></span></h3><p>Since this case scene is non-enclosed box-shaped and normals face inward, Unity&rsquo;s default ShadowCaster cannot project correctly. Need to customize ShadowCaster Pass.</p><h4 class="relative group">Case Code<div id=case-code-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#case-code-1 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Pass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=s>&#34;ShadowCaster&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Tags</span> <span class=p>{</span> <span class=s>&#34;LightMode&#34;</span> <span class=o>=</span> <span class=s>&#34;ShadowCaster&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ZWrite</span> <span class=n>On</span> <span class=n>ZTest</span> <span class=n>LEqual</span> <span class=n>Cull</span> <span class=n>off</span>
</span></span><span class=line><span class=cl>    <span class=n>CGPROGRAM</span>
</span></span><span class=line><span class=cl>    <span class=cp>#pragma vertex vert
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#pragma fragment frag
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#pragma multi_compile_shadowcaster
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#include</span> <span class=cpf>&#34;UnityCG.cginc&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>v2f</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>V2F_SHADOW_CASTER</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v2f</span> <span class=nf>vert</span><span class=p>(</span><span class=n>appdata_base</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=nf>frag</span><span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>SHADOW_CASTER_FRAGMENT</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ENDCG</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 class="relative group">Key Points Explanation<div id=key-points-explanation-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#key-points-explanation-1 aria-label=Anchor>#</a></span></h4><ul><li><code>appdata_base</code>: Unity predefined vertex input structure, contains POSITION, NORMAL, TEXCOORD0.</li><li><code>V2F_SHADOW_CASTER</code>: Output structure, contains shadow projection required clip space position and auxiliary vectors, equivalent to:<ul><li>float4 pos : SV_POSITION;</li><li>float3 vec : TEXCOORD0;</li></ul></li><li><code>TRANSFER_SHADOW_CASTER_NORMALOFFSET(o)</code>: Calculate shadow offset, ensure shadow projection is correct.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>float4</span> <span class=n>clipPos</span> <span class=o>=</span> <span class=nf>UnityClipSpaceShadowCasterPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span> \
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=nf>UnityApplyLinearShadowBias</span><span class=p>(</span><span class=n>clipPos</span><span class=p>);</span> \
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=p>.</span><span class=n>vec</span> <span class=o>=</span> <span class=nf>ComputeOffsetData</span><span class=p>(</span><span class=n>clipPos</span><span class=p>);</span>
</span></span></code></pre></div><ul><li><code>SHADOW_CASTER_FRAGMENT(i)</code> Unity built-in macro, calculate shadow casting in fragment shader</li><li><code>Cull off</code>: Turn off culling, ensure inner surfaces can also project.</li></ul><p>uv0: TEXCOORD0 in VertexInput will automatically be recognized as the model&rsquo;s first set of UV, in VertexOutput, TEXCOORD0 is a general interpolation register, it&rsquo;s a developer-defined data channel, need to manually calculate and assign from input data in vert</p><pre tabindex=0><code>
The translation is now complete, including all Chinese comments and technical terms translated to English while maintaining the technical accuracy and context of the original content.
</code></pre></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><a href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part4/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/notes/foundation/linearalgebra/essenceoflinearalgebra_part4/featured_hu_10528a2cb8acaf49.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part4/>EssenceOfLinearAlgebra - 04</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span>1099 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span></div></div><div class="py-1 prose dark:prose-invert"></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part2/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/notes/foundation/linearalgebra/essenceoflinearalgebra_part2/featured_hu_10528a2cb8acaf49.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/notes/foundation/linearalgebra/essenceoflinearalgebra_part2/>EssenceOfLinearAlgebra - 02</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span>1458 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div></div><div class="py-1 prose dark:prose-invert"></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/featured_hu_10528a2cb8acaf49.jpg)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/>Zhuangdong_Course_Note_VFXShader</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span>4105 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">20 mins</span></div></div><div class="py-1 prose dark:prose-invert"></div></div><div class="px-6 pt-4 pb-2"></div></div></a></section></div><script type=text/javascript src=/js/page.min.407e5b2727c1f241c95d53db24c776bea71bfc18e09511b815d669ad8caca6e9e18a53864ad364b1ccccfa2f2956768d33cfe193bfb64d3406f3b5ece354ba57.js integrity="sha512-QH5bJyfB8kHJXVPbJMd2vqcb/BjglRG4FdZprYyspunhilOGStNksczM+i8pVnaNM8/hk7+2TTQG87Xs41S6Vw==" data-oid="views_Notes/Courses/ZhuangDong'sTAIntroCourse/Zhuangdong_Note_LightingMap/index.md" data-oid-likes="likes_Notes/Courses/ZhuangDong'sTAIntroCourse/Zhuangdong_Note_LightingMap/index.md"></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_forwardrendering/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Zhuangdong's Technical Art Introduction Course - Forward Rendering</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span></a></span><span><a class="flex text-right group ml-3" href=/notes/courses/zhuangdongstaintrocourse/zhuangdong_note_vfxshader/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Zhuangdong_Course_Note_VFXShader</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href title>Changelog</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2025 Runming Chen. All Rights Reserved.</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-index-500" data-url=https://rcrunming.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>